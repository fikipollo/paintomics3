(function(undefined){"use strict";var __instances={};var sigma=function(conf){var i,l,a,c,o,id;sigma.classes.dispatcher.extend(this);var _self=this,_conf=conf||{};if(typeof _conf==="string"||_conf instanceof HTMLElement)_conf={renderers:[_conf]};else if(Object.prototype.toString.call(_conf)==="[object Array]")_conf={renderers:_conf};o=_conf.renderers||_conf.renderer||_conf.container;if(!_conf.renderers||_conf.renderers.length===0)if(typeof o==="string"||o instanceof HTMLElement||typeof o==="object"&&"container"in o)_conf.renderers=[o];if(_conf.id){if(__instances[_conf.id])throw'sigma: Instance "'+_conf.id+'" already exists.';Object.defineProperty(this,"id",{value:_conf.id})}else{id=0;while(__instances[id])id++;Object.defineProperty(this,"id",{value:""+id})}__instances[this.id]=this;this.settings=new sigma.classes.configurable(sigma.settings,_conf.settings||{});Object.defineProperty(this,"graph",{value:new sigma.classes.graph(this.settings),configurable:true});Object.defineProperty(this,"middlewares",{value:[],configurable:true});Object.defineProperty(this,"cameras",{value:{},configurable:true});Object.defineProperty(this,"renderers",{value:{},configurable:true});Object.defineProperty(this,"renderersPerCamera",{value:{},configurable:true});Object.defineProperty(this,"cameraFrames",{value:{},configurable:true});Object.defineProperty(this,"camera",{get:function(){return this.cameras[0]}});Object.defineProperty(this,"events",{value:["click","rightClick","clickStage","doubleClickStage","rightClickStage","clickNode","clickNodes","doubleClickNode","doubleClickNodes","rightClickNode","rightClickNodes","hovers","downNode","downNodes","upNode","upNodes"],configurable:true});this._handler=function(e){var k,data={};for(k in e.data)data[k]=e.data[k];data.renderer=e.target;this.dispatchEvent(e.type,data)}.bind(this);a=_conf.renderers||[];for(i=0,l=a.length;i<l;i++)this.addRenderer(a[i]);a=_conf.middlewares||[];for(i=0,l=a.length;i<l;i++)this.middlewares.push(typeof a[i]==="string"?sigma.middlewares[a[i]]:a[i]);if(typeof _conf.graph==="object"&&_conf.graph){this.graph.read(_conf.graph);this.refresh()}window.addEventListener("resize",function(){if(_self.settings)_self.refresh()})};sigma.prototype.addCamera=function(id){var self=this,camera;if(!arguments.length){id=0;while(this.cameras[""+id])id++;id=""+id}if(this.cameras[id])throw'sigma.addCamera: The camera "'+id+'" already exists.';camera=new sigma.classes.camera(id,this.graph,this.settings);this.cameras[id]=camera;camera.quadtree=new sigma.classes.quad;if(sigma.classes.edgequad!==undefined){camera.edgequadtree=new sigma.classes.edgequad}camera.bind("coordinatesUpdated",function(e){self.renderCamera(camera)});this.renderersPerCamera[id]=[];return camera};sigma.prototype.killCamera=function(v){v=typeof v==="string"?this.cameras[v]:v;if(!v)throw"sigma.killCamera: The camera is undefined.";var i,l,a=this.renderersPerCamera[v.id];for(l=a.length,i=l-1;i>=0;i--)this.killRenderer(a[i]);delete this.renderersPerCamera[v.id];delete this.cameraFrames[v.id];delete this.cameras[v.id];if(v.kill)v.kill();return this};sigma.prototype.addRenderer=function(options){var id,fn,camera,renderer,o=options||{};if(typeof o==="string")o={container:document.getElementById(o)};else if(o instanceof HTMLElement)o={container:o};if(typeof o.container==="string")o.container=document.getElementById(o.container);if(!("id"in o)){id=0;while(this.renderers[""+id])id++;id=""+id}else id=o.id;if(this.renderers[id])throw'sigma.addRenderer: The renderer "'+id+'" already exists.';fn=typeof o.type==="function"?o.type:sigma.renderers[o.type];fn=fn||sigma.renderers.def;camera="camera"in o?o.camera instanceof sigma.classes.camera?o.camera:this.cameras[o.camera]||this.addCamera(o.camera):this.addCamera();if(this.cameras[camera.id]!==camera)throw"sigma.addRenderer: The camera is not properly referenced.";renderer=new fn(this.graph,camera,this.settings,o);this.renderers[id]=renderer;Object.defineProperty(renderer,"id",{value:id});if(renderer.bind)renderer.bind(["click","rightClick","clickStage","doubleClickStage","rightClickStage","clickNode","clickNodes","clickEdge","clickEdges","doubleClickNode","doubleClickNodes","doubleClickEdge","doubleClickEdges","rightClickNode","rightClickNodes","rightClickEdge","rightClickEdges","hovers","downNode","downNodes","downEdge","downEdges","upNode","upNodes","upEdge","upEdges"],this._handler);this.renderersPerCamera[camera.id].push(renderer);return renderer};sigma.prototype.killRenderer=function(v){v=typeof v==="string"?this.renderers[v]:v;if(!v)throw"sigma.killRenderer: The renderer is undefined.";var a=this.renderersPerCamera[v.camera.id],i=a.indexOf(v);if(i>=0)a.splice(i,1);if(v.kill)v.kill();delete this.renderers[v.id];return this};sigma.prototype.refresh=function(options){var i,l,k,a,c,bounds,prefix=0;options=options||{};a=this.middlewares||[];for(i=0,l=a.length;i<l;i++)a[i].call(this,i===0?"":"tmp"+prefix+":",i===l-1?"ready:":"tmp"+ ++prefix+":");for(k in this.cameras){c=this.cameras[k];if(c.settings("autoRescale")&&this.renderersPerCamera[c.id]&&this.renderersPerCamera[c.id].length)sigma.middlewares.rescale.call(this,a.length?"ready:":"",c.readPrefix,{width:this.renderersPerCamera[c.id][0].width,height:this.renderersPerCamera[c.id][0].height});else sigma.middlewares.copy.call(this,a.length?"ready:":"",c.readPrefix);if(!options.skipIndexation){bounds=sigma.utils.getBoundaries(this.graph,c.readPrefix);c.quadtree.index(this.graph,{prefix:c.readPrefix,maxLevel:c.settings("nodeQuadtreeMaxLevel"),bounds:{x:bounds.minX,y:bounds.minY,width:bounds.maxX-bounds.minX,height:bounds.maxY-bounds.minY}});if(c.edgequadtree!==undefined&&c.settings("drawEdges")&&(c.settings("enableEdgeHovering")||c.settings("edgesClippingWithNodes"))){c.edgequadtree.index(this.graph,{prefix:c.readPrefix,maxLevel:c.settings("edgeQuadtreeMaxLevel"),bounds:{x:bounds.minX,y:bounds.minY,width:bounds.maxX-bounds.minX,height:bounds.maxY-bounds.minY}})}}}a=Object.keys(this.renderers);for(i=0,l=a.length;i<l;i++)if(this.renderers[a[i]].process){if(this.settings("skipErrors"))try{this.renderers[a[i]].process()}catch(e){console.log('Warning: The renderer "'+a[i]+'" crashed on ".process()"')}else this.renderers[a[i]].process()}this.render();return this};sigma.prototype.render=function(){var l,i,prefix=0;for(i in this.renderers)if(this.settings("skipErrors"))try{this.renderers[i].render()}catch(e){if(this.settings("verbose"))console.log('Warning: The renderer "'+this.renderers[i]+'" crashed on ".render()"')}else this.renderers[i].render();return this};sigma.prototype.renderCamera=function(camera,force){var i,l,a,render,self=this;render=function(){a=self.renderersPerCamera[camera.id];for(i=0,l=a.length;i<l;i++){if(self.settings("skipErrors"))try{a[i].render()}catch(e){if(self.settings("verbose"))console.log('Warning: The renderer "'+a[i].id+'" crashed on ".render()"')}else a[i].render()}};if(force){render()}else{self.cameraFrames[camera.id]=render;requestAnimationFrame(function(){self.cameraFrames[camera.id]()})}return this};sigma.prototype.kill=function(){var k;this.dispatchEvent("kill");this.graph.kill();delete this.middlewares;for(k in this.renderers)this.killRenderer(this.renderers[k]);for(k in this.cameras)this.killCamera(this.cameras[k]);delete this.renderers;delete this.cameras;for(k in this)if(this.hasOwnProperty(k))delete this[k];delete __instances[this.id]};sigma.instances=function(id){return arguments.length?__instances[id]:sigma.utils.extend({},__instances)};sigma.version="1.0.3";if(typeof this.sigma!=="undefined")throw"An object called sigma is already in the global scope.";this.sigma=sigma}).call(this);(function(global){"use strict";if(global.conrad)throw new Error("conrad already exists");var _lastFrameTime;var _isRunning=false;var _jobs={};var _runningJobs={};var _sortedByPriorityJobs=[];var _waitingJobs={};var _doneJobs=[];var _noStart=false;var _parameters={frameDuration:20,history:true};var _handlers=Object.create(null);function _bind(events,handler){var i,i_end,event,eArray;if(!arguments.length)return;else if(arguments.length===1&&Object(arguments[0])===arguments[0])for(events in arguments[0])_bind(events,arguments[0][events]);else if(arguments.length>1){eArray=Array.isArray(events)?events:events.split(/ /);for(i=0,i_end=eArray.length;i!==i_end;i+=1){event=eArray[i];if(!_handlers[event])_handlers[event]=[];_handlers[event].push({handler:handler})}}}function _unbind(events,handler){var i,i_end,j,j_end,a,event,eArray=Array.isArray(events)?events:events.split(/ /);if(!arguments.length)_handlers=Object.create(null);else if(handler){for(i=0,i_end=eArray.length;i!==i_end;i+=1){event=eArray[i];if(_handlers[event]){a=[];for(j=0,j_end=_handlers[event].length;j!==j_end;j+=1)if(_handlers[event][j].handler!==handler)a.push(_handlers[event][j]);_handlers[event]=a}if(_handlers[event]&&_handlers[event].length===0)delete _handlers[event]}}else for(i=0,i_end=eArray.length;i!==i_end;i+=1)delete _handlers[eArray[i]]}function _dispatch(events,data){var i,j,i_end,j_end,event,eventName,eArray=Array.isArray(events)?events:events.split(/ /);data=data===undefined?{}:data;for(i=0,i_end=eArray.length;i!==i_end;i+=1){eventName=eArray[i];if(_handlers[eventName]){event={type:eventName,data:data||{}};for(j=0,j_end=_handlers[eventName].length;j!==j_end;j+=1)try{_handlers[eventName][j].handler(event)}catch(e){}}}}function _executeFirstJob(){var i,l,test,kill,pushed=false,time=__dateNow(),job=_sortedByPriorityJobs.shift();test=job.job();time=__dateNow()-time;job.done++;job.time+=time;job.currentTime+=time;job.weightTime=job.currentTime/(job.weight||1);job.averageTime=job.time/job.done;kill=job.count?job.count<=job.done:!test;if(!kill){for(i=0,l=_sortedByPriorityJobs.length;i<l;i++)if(_sortedByPriorityJobs[i].weightTime>job.weightTime){_sortedByPriorityJobs.splice(i,0,job);pushed=true;break}if(!pushed)_sortedByPriorityJobs.push(job)}return kill?job:null}function _activateJob(job){var l=_sortedByPriorityJobs.length;_runningJobs[job.id]=job;job.status="running";if(l){job.weightTime=_sortedByPriorityJobs[l-1].weightTime;job.currentTime=job.weightTime*(job.weight||1)}job.startTime=__dateNow();_dispatch("jobStarted",__clone(job));_sortedByPriorityJobs.push(job)}function _loop(){var k,o,l,job,time,deadJob;for(k in _jobs){job=_jobs[k];if(job.after)_waitingJobs[k]=job;else _activateJob(job);delete _jobs[k]}_isRunning=!!_sortedByPriorityJobs.length;while(_sortedByPriorityJobs.length&&__dateNow()-_lastFrameTime<_parameters.frameDuration){deadJob=_executeFirstJob();if(deadJob){_killJob(deadJob.id);for(k in _waitingJobs)if(_waitingJobs[k].after===deadJob.id){_activateJob(_waitingJobs[k]);delete _waitingJobs[k]}}}if(_isRunning){_lastFrameTime=__dateNow();_dispatch("enterFrame");setTimeout(_loop,0)}else _dispatch("stop")}function _addJob(v1,v2){var i,l,o;if(Array.isArray(v1)){_noStart=true;for(i=0,l=v1.length;i<l;i++)_addJob(v1[i].id,__extend(v1[i],v2));_noStart=false;if(!_isRunning){_lastFrameTime=__dateNow();_dispatch("start");_loop()}}else if(typeof v1==="object"){if(typeof v1.id==="string")_addJob(v1.id,v1);else{_noStart=true;for(i in v1)if(typeof v1[i]==="function")_addJob(i,__extend({job:v1[i]},v2));else _addJob(i,__extend(v1[i],v2));_noStart=false;if(!_isRunning){_lastFrameTime=__dateNow();_dispatch("start");_loop()}}}else if(typeof v1==="string"){if(_hasJob(v1))throw new Error('[conrad.addJob] Job with id "'+v1+'" already exists.');if(typeof v2==="function"){o={id:v1,done:0,time:0,status:"waiting",currentTime:0,averageTime:0,weightTime:0,job:v2}}else if(typeof v2==="object"){o=__extend({id:v1,done:0,time:0,status:"waiting",currentTime:0,averageTime:0,weightTime:0},v2)}else throw new Error("[conrad.addJob] Wrong arguments.");_jobs[v1]=o;_dispatch("jobAdded",__clone(o));if(!_isRunning&&!_noStart){_lastFrameTime=__dateNow();_dispatch("start");_loop()}}else throw new Error("[conrad.addJob] Wrong arguments.");return this}function _killJob(v1){var i,l,k,a,job,found=false;if(Array.isArray(v1))for(i=0,l=v1.length;i<l;i++)_killJob(v1[i]);else if(typeof v1==="string"){a=[_runningJobs,_waitingJobs,_jobs];for(i=0,l=a.length;i<l;i++)if(v1 in a[i]){job=a[i][v1];if(_parameters.history){job.status="done";_doneJobs.push(job)}_dispatch("jobEnded",__clone(job));delete a[i][v1];if(typeof job.end==="function")job.end();found=true}a=_sortedByPriorityJobs;for(i=0,l=a.length;i<l;i++)if(a[i].id===v1){a.splice(i,1);break}if(!found)throw new Error('[conrad.killJob] Job "'+v1+'" not found.')}else throw new Error("[conrad.killJob] Wrong arguments.");return this}function _killAll(){var k,jobs=__extend(_jobs,_runningJobs,_waitingJobs);if(_parameters.history)for(k in jobs){jobs[k].status="done";_doneJobs.push(jobs[k]);if(typeof jobs[k].end==="function")jobs[k].end()}_jobs={};_waitingJobs={};_runningJobs={};_sortedByPriorityJobs=[];_isRunning=false;return this}function _hasJob(id){var job=_jobs[id]||_runningJobs[id]||_waitingJobs[id];return job?__extend(job):null}function _settings(v1,v2){var o;if(typeof a1==="string"&&arguments.length===1)return _parameters[a1];else{o=typeof a1==="object"&&arguments.length===1?a1||{}:{};if(typeof a1==="string")o[a1]=a2;for(var k in o)if(o[k]!==undefined)_parameters[k]=o[k];else delete _parameters[k];return this}}function _getIsRunning(){return _isRunning}function _clearHistory(){_doneJobs=[];return this}function _getStats(v1,v2){var a,k,i,l,stats,pattern,isPatternString;if(!arguments.length){stats=[];for(k in _jobs)stats.push(_jobs[k]);for(k in _waitingJobs)stats.push(_waitingJobs[k]);for(k in _runningJobs)stats.push(_runningJobs[k]);stats=stats.concat(_doneJobs)}if(typeof v1==="string")switch(v1){case"waiting":stats=__objectValues(_waitingJobs);break;case"running":stats=__objectValues(_runningJobs);break;case"done":stats=_doneJobs;break;default:pattern=v1}if(v1 instanceof RegExp)pattern=v1;if(!pattern&&(typeof v2==="string"||v2 instanceof RegExp))pattern=v2;if(pattern){isPatternString=typeof pattern==="string";if(stats instanceof Array){a=stats}else if(typeof stats==="object"){a=[];for(k in stats)a=a.concat(stats[k])}else{a=[];for(k in _jobs)a.push(_jobs[k]);for(k in _waitingJobs)a.push(_waitingJobs[k]);for(k in _runningJobs)a.push(_runningJobs[k]);a=a.concat(_doneJobs)}stats=[];for(i=0,l=a.length;i<l;i++)if(isPatternString?a[i].id===pattern:a[i].id.match(pattern))stats.push(a[i])}return __clone(stats)}function __extend(){var i,k,res={},l=arguments.length;for(i=l-1;i>=0;i--)for(k in arguments[i])res[k]=arguments[i][k];return res}function __clone(item){var result,i,k,l;if(!item)return item;if(Array.isArray(item)){result=[];for(i=0,l=item.length;i<l;i++)result.push(__clone(item[i]))}else if(typeof item==="object"){result={};for(i in item)result[i]=__clone(item[i])}else result=item;return result}function __objectValues(o){var k,a=[];for(k in o)a.push(o[k]);return a}function __dateNow(){return Date.now?Date.now():(new Date).getTime()}if(!Array.isArray)Array.isArray=function(v){return Object.prototype.toString.call(v)==="[object Array]"};var conrad={hasJob:_hasJob,addJob:_addJob,killJob:_killJob,killAll:_killAll,settings:_settings,getStats:_getStats,isRunning:_getIsRunning,clearHistory:_clearHistory,bind:_bind,unbind:_unbind,version:"0.1.0"};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=conrad;exports.conrad=conrad}global.conrad=conrad})(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";var _root=this;sigma.utils=sigma.utils||{};sigma.utils.extend=function(){var i,k,res={},l=arguments.length;for(i=l-1;i>=0;i--)for(k in arguments[i])res[k]=arguments[i][k];return res};sigma.utils.dateNow=function(){return Date.now?Date.now():(new Date).getTime()};sigma.utils.pkg=function(pkgName){return(pkgName||"").split(".").reduce(function(context,objName){return objName in context?context[objName]:context[objName]={}},_root)};sigma.utils.id=function(){var i=0;return function(){return++i}}();sigma.utils.floatColor=function(val){var result=[0,0,0];if(val.match(/^#/)){val=(val||"").replace(/^#/,"");result=val.length===3?[parseInt(val.charAt(0)+val.charAt(0),16),parseInt(val.charAt(1)+val.charAt(1),16),parseInt(val.charAt(2)+val.charAt(2),16)]:[parseInt(val.charAt(0)+val.charAt(1),16),parseInt(val.charAt(2)+val.charAt(3),16),parseInt(val.charAt(4)+val.charAt(5),16)]}else if(val.match(/^ *rgba? *\(/)){val=val.match(/^ *rgba? *\( *([0-9]*) *, *([0-9]*) *, *([0-9]*) *(,.*)?\) *$/);result=[+val[1],+val[2],+val[3]]}return result[0]*256*256+result[1]*256+result[2]};sigma.utils.zoomTo=function(camera,x,y,ratio,animation){var settings=camera.settings,count,newRatio,animationSettings,coordinates;newRatio=Math.max(settings("zoomMin"),Math.min(settings("zoomMax"),camera.ratio*ratio));if(newRatio!==camera.ratio){ratio=newRatio/camera.ratio;coordinates={x:x*(1-ratio)+camera.x,y:y*(1-ratio)+camera.y,ratio:newRatio};if(animation&&animation.duration){count=sigma.misc.animation.killAll(camera);animation=sigma.utils.extend(animation,{easing:count?"quadraticOut":"quadraticInOut"});sigma.misc.animation.camera(camera,coordinates,animation)}else{camera.goTo(coordinates);if(animation&&animation.onComplete)animation.onComplete()}}};sigma.utils.getQuadraticControlPoint=function(x1,y1,x2,y2,cc){cc=this.extend(cc,{x:2,y:4});return{x:(x1+x2)/cc.x+(y2-y1)/cc.y,y:(y1+y2)/cc.x+(x1-x2)/cc.y}};sigma.utils.getPointOnQuadraticCurve=function(t,x1,y1,x2,y2,xi,yi){return{x:(1-t)*(1-t)*x1+2*(1-t)*t*xi+t*t*x2,y:(1-t)*(1-t)*y1+2*(1-t)*t*yi+t*t*y2}};sigma.utils.getPointOnBezierCurve=function(t,x1,y1,x2,y2,cx,cy,dx,dy){var B0_t=(1-t)*(1-t)*(1-t),B1_t=3*t*(1-t)*(1-t),B2_t=3*t*t*(1-t),B3_t=t*t*t;return{x:B0_t*x1+B1_t*cx+B2_t*dx+B3_t*x2,y:B0_t*y1+B1_t*cy+B2_t*dy+B3_t*y2}};sigma.utils.getSelfLoopControlPoints=function(x,y,size){return{x1:x-size*7,y1:y,x2:x,y2:y+size*7}};sigma.utils.getDistance=function(x0,y0,x1,y1){return Math.sqrt((x1-x0)*(x1-x0)+(y1-y0)*(y1-y0))};sigma.utils.getCircleIntersection=function(x0,y0,r0,x1,y1,r1){var a,dx,dy,d,h,rx,ry,x2,y2;dx=x1-x0;dy=y1-y0;d=Math.sqrt(dy*dy+dx*dx);if(d>r0+r1){return false}if(d<Math.abs(r0-r1)){return false}a=(r0*r0-r1*r1+d*d)/(2*d);x2=x0+dx*a/d;y2=y0+dy*a/d;h=Math.sqrt(r0*r0-a*a);rx=-dy*(h/d);ry=dx*(h/d);var xi=x2+rx;var xi_prime=x2-rx;var yi=y2+ry;var yi_prime=y2-ry;return{xi:xi,xi_prime:xi_prime,yi:yi,yi_prime:yi_prime}};sigma.utils.isPointOnSegment=function(x,y,x1,y1,x2,y2,epsilon){return sigma.utils.distancePointToSegment(x,y,x1,y1,x2,y2)<epsilon};sigma.utils.distancePointToSegment=function(x,y,x1,y1,x2,y2){var A=x-x1,B=y-y1,C=x2-x1,D=y2-y1,dot=A*C+B*D,len_sq=C*C+D*D,param=-1,xx,yy;if(len_sq!==0)param=dot/len_sq;if(param<0){xx=x1;yy=y1}else if(param>1){xx=x2;yy=y2}else{xx=x1+param*C;yy=y1+param*D}var dx=x-xx;var dy=y-yy;return Math.sqrt(dx*dx+dy*dy)};sigma.utils.isPointOnQuadraticCurve=function(x,y,x1,y1,x2,y2,cpx,cpy,epsilon){var dP1P2=sigma.utils.getDistance(x1,y1,x2,y2);if(Math.abs(x-x1)>dP1P2||Math.abs(y-y1)>dP1P2){return false}var dP1=sigma.utils.getDistance(x,y,x1,y1),dP2=sigma.utils.getDistance(x,y,x2,y2),t=.5,r=dP1<dP2?-.01:.01,rThreshold=.001,i=100,pt=sigma.utils.getPointOnQuadraticCurve(t,x1,y1,x2,y2,cpx,cpy),dt=sigma.utils.getDistance(x,y,pt.x,pt.y),old_dt;while(i-- >0&&t>=0&&t<=1&&dt>epsilon&&(r>rThreshold||r<-rThreshold)){old_dt=dt;pt=sigma.utils.getPointOnQuadraticCurve(t,x1,y1,x2,y2,cpx,cpy);dt=sigma.utils.getDistance(x,y,pt.x,pt.y);if(dt>old_dt){r=-r/2;t+=r}else if(t+r<0||t+r>1){r=r/2;dt=old_dt}else{t+=r}}return dt<epsilon};sigma.utils.isPointOnBezierCurve=function(x,y,x1,y1,x2,y2,cpx1,cpy1,cpx2,cpy2,epsilon){var dP1CP1=sigma.utils.getDistance(x1,y1,cpx1,cpy1);if(Math.abs(x-x1)>dP1CP1||Math.abs(y-y1)>dP1CP1){return false}var dP1=sigma.utils.getDistance(x,y,x1,y1),dP2=sigma.utils.getDistance(x,y,x2,y2),t=.5,r=dP1<dP2?-.01:.01,rThreshold=.001,i=100,pt=sigma.utils.getPointOnBezierCurve(t,x1,y1,x2,y2,cpx1,cpy1,cpx2,cpy2),dt=sigma.utils.getDistance(x,y,pt.x,pt.y),old_dt;while(i-- >0&&t>=0&&t<=1&&dt>epsilon&&(r>rThreshold||r<-rThreshold)){old_dt=dt;pt=sigma.utils.getPointOnBezierCurve(t,x1,y1,x2,y2,cpx1,cpy1,cpx2,cpy2);dt=sigma.utils.getDistance(x,y,pt.x,pt.y);if(dt>old_dt){r=-r/2;t+=r}else if(t+r<0||t+r>1){r=r/2;dt=old_dt}else{t+=r}}return dt<epsilon};sigma.utils.getX=function(e){return e.offsetX!==undefined&&e.offsetX||e.layerX!==undefined&&e.layerX||e.clientX!==undefined&&e.clientX};sigma.utils.getY=function(e){return e.offsetY!==undefined&&e.offsetY||e.layerY!==undefined&&e.layerY||e.clientY!==undefined&&e.clientY};sigma.utils.getPixelRatio=function(){var ratio=1;if(window.screen.deviceXDPI!==undefined&&window.screen.logicalXDPI!==undefined&&window.screen.deviceXDPI>window.screen.logicalXDPI){ratio=window.screen.systemXDPI/window.screen.logicalXDPI}else if(window.devicePixelRatio!==undefined){ratio=window.devicePixelRatio}return ratio};sigma.utils.getWidth=function(e){var w=!e.target.ownerSVGElement?e.target.width:e.target.ownerSVGElement.width;return typeof w==="number"&&w||w!==undefined&&w.baseVal!==undefined&&w.baseVal.value};sigma.utils.getCenter=function(e){var ratio=e.target.namespaceURI.indexOf("svg")!==-1?1:sigma.utils.getPixelRatio();return{x:sigma.utils.getWidth(e)/(2*ratio),y:sigma.utils.getHeight(e)/(2*ratio)}};sigma.utils.mouseCoords=function(e,x,y){x=x||sigma.utils.getX(e);y=y||sigma.utils.getY(e);return{x:x-sigma.utils.getCenter(e).x,y:y-sigma.utils.getCenter(e).y,clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey,shiftKey:e.shiftKey}};sigma.utils.getHeight=function(e){var h=!e.target.ownerSVGElement?e.target.height:e.target.ownerSVGElement.height;return typeof h==="number"&&h||h!==undefined&&h.baseVal!==undefined&&h.baseVal.value};sigma.utils.getDelta=function(e){return e.wheelDelta!==undefined&&e.wheelDelta||e.detail!==undefined&&-e.detail};sigma.utils.getOffset=function(dom){var left=0,top=0;while(dom){top=top+parseInt(dom.offsetTop);left=left+parseInt(dom.offsetLeft);dom=dom.offsetParent}return{top:top,left:left}};sigma.utils.doubleClick=function(target,type,callback){var clicks=0,self=this,handlers;target._doubleClickHandler=target._doubleClickHandler||{};target._doubleClickHandler[type]=target._doubleClickHandler[type]||[];handlers=target._doubleClickHandler[type];handlers.push(function(e){clicks++;if(clicks===2){clicks=0;return callback(e)}else if(clicks===1){setTimeout(function(){clicks=0},sigma.settings.doubleClickTimeout)}});target.addEventListener(type,handlers[handlers.length-1],false)};sigma.utils.unbindDoubleClick=function(target,type){var handler,handlers=(target._doubleClickHandler||{})[type]||[];while(handler=handlers.pop()){target.removeEventListener(type,handler)}delete(target._doubleClickHandler||{})[type]};sigma.utils.easings=sigma.utils.easings||{};sigma.utils.easings.linearNone=function(k){return k};sigma.utils.easings.quadraticIn=function(k){return k*k};sigma.utils.easings.quadraticOut=function(k){return k*(2-k)};sigma.utils.easings.quadraticInOut=function(k){if((k*=2)<1)return.5*k*k;return-.5*(--k*(k-2)-1)};sigma.utils.easings.cubicIn=function(k){return k*k*k};sigma.utils.easings.cubicOut=function(k){return--k*k*k+1};sigma.utils.easings.cubicInOut=function(k){if((k*=2)<1)return.5*k*k*k;return.5*((k-=2)*k*k+2)};sigma.utils.isWebGLSupported=function(){var canvas,webgl=!!window.WebGLRenderingContext;if(webgl){canvas=document.createElement("canvas");try{return!!(canvas.getContext("webgl")||canvas.getContext("experimental-webgl"))}catch(e){}}return false};sigma.utils.loadShader=function(gl,shaderSource,shaderType,error){var compiled,shader=gl.createShader(shaderType);gl.shaderSource(shader,shaderSource);gl.compileShader(shader);compiled=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!compiled){if(error){error('Error compiling shader "'+shader+'":'+gl.getShaderInfoLog(shader))}gl.deleteShader(shader);return null}return shader};sigma.utils.loadProgram=function(gl,shaders,attribs,loc,error){var i,linked,program=gl.createProgram();for(i=0;i<shaders.length;++i)gl.attachShader(program,shaders[i]);if(attribs)for(i=0;i<attribs.length;++i)gl.bindAttribLocation(program,locations?locations[i]:i,opt_attribs[i]);gl.linkProgram(program);linked=gl.getProgramParameter(program,gl.LINK_STATUS);if(!linked){if(error)error("Error in program linking: "+gl.getProgramInfoLog(program));gl.deleteProgram(program);return null}return program};sigma.utils.pkg("sigma.utils.matrices");sigma.utils.matrices.translation=function(dx,dy){return[1,0,0,0,1,0,dx,dy,1]};sigma.utils.matrices.rotation=function(angle,m2){var cos=Math.cos(angle),sin=Math.sin(angle);return m2?[cos,-sin,sin,cos]:[cos,-sin,0,sin,cos,0,0,0,1]};sigma.utils.matrices.scale=function(ratio,m2){return m2?[ratio,0,0,ratio]:[ratio,0,0,0,ratio,0,0,0,1]};sigma.utils.matrices.multiply=function(a,b,m2){var l=m2?2:3,a00=a[0*l+0],a01=a[0*l+1],a02=a[0*l+2],a10=a[1*l+0],a11=a[1*l+1],a12=a[1*l+2],a20=a[2*l+0],a21=a[2*l+1],a22=a[2*l+2],b00=b[0*l+0],b01=b[0*l+1],b02=b[0*l+2],b10=b[1*l+0],b11=b[1*l+1],b12=b[1*l+2],b20=b[2*l+0],b21=b[2*l+1],b22=b[2*l+2];return m2?[a00*b00+a01*b10,a00*b01+a01*b11,a10*b00+a11*b10,a10*b01+a11*b11]:[a00*b00+a01*b10+a02*b20,a00*b01+a01*b11+a02*b21,a00*b02+a01*b12+a02*b22,a10*b00+a11*b10+a12*b20,a10*b01+a11*b11+a12*b21,a10*b02+a11*b12+a12*b22,a20*b00+a21*b10+a22*b20,a20*b01+a21*b11+a22*b21,a20*b02+a21*b12+a22*b22]};sigma.utils.canvas={};sigma.utils.canvas.getTextWidth=function(context,approximate,fontSize,text){if(!text)return 0;return approximate?.6*text.length*fontSize:context.measureText(text).width};sigma.utils.canvas.setLevel=function(level,context){if(level){context.shadowOffsetX=0;switch(level){case 1:context.shadowOffsetY=1.5;context.shadowBlur=4;context.shadowColor="rgba(0,0,0,0.36)";break;case 2:context.shadowOffsetY=3;context.shadowBlur=12;context.shadowColor="rgba(0,0,0,0.39)";break;case 3:context.shadowOffsetY=6;context.shadowBlur=12;context.shadowColor="rgba(0,0,0,0.42)";break;case 4:context.shadowOffsetY=10;context.shadowBlur=20;context.shadowColor="rgba(0,0,0,0.47)";break;case 5:context.shadowOffsetY=15;context.shadowBlur=24;context.shadowColor="rgba(0,0,0,0.52)";break}}};sigma.utils.canvas.resetLevel=function(context){context.shadowOffsetY=0;context.shadowBlur=0;context.shadowColor="#000000"};var imgCache={};sigma.utils.canvas.drawImage=function(node,x,y,size,context,imgCrossOrigin,threshold,clipFn){if(!node.image||!node.image.url||size<threshold)return;var url=node.image.url;var ih=node.image.h||1;var iw=node.image.w||1;var scale=node.image.scale||1;var clip=node.image.clip||1;var image=imgCache[url];if(!image){image=document.createElement("IMG");image.setAttribute("crossOrigin",imgCrossOrigin);image.src=url;image.onload=function(){window.dispatchEvent(new Event("resize"))};imgCache[url]=image}var xratio=iw<ih?iw/ih:1;var yratio=ih<iw?ih/iw:1;var r=size*scale;context.save();context.beginPath();if(typeof clipFn==="function"){clipFn(node,x,y,size,context,clip)}else{context.arc(x,y,size*clip,0,Math.PI*2,true)}context.closePath();context.clip();context.drawImage(image,x+Math.sin(-3.142/4)*r*xratio,y-Math.cos(-3.142/4)*r*yratio,r*xratio*2*Math.sin(-3.142/4)*-1,r*yratio*2*Math.cos(-3.142/4));context.restore()};sigma.utils.canvas.drawIcon=function(node,x,y,size,context,threshold){if(!node.icon||size<threshold)return;var font=node.icon.font||"Arial",fgColor=node.icon.color||"#F00",text=node.icon.content||"?",px=node.icon.x||.5,py=node.icon.y||.5,height=size,width=size;var fontSizeRatio=.7;if(typeof node.icon.scale==="number"){fontSizeRatio=Math.abs(Math.max(.01,node.icon.scale))}var fontSize=Math.round(fontSizeRatio*height);context.save();context.fillStyle=fgColor;context.font=""+fontSize+"px "+font;context.textAlign="center";context.textBaseline="middle";context.fillText(text,x,y);context.restore()}}).call(this);(function(global){"use strict";var x,lastTime=0,vendors=["ms","moz","webkit","o"];for(x=0;x<vendors.length&&!global.requestAnimationFrame;x++){global.requestAnimationFrame=global[vendors[x]+"RequestAnimationFrame"];global.cancelAnimationFrame=global[vendors[x]+"CancelAnimationFrame"]||global[vendors[x]+"CancelRequestAnimationFrame"]}if(!global.requestAnimationFrame)global.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=global.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};if(!global.cancelAnimationFrame)global.cancelAnimationFrame=function(id){clearTimeout(id)};if(!Function.prototype.bind)Function.prototype.bind=function(oThis){if(typeof this!=="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP,fBound;fNOP=function(){};fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP;return fBound}})(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.settings");var settings={clone:false,immutable:true,verbose:false,classPrefix:"sigma",defaultNodeType:"def",defaultEdgeType:"def",defaultLabelColor:"#000",defaultEdgeColor:"#000",defaultNodeColor:"#000",defaultLabelSize:14,labelAlignment:"right",edgeColor:"source",minArrowSize:0,font:"arial",fontStyle:"",labelColor:"default",labelSize:"fixed",labelSizeRatio:1,labelThreshold:8,maxNodeLabelLineLength:0,webglOversamplingRatio:2,borderSize:0,defaultNodeBorderColor:"#000",hoverFont:"",singleHover:true,hoverFontStyle:"",labelHoverShadow:"default",labelHoverShadowColor:"#000",nodeHoverColor:"node",defaultNodeHoverColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverColor:"default",defaultLabelHoverColor:"#000",edgeHoverColor:"edge",edgeHoverSizeRatio:1,defaultEdgeHoverColor:"#000",edgeHoverExtremities:false,drawEdges:true,drawNodes:true,drawLabels:true,drawEdgeLabels:false,batchEdgesDrawing:false,hideEdgesOnMove:false,canvasEdgesBatchSize:500,webglEdgesBatchSize:1e3,approximateLabelWidth:true,edgesClippingWithNodes:true,autoCurveRatio:1,autoCurveSortByDirection:true,scalingMode:"inside",sideMargin:0,minEdgeSize:.5,maxEdgeSize:1,minNodeSize:1,maxNodeSize:8,touchEnabled:true,mouseEnabled:true,mouseWheelEnabled:true,doubleClickEnabled:true,eventsEnabled:true,zoomingRatio:1.7,doubleClickZoomingRatio:2.2,zoomMin:.0625,zoomMax:2,mouseZoomDuration:200,doubleClickZoomDuration:200,mouseInertiaDuration:200,mouseInertiaRatio:3,touchInertiaDuration:200,touchInertiaRatio:3,doubleClickTimeout:300,doubleTapTimeout:300,dragTimeout:200,autoResize:true,autoRescale:true,enableCamera:true,enableHovering:true,enableEdgeHovering:false,edgeHoverPrecision:5,rescaleIgnoreSize:false,skipErrors:false,nodeQuadtreeMaxLevel:4,edgeQuadtreeMaxLevel:4,nodesPowRatio:.5,edgesPowRatio:.5,animationsTime:200};sigma.settings=sigma.utils.extend(sigma.settings||{},settings)}).call(this);(function(){"use strict";var dispatcher=function(){Object.defineProperty(this,"_handlers",{value:{}})};dispatcher.prototype.bind=function(events,handler){var i,l,event,eArray;if(arguments.length===1&&typeof arguments[0]==="object")for(events in arguments[0])this.bind(events,arguments[0][events]);else if(arguments.length===2&&typeof arguments[1]==="function"){eArray=typeof events==="string"?events.split(" "):events;for(i=0,l=eArray.length;i!==l;i+=1){event=eArray[i];if(!event)continue;if(!this._handlers[event])this._handlers[event]=[];this._handlers[event].push({handler:handler})}}else throw"bind: Wrong arguments.";return this};dispatcher.prototype.unbind=function(events,handler){var i,n,j,m,k,a,event,eArray=typeof events==="string"?events.split(" "):events;if(!arguments.length){for(k in this._handlers)delete this._handlers[k];return this}if(handler){for(i=0,n=eArray.length;i!==n;i+=1){event=eArray[i];if(this._handlers[event]){a=[];for(j=0,m=this._handlers[event].length;j!==m;j+=1)if(this._handlers[event][j].handler!==handler)a.push(this._handlers[event][j]);
this._handlers[event]=a}if(this._handlers[event]&&this._handlers[event].length===0)delete this._handlers[event]}}else for(i=0,n=eArray.length;i!==n;i+=1)delete this._handlers[eArray[i]];return this};dispatcher.prototype.dispatchEvent=function(events,data){var i,n,j,m,a,event,eventName,self=this,eArray=typeof events==="string"?events.split(" "):events;data=data===undefined?{}:data;for(i=0,n=eArray.length;i!==n;i+=1){eventName=eArray[i];if(this._handlers[eventName]){event=self.getEvent(eventName,data);a=[];for(j=0,m=this._handlers[eventName].length;j!==m;j+=1){this._handlers[eventName][j].handler(event);if(!this._handlers[eventName][j].one)a.push(this._handlers[eventName][j])}this._handlers[eventName]=a}}return this};dispatcher.prototype.getEvent=function(event,data){return{type:event,data:data||{},target:this}};dispatcher.extend=function(target,args){var k;for(k in dispatcher.prototype)if(dispatcher.prototype.hasOwnProperty(k))target[k]=dispatcher.prototype[k];dispatcher.apply(target,args)};if(typeof this.sigma!=="undefined"){this.sigma.classes=this.sigma.classes||{};this.sigma.classes.dispatcher=dispatcher}else if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=dispatcher;exports.dispatcher=dispatcher}else this.dispatcher=dispatcher}).call(this);(function(){"use strict";var configurable=function(){var i,l,data={},datas=Array.prototype.slice.call(arguments,0);var settings=function(a1,a2){var o,i,l,k;if(arguments.length===1&&typeof a1==="string"){if(data[a1]!==undefined)return data[a1];for(i=0,l=datas.length;i<l;i++)if(datas[i][a1]!==undefined)return datas[i][a1];return undefined}else if(typeof a1==="object"&&typeof a2==="string"){return(a1||{})[a2]!==undefined?a1[a2]:settings(a2)}else{o=typeof a1==="object"&&a2===undefined?a1:{};if(typeof a1==="string")o[a1]=a2;for(i=0,k=Object.keys(o),l=k.length;i<l;i++)data[k[i]]=o[k[i]];return this}};settings.embedObjects=function(){var args=datas.concat(data).concat(Array.prototype.splice.call(arguments,0));return configurable.apply({},args)};for(i=0,l=arguments.length;i<l;i++)settings(arguments[i]);return settings};if(typeof this.sigma!=="undefined"){this.sigma.classes=this.sigma.classes||{};this.sigma.classes.configurable=configurable}else if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=configurable;exports.configurable=configurable}else this.configurable=configurable}).call(this);(function(undefined){"use strict";var _methods=Object.create(null),_indexes=Object.create(null),_initBindings=Object.create(null),_methodBindings=Object.create(null),_methodBeforeBindings=Object.create(null),_defaultSettings={immutable:true,clone:true},_defaultSettingsFunction=function(key){return _defaultSettings[key]};var graph=function(settings){var k,fn,data;data={settings:settings||_defaultSettingsFunction,nodesArray:[],edgesArray:[],nodesIndex:Object.create(null),edgesIndex:Object.create(null),inNeighborsIndex:Object.create(null),outNeighborsIndex:Object.create(null),allNeighborsIndex:Object.create(null),inNeighborsCount:Object.create(null),outNeighborsCount:Object.create(null),allNeighborsCount:Object.create(null)};for(k in _initBindings)_initBindings[k].call(data);for(k in _methods){fn=__bindGraphMethod(k,data,_methods[k]);this[k]=fn;data[k]=fn}};function __bindGraphMethod(methodName,scope,fn){var result=function(){var k,res;for(k in _methodBeforeBindings[methodName])_methodBeforeBindings[methodName][k].apply(scope,arguments);res=fn.apply(scope,arguments);for(k in _methodBindings[methodName])_methodBindings[methodName][k].apply(scope,arguments);return res};return result}function __emptyObject(obj){var k;for(k in obj)if(!("hasOwnProperty"in obj)||obj.hasOwnProperty(k))delete obj[k];return obj}graph.addMethod=function(methodName,fn){if(typeof methodName!=="string"||typeof fn!=="function"||arguments.length!==2)throw"addMethod: Wrong arguments.";if(_methods[methodName]||graph[methodName])throw'The method "'+methodName+'" already exists.';_methods[methodName]=fn;_methodBindings[methodName]=Object.create(null);_methodBeforeBindings[methodName]=Object.create(null);return this};graph.hasMethod=function(methodName){return!!(_methods[methodName]||graph[methodName])};graph.attach=function(methodName,key,fn,before){if(typeof methodName!=="string"||typeof key!=="string"||typeof fn!=="function"||arguments.length<3||arguments.length>4)throw"attach: Wrong arguments.";var bindings;if(methodName==="constructor")bindings=_initBindings;else{if(before){if(!_methodBeforeBindings[methodName])throw'The method "'+methodName+'" does not exist.';bindings=_methodBeforeBindings[methodName]}else{if(!_methodBindings[methodName])throw'The method "'+methodName+'" does not exist.';bindings=_methodBindings[methodName]}}if(bindings[key])throw'A function "'+key+'" is already attached '+'to the method "'+methodName+'".';bindings[key]=fn;return this};graph.attachBefore=function(methodName,key,fn){return this.attach(methodName,key,fn,true)};graph.addIndex=function(name,bindings){if(typeof name!=="string"||Object(bindings)!==bindings||arguments.length!==2)throw"addIndex: Wrong arguments.";if(_indexes[name])throw'The index "'+name+'" already exists.';var k;_indexes[name]=bindings;for(k in bindings)if(typeof bindings[k]!=="function")throw"The bindings must be functions.";else graph.attach(k,name,bindings[k]);return this};graph.addMethod("addNode",function(node){if(Object(node)!==node||arguments.length!==1)throw"addNode: Wrong arguments.";if(typeof node.id!=="string"&&typeof node.id!=="number")throw"The node must have a string or number id.";if(this.nodesIndex[node.id])throw'The node "'+node.id+'" already exists.';var k,id=node.id,validNode=Object.create(null);if(this.settings("clone")){for(k in node)if(k!=="id")validNode[k]=node[k]}else validNode=node;if(this.settings("immutable"))Object.defineProperty(validNode,"id",{value:id,enumerable:true});else validNode.id=id;this.inNeighborsIndex[id]=Object.create(null);this.outNeighborsIndex[id]=Object.create(null);this.allNeighborsIndex[id]=Object.create(null);this.inNeighborsCount[id]=0;this.outNeighborsCount[id]=0;this.allNeighborsCount[id]=0;this.nodesArray.push(validNode);this.nodesIndex[validNode.id]=validNode;return this});graph.addMethod("addEdge",function(edge){if(Object(edge)!==edge||arguments.length!==1)throw"addEdge: Wrong arguments.";if(typeof edge.id!=="string"&&typeof edge.id!=="number")throw"The edge must have a string or number id.";if(typeof edge.source!=="string"&&typeof edge.source!=="number"||!this.nodesIndex[edge.source])throw"The edge source must have an existing node id.";if(typeof edge.target!=="string"&&typeof edge.target!=="number"||!this.nodesIndex[edge.target])throw"The edge target must have an existing node id.";if(this.edgesIndex[edge.id])throw'The edge "'+edge.id+'" already exists.';var k,validEdge=Object.create(null);if(this.settings("clone")){for(k in edge)if(k!=="id"&&k!=="source"&&k!=="target")validEdge[k]=edge[k]}else validEdge=edge;if(this.settings("immutable")){Object.defineProperty(validEdge,"id",{value:edge.id,enumerable:true});Object.defineProperty(validEdge,"source",{value:edge.source,enumerable:true});Object.defineProperty(validEdge,"target",{value:edge.target,enumerable:true})}else{validEdge.id=edge.id;validEdge.source=edge.source;validEdge.target=edge.target}this.edgesArray.push(validEdge);this.edgesIndex[validEdge.id]=validEdge;if(!this.inNeighborsIndex[validEdge.target][validEdge.source])this.inNeighborsIndex[validEdge.target][validEdge.source]=Object.create(null);this.inNeighborsIndex[validEdge.target][validEdge.source][validEdge.id]=validEdge;if(!this.outNeighborsIndex[validEdge.source][validEdge.target])this.outNeighborsIndex[validEdge.source][validEdge.target]=Object.create(null);this.outNeighborsIndex[validEdge.source][validEdge.target][validEdge.id]=validEdge;if(!this.allNeighborsIndex[validEdge.source][validEdge.target])this.allNeighborsIndex[validEdge.source][validEdge.target]=Object.create(null);this.allNeighborsIndex[validEdge.source][validEdge.target][validEdge.id]=validEdge;if(validEdge.target!==validEdge.source){if(!this.allNeighborsIndex[validEdge.target][validEdge.source])this.allNeighborsIndex[validEdge.target][validEdge.source]=Object.create(null);this.allNeighborsIndex[validEdge.target][validEdge.source][validEdge.id]=validEdge}this.inNeighborsCount[validEdge.target]++;this.outNeighborsCount[validEdge.source]++;this.allNeighborsCount[validEdge.target]++;this.allNeighborsCount[validEdge.source]++;return this});graph.addMethod("dropNode",function(id){if(typeof id!=="string"&&typeof id!=="number"||arguments.length!==1)throw"dropNode: Wrong arguments.";if(!this.nodesIndex[id])throw'The node "'+id+'" does not exist.';var i,k,l;delete this.nodesIndex[id];for(i=0,l=this.nodesArray.length;i<l;i++)if(this.nodesArray[i].id===id){this.nodesArray.splice(i,1);break}for(i=this.edgesArray.length-1;i>=0;i--)if(this.edgesArray[i].source===id||this.edgesArray[i].target===id)this.dropEdge(this.edgesArray[i].id);delete this.inNeighborsIndex[id];delete this.outNeighborsIndex[id];delete this.allNeighborsIndex[id];delete this.inNeighborsCount[id];delete this.outNeighborsCount[id];delete this.allNeighborsCount[id];for(k in this.nodesIndex){delete this.inNeighborsIndex[k][id];delete this.outNeighborsIndex[k][id];delete this.allNeighborsIndex[k][id]}return this});graph.addMethod("dropEdge",function(id){if(typeof id!=="string"&&typeof id!=="number"||arguments.length!==1)throw"dropEdge: Wrong arguments.";if(!this.edgesIndex[id])throw'The edge "'+id+'" does not exist.';var i,l,edge;edge=this.edgesIndex[id];delete this.edgesIndex[id];for(i=0,l=this.edgesArray.length;i<l;i++)if(this.edgesArray[i].id===id){this.edgesArray.splice(i,1);break}delete this.inNeighborsIndex[edge.target][edge.source][edge.id];if(!Object.keys(this.inNeighborsIndex[edge.target][edge.source]).length)delete this.inNeighborsIndex[edge.target][edge.source];delete this.outNeighborsIndex[edge.source][edge.target][edge.id];if(!Object.keys(this.outNeighborsIndex[edge.source][edge.target]).length)delete this.outNeighborsIndex[edge.source][edge.target];delete this.allNeighborsIndex[edge.source][edge.target][edge.id];if(!Object.keys(this.allNeighborsIndex[edge.source][edge.target]).length)delete this.allNeighborsIndex[edge.source][edge.target];if(edge.target!==edge.source){delete this.allNeighborsIndex[edge.target][edge.source][edge.id];if(!Object.keys(this.allNeighborsIndex[edge.target][edge.source]).length)delete this.allNeighborsIndex[edge.target][edge.source]}this.inNeighborsCount[edge.target]--;this.outNeighborsCount[edge.source]--;this.allNeighborsCount[edge.source]--;this.allNeighborsCount[edge.target]--;return this});graph.addMethod("kill",function(){this.nodesArray.length=0;this.edgesArray.length=0;delete this.nodesArray;delete this.edgesArray;delete this.nodesIndex;delete this.edgesIndex;delete this.inNeighborsIndex;delete this.outNeighborsIndex;delete this.allNeighborsIndex;delete this.inNeighborsCount;delete this.outNeighborsCount;delete this.allNeighborsCount});graph.addMethod("clear",function(){this.nodesArray.length=0;this.edgesArray.length=0;__emptyObject(this.nodesIndex);__emptyObject(this.edgesIndex);__emptyObject(this.nodesIndex);__emptyObject(this.inNeighborsIndex);__emptyObject(this.outNeighborsIndex);__emptyObject(this.allNeighborsIndex);__emptyObject(this.inNeighborsCount);__emptyObject(this.outNeighborsCount);__emptyObject(this.allNeighborsCount);return this});graph.addMethod("read",function(g){var i,a,l;a=g.nodes||[];for(i=0,l=a.length;i<l;i++)this.addNode(a[i]);a=g.edges||[];for(i=0,l=a.length;i<l;i++)this.addEdge(a[i]);return this});graph.addMethod("nodes",function(v){if(!arguments.length)return this.nodesArray.slice(0);if(arguments.length===1&&(typeof v==="string"||typeof v==="number"))return this.nodesIndex[v];if(arguments.length===1&&Object.prototype.toString.call(v)==="[object Array]"){var i,l,a=[];for(i=0,l=v.length;i<l;i++)if(typeof v[i]==="string"||typeof v[i]==="number")a.push(this.nodesIndex[v[i]]);else throw"nodes: Wrong arguments.";return a}throw"nodes: Wrong arguments."});graph.addMethod("degree",function(v,which){which={in:this.inNeighborsCount,out:this.outNeighborsCount}[which||""]||this.allNeighborsCount;if(typeof v==="string"||typeof v==="number")return which[v];if(Object.prototype.toString.call(v)==="[object Array]"){var i,l,a=[];for(i=0,l=v.length;i<l;i++)if(typeof v[i]==="string"||typeof v[i]==="number")a.push(which[v[i]]);else throw"degree: Wrong arguments.";return a}throw"degree: Wrong arguments."});graph.addMethod("edges",function(v){if(!arguments.length)return this.edgesArray.slice(0);if(arguments.length===1&&(typeof v==="string"||typeof v==="number"))return this.edgesIndex[v];if(arguments.length===1&&Object.prototype.toString.call(v)==="[object Array]"){var i,l,a=[];for(i=0,l=v.length;i<l;i++)if(typeof v[i]==="string"||typeof v[i]==="number")a.push(this.edgesIndex[v[i]]);else throw"edges: Wrong arguments.";return a}throw"edges: Wrong arguments."});if(typeof sigma!=="undefined"){sigma.classes=sigma.classes||Object.create(null);sigma.classes.graph=graph}else if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=graph;exports.graph=graph}else this.graph=graph}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.classes");sigma.classes.camera=function(id,graph,settings,options){sigma.classes.dispatcher.extend(this);Object.defineProperty(this,"graph",{value:graph});Object.defineProperty(this,"id",{value:id});Object.defineProperty(this,"readPrefix",{value:"read_cam"+id+":"});Object.defineProperty(this,"prefix",{value:"cam"+id+":"});this.x=0;this.y=0;this.ratio=1;this.angle=0;this.isAnimated=false;this.settings=typeof options==="object"&&options?settings.embedObject(options):settings};sigma.classes.camera.prototype.goTo=function(coordinates){if(!this.settings("enableCamera"))return this;var i,l,c=coordinates||{},keys=["x","y","ratio","angle"];for(i=0,l=keys.length;i<l;i++)if(c[keys[i]]!==undefined){if(typeof c[keys[i]]==="number"&&!isNaN(c[keys[i]]))this[keys[i]]=c[keys[i]];else throw'Value for "'+keys[i]+'" is not a number.'}this.dispatchEvent("coordinatesUpdated");return this};sigma.classes.camera.prototype.applyView=function(read,write,options){options=options||{};write=write!==undefined?write:this.prefix;read=read!==undefined?read:this.readPrefix;var nodes=options.nodes||this.graph.nodes(),edges=options.edges||this.graph.edges();var i,l,node,cos=Math.cos(this.angle),sin=Math.sin(this.angle),nodeRatio=Math.pow(this.ratio,this.settings("nodesPowRatio")),edgeRatio=Math.pow(this.ratio,this.settings("edgesPowRatio"));for(i=0,l=nodes.length;i<l;i++){node=nodes[i];node[write+"x"]=(((node[read+"x"]||0)-this.x)*cos+((node[read+"y"]||0)-this.y)*sin)/this.ratio+(options.width||0)/2;node[write+"y"]=(((node[read+"y"]||0)-this.y)*cos-((node[read+"x"]||0)-this.x)*sin)/this.ratio+(options.height||0)/2;node[write+"size"]=(node[read+"size"]||0)/nodeRatio}for(i=0,l=edges.length;i<l;i++){edges[i][write+"size"]=(edges[i][read+"size"]||0)/edgeRatio}return this};sigma.classes.camera.prototype.graphPosition=function(x,y,vector){var X=0,Y=0,cos=Math.cos(this.angle),sin=Math.sin(this.angle);if(!vector){X=-(this.x*cos+this.y*sin)/this.ratio;Y=-(this.y*cos-this.x*sin)/this.ratio}return{x:(x*cos+y*sin)/this.ratio+X,y:(y*cos-x*sin)/this.ratio+Y}};sigma.classes.camera.prototype.cameraPosition=function(x,y,vector){var X=0,Y=0,cos=Math.cos(this.angle),sin=Math.sin(this.angle);if(!vector){X=-(this.x*cos+this.y*sin)/this.ratio;Y=-(this.y*cos-this.x*sin)/this.ratio}return{x:((x-X)*cos-(y-Y)*sin)*this.ratio,y:((y-Y)*cos+(x-X)*sin)*this.ratio}};sigma.classes.camera.prototype.getMatrix=function(){var scale=sigma.utils.matrices.scale(1/this.ratio),rotation=sigma.utils.matrices.rotation(this.angle),translation=sigma.utils.matrices.translation(-this.x,-this.y),matrix=sigma.utils.matrices.multiply(translation,sigma.utils.matrices.multiply(rotation,scale));return matrix};sigma.classes.camera.prototype.getRectangle=function(width,height){var widthVect=this.cameraPosition(width,0,true),heightVect=this.cameraPosition(0,height,true),centerVect=this.cameraPosition(width/2,height/2,true),marginX=this.cameraPosition(width/4,0,true).x,marginY=this.cameraPosition(0,height/4,true).y;return{x1:this.x-centerVect.x-marginX,y1:this.y-centerVect.y-marginY,x2:this.x-centerVect.x+marginX+widthVect.x,y2:this.y-centerVect.y-marginY+widthVect.y,height:Math.sqrt(Math.pow(heightVect.x,2)+Math.pow(heightVect.y+2*marginY,2))}}}).call(this);(function(undefined){"use strict";var _geom={pointToSquare:function(n){return{x1:n.x-n.size,y1:n.y-n.size,x2:n.x+n.size,y2:n.y-n.size,height:n.size*2}},lineToSquare:function(e){if(e.y1<e.y2){if(e.x1<e.x2){return{x1:e.x1-e.size,y1:e.y1-e.size,x2:e.x2+e.size,y2:e.y1-e.size,height:e.y2-e.y1+e.size*2}}return{x1:e.x2-e.size,y1:e.y1-e.size,x2:e.x1+e.size,y2:e.y1-e.size,height:e.y2-e.y1+e.size*2}}if(e.x1<e.x2){return{x1:e.x1-e.size,y1:e.y2-e.size,x2:e.x2+e.size,y2:e.y2-e.size,height:e.y1-e.y2+e.size*2}}return{x1:e.x2-e.size,y1:e.y2-e.size,x2:e.x1+e.size,y2:e.y2-e.size,height:e.y1-e.y2+e.size*2}},quadraticCurveToSquare:function(e,cp){var pt=sigma.utils.getPointOnQuadraticCurve(.5,e.x1,e.y1,e.x2,e.y2,cp.x,cp.y);var minX=Math.min(e.x1,e.x2,pt.x),maxX=Math.max(e.x1,e.x2,pt.x),minY=Math.min(e.y1,e.y2,pt.y),maxY=Math.max(e.y1,e.y2,pt.y);return{x1:minX-e.size,y1:minY-e.size,x2:maxX+e.size,y2:minY-e.size,height:maxY-minY+e.size*2}},selfLoopToSquare:function(n){var cp=sigma.utils.getSelfLoopControlPoints(n.x,n.y,n.size);var minX=Math.min(n.x,cp.x1,cp.x2),maxX=Math.max(n.x,cp.x1,cp.x2),minY=Math.min(n.y,cp.y1,cp.y2),maxY=Math.max(n.y,cp.y1,cp.y2);return{x1:minX-n.size,y1:minY-n.size,x2:maxX+n.size,y2:minY-n.size,height:maxY-minY+n.size*2}},isAxisAligned:function(r){return r.x1===r.x2||r.y1===r.y2},axisAlignedTopPoints:function(r){if(r.y1===r.y2&&r.x1<r.x2)return r;if(r.x1===r.x2&&r.y2>r.y1)return{x1:r.x1-r.height,y1:r.y1,x2:r.x1,y2:r.y1,height:r.height};if(r.x1===r.x2&&r.y2<r.y1)return{x1:r.x1,y1:r.y2,x2:r.x2+r.height,y2:r.y2,height:r.height};return{x1:r.x2,y1:r.y1-r.height,x2:r.x1,y2:r.y1-r.height,height:r.height}},lowerLeftCoor:function(r){var width=Math.sqrt((r.x2-r.x1)*(r.x2-r.x1)+(r.y2-r.y1)*(r.y2-r.y1));return{x:r.x1-(r.y2-r.y1)*r.height/width,y:r.y1+(r.x2-r.x1)*r.height/width}},lowerRightCoor:function(r,llc){return{x:llc.x-r.x1+r.x2,y:llc.y-r.y1+r.y2}},rectangleCorners:function(r){var llc=this.lowerLeftCoor(r),lrc=this.lowerRightCoor(r,llc);return[{x:r.x1,y:r.y1},{x:r.x2,y:r.y2},{x:llc.x,y:llc.y},{x:lrc.x,y:lrc.y}]},splitSquare:function(b){return[[{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width/2,y:b.y+b.height/2}],[{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x+b.width/2,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2}],[{x:b.x,y:b.y+b.height/2},{x:b.x+b.width/2,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height}],[{x:b.x+b.width/2,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]]},axis:function(c1,c2){return[{x:c1[1].x-c1[0].x,y:c1[1].y-c1[0].y},{x:c1[1].x-c1[3].x,y:c1[1].y-c1[3].y},{x:c2[0].x-c2[2].x,y:c2[0].y-c2[2].y},{x:c2[0].x-c2[1].x,y:c2[0].y-c2[1].y}]},projection:function(c,a){var l=(c.x*a.x+c.y*a.y)/(a.x*a.x+a.y*a.y);return{x:l*a.x,y:l*a.y}},axisCollision:function(a,c1,c2){var sc1=[],sc2=[];for(var ci=0;ci<4;ci++){var p1=this.projection(c1[ci],a),p2=this.projection(c2[ci],a);sc1.push(p1.x*a.x+p1.y*a.y);sc2.push(p2.x*a.x+p2.y*a.y)}var maxc1=Math.max.apply(Math,sc1),maxc2=Math.max.apply(Math,sc2),minc1=Math.min.apply(Math,sc1),minc2=Math.min.apply(Math,sc2);return minc2<=maxc1&&maxc2>=minc1},collision:function(c1,c2){var axis=this.axis(c1,c2),col=true;for(var i=0;i<4;i++)col=col&&this.axisCollision(axis[i],c1,c2);return col}};function _quadIndex(point,quadBounds){var xmp=quadBounds.x+quadBounds.width/2,ymp=quadBounds.y+quadBounds.height/2,top=point.y<ymp,left=point.x<xmp;if(top){if(left)return 0;else return 1}else{if(left)return 2;else return 3}}function _quadIndexes(rectangle,quadCorners){var indexes=[];for(var i=0;i<4;i++)if(rectangle.x2>=quadCorners[i][0].x&&rectangle.x1<=quadCorners[i][1].x&&rectangle.y1+rectangle.height>=quadCorners[i][0].y&&rectangle.y1<=quadCorners[i][2].y)indexes.push(i);return indexes}function _quadCollision(corners,quadCorners){var indexes=[];for(var i=0;i<4;i++)if(_geom.collision(corners,quadCorners[i]))indexes.push(i);return indexes}function _quadSubdivide(index,quad){var next=quad.level+1,subw=Math.round(quad.bounds.width/2),subh=Math.round(quad.bounds.height/2),qx=Math.round(quad.bounds.x),qy=Math.round(quad.bounds.y),x,y;switch(index){case 0:x=qx;y=qy;break;case 1:x=qx+subw;y=qy;break;case 2:x=qx;y=qy+subh;break;case 3:x=qx+subw;y=qy+subh;break}return _quadTree({x:x,y:y,width:subw,height:subh},next,quad.maxElements,quad.maxLevel)}function _quadInsert(el,sizedPoint,quad){if(quad.level<quad.maxLevel){var indexes=_quadIndexes(sizedPoint,quad.corners);for(var i=0,l=indexes.length;i<l;i++){if(quad.nodes[indexes[i]]===undefined)quad.nodes[indexes[i]]=_quadSubdivide(indexes[i],quad);_quadInsert(el,sizedPoint,quad.nodes[indexes[i]])}}else{quad.elements.push(el)}}function _quadRetrievePoint(point,quad){if(quad.level<quad.maxLevel){var index=_quadIndex(point,quad.bounds);if(quad.nodes[index]!==undefined){return _quadRetrievePoint(point,quad.nodes[index])}else{return[]}}else{return quad.elements}}function _quadRetrieveArea(rectData,quad,collisionFunc,els){els=els||{};if(quad.level<quad.maxLevel){var indexes=collisionFunc(rectData,quad.corners);for(var i=0,l=indexes.length;i<l;i++)if(quad.nodes[indexes[i]]!==undefined)_quadRetrieveArea(rectData,quad.nodes[indexes[i]],collisionFunc,els)}else for(var j=0,m=quad.elements.length;j<m;j++)if(els[quad.elements[j].id]===undefined)els[quad.elements[j].id]=quad.elements[j];return els}function _quadTree(bounds,level,maxElements,maxLevel){return{level:level||0,bounds:bounds,corners:_geom.splitSquare(bounds),maxElements:maxElements||20,maxLevel:maxLevel||4,elements:[],nodes:[]}}var quad=function(indexEdges){this._geom=_geom;this._tree=null;this._cache={query:false,result:false};this._enabled=true;this._indexEdges=indexEdges||false};quad.prototype.index=function(graph,params){if(!this._enabled){return this._tree}if(!params.bounds)throw"sigma.classes.quad.index: bounds information not given.";var prefix=params.prefix||"",cp,cc=params.curvatureCoefficients,source,target,i,l,n,e;this._tree=_quadTree(params.bounds,0,params.maxElements,params.maxLevel);if(!this._indexEdges){var nodes=graph.nodes();for(i=0,l=nodes.length;i<l;i++){_quadInsert(nodes[i],_geom.pointToSquare({x:nodes[i][prefix+"x"],y:nodes[i][prefix+"y"],size:nodes[i][prefix+"size"]}),this._tree)}}else{var edges=graph.edges();for(i=0,l=edges.length;i<l;i++){source=graph.nodes(edges[i].source);target=graph.nodes(edges[i].target);e={x1:source[prefix+"x"],y1:source[prefix+"y"],x2:target[prefix+"x"],y2:target[prefix+"y"],size:edges[i][prefix+"size"]||0};if(edges[i].type==="curve"||edges[i].type==="curvedArrow"){if(source.id===target.id){n={x:source[prefix+"x"],y:source[prefix+"y"],size:source[prefix+"size"]||0};_quadInsert(edges[i],_geom.selfLoopToSquare(n),this._tree)}else{cp=sigma.utils.getQuadraticControlPoint(e.x1,e.y1,e.x2,e.y2,edges[i].cc||cc);_quadInsert(edges[i],_geom.quadraticCurveToSquare(e,cp),this._tree)}}else{_quadInsert(edges[i],_geom.lineToSquare(e),this._tree)}}}this._cache={query:false,result:false};return this._tree};quad.prototype.point=function(x,y){if(!this._enabled)return[];return this._tree?_quadRetrievePoint({x:x,y:y},this._tree)||[]:[]};quad.prototype.area=function(rect){if(!this._enabled)return[];var serialized=JSON.stringify(rect),collisionFunc,rectData;if(this._cache.query===serialized)return this._cache.result;if(_geom.isAxisAligned(rect)){collisionFunc=_quadIndexes;rectData=_geom.axisAlignedTopPoints(rect)}else{collisionFunc=_quadCollision;rectData=_geom.rectangleCorners(rect)}var elements=this._tree?_quadRetrieveArea(rectData,this._tree,collisionFunc):[];var elementsArr=[];for(var i in elements)elementsArr.push(elements[i]);this._cache.query=serialized;this._cache.result=elementsArr;return elementsArr};if(typeof this.sigma!=="undefined"){this.sigma.classes=this.sigma.classes||{};this.sigma.classes.quad=quad;this.sigma.classes.edgequad=quad.bind(this,true)}else if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports)exports=module.exports=quad;exports.quad=quad}else this.quad=quad}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.captors");sigma.captors.mouse=function(target,camera,settings){var _self=this,_target=target,_camera=camera,_settings=settings,_startCameraX,_startCameraY,_startCameraAngle,_lastCameraX,_lastCameraY,_lastCameraAngle,_lastCameraRatio,_startMouseX,_startMouseY,_isMouseDown,_isMoving,_hasDragged,_downStartTime,_movingTimeoutId;sigma.classes.dispatcher.extend(this);sigma.utils.doubleClick(_target,"click",_doubleClickHandler);_target.addEventListener("DOMMouseScroll",_wheelHandler,false);_target.addEventListener("mousewheel",_wheelHandler,false);_target.addEventListener("mousemove",_moveHandler,false);_target.addEventListener("mousedown",_downHandler,false);_target.addEventListener("click",_clickHandler,false);_target.addEventListener("mouseout",_outHandler,false);document.addEventListener("mouseup",_upHandler,false);this.kill=function(){sigma.utils.unbindDoubleClick(_target,"click");_target.removeEventListener("DOMMouseScroll",_wheelHandler);_target.removeEventListener("mousewheel",_wheelHandler);_target.removeEventListener("mousemove",_moveHandler);_target.removeEventListener("mousedown",_downHandler);_target.removeEventListener("click",_clickHandler);_target.removeEventListener("mouseout",_outHandler);document.removeEventListener("mouseup",_upHandler)};function _moveHandler(e){var x,y,pos;if(_settings("mouseEnabled")){_self.dispatchEvent("mousemove",sigma.utils.mouseCoords(e));if(_isMouseDown){_isMoving=true;_hasDragged=true;if(_movingTimeoutId)clearTimeout(_movingTimeoutId);_movingTimeoutId=setTimeout(function(){_isMoving=false},_settings("dragTimeout"));sigma.misc.animation.killAll(_camera);_camera.isMoving=true;pos=_camera.cameraPosition(sigma.utils.getX(e)-_startMouseX,sigma.utils.getY(e)-_startMouseY,true);x=_startCameraX-pos.x;y=_startCameraY-pos.y;if(x!==_camera.x||y!==_camera.y){_lastCameraX=_camera.x;_lastCameraY=_camera.y;_camera.goTo({x:x,y:y})}if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.stopPropagation();return false}}}function _upHandler(e){if(_settings("mouseEnabled")&&_isMouseDown){_isMouseDown=false;if(_movingTimeoutId)clearTimeout(_movingTimeoutId);_camera.isMoving=false;var x=sigma.utils.getX(e),y=sigma.utils.getY(e);if(_isMoving){sigma.misc.animation.killAll(_camera);sigma.misc.animation.camera(_camera,{x:_camera.x+_settings("mouseInertiaRatio")*(_camera.x-_lastCameraX),y:_camera.y+_settings("mouseInertiaRatio")*(_camera.y-_lastCameraY)},{easing:"quadraticOut",duration:_settings("mouseInertiaDuration")})}else if(_startMouseX!==x||_startMouseY!==y)_camera.goTo({x:_camera.x,y:_camera.y});_self.dispatchEvent("mouseup",sigma.utils.mouseCoords(e));_isMoving=false}}function _downHandler(e){if(_settings("mouseEnabled")){_startCameraX=_camera.x;_startCameraY=_camera.y;_lastCameraX=_camera.x;_lastCameraY=_camera.y;_startMouseX=sigma.utils.getX(e);_startMouseY=sigma.utils.getY(e);_hasDragged=false;_downStartTime=(new Date).getTime();switch(e.which){case 2:break;case 3:_self.dispatchEvent("rightclick",sigma.utils.mouseCoords(e,_startMouseX,_startMouseY));break;default:_isMouseDown=true;_self.dispatchEvent("mousedown",sigma.utils.mouseCoords(e,_startMouseX,_startMouseY))}}}function _outHandler(e){if(_settings("mouseEnabled"))_self.dispatchEvent("mouseout")}function _clickHandler(e){if(_settings("mouseEnabled")){var event=sigma.utils.mouseCoords(e);event.isDragging=(new Date).getTime()-_downStartTime>100&&_hasDragged;_self.dispatchEvent("click",event)}if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.stopPropagation();return false}function _doubleClickHandler(e){var pos,ratio,animation;if(_settings("mouseEnabled")){ratio=1/_settings("doubleClickZoomingRatio");_self.dispatchEvent("doubleclick",sigma.utils.mouseCoords(e,_startMouseX,_startMouseY));if(_settings("doubleClickEnabled")){pos=_camera.cameraPosition(sigma.utils.getX(e)-sigma.utils.getCenter(e).x,sigma.utils.getY(e)-sigma.utils.getCenter(e).y,true);animation={duration:_settings("doubleClickZoomDuration")};sigma.utils.zoomTo(_camera,pos.x,pos.y,ratio,animation)}if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.stopPropagation();return false}}function _wheelHandler(e){var pos,ratio,animation;if(_settings("mouseEnabled")&&_settings("mouseWheelEnabled")){ratio=sigma.utils.getDelta(e)>0?1/_settings("zoomingRatio"):_settings("zoomingRatio");pos=_camera.cameraPosition(sigma.utils.getX(e)-sigma.utils.getCenter(e).x,sigma.utils.getY(e)-sigma.utils.getCenter(e).y,true);animation={duration:_settings("mouseZoomDuration")};sigma.utils.zoomTo(_camera,pos.x,pos.y,ratio,animation);if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.stopPropagation();return false}}}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.captors");sigma.captors.touch=function(target,camera,settings){var _self=this,_target=target,_camera=camera,_settings=settings,_startCameraX,_startCameraY,_startCameraAngle,_startCameraRatio,_lastCameraX,_lastCameraY,_lastCameraAngle,_lastCameraRatio,_downTouches=[],_startTouchX0,_startTouchY0,_startTouchX1,_startTouchY1,_startTouchAngle,_startTouchDistance,_touchMode,_isMoving,_doubleTap,_movingTimeoutId;sigma.classes.dispatcher.extend(this);sigma.utils.doubleClick(_target,"touchstart",_doubleTapHandler);_target.addEventListener("touchstart",_handleStart,false);_target.addEventListener("touchend",_handleLeave,false);_target.addEventListener("touchcancel",_handleLeave,false);_target.addEventListener("touchleave",_handleLeave,false);_target.addEventListener("touchmove",_handleMove,false);function position(e){var offset=sigma.utils.getOffset(_target);return{x:e.pageX-offset.left,y:e.pageY-offset.top}}this.kill=function(){sigma.utils.unbindDoubleClick(_target,"touchstart");_target.addEventListener("touchstart",_handleStart);_target.addEventListener("touchend",_handleLeave);_target.addEventListener("touchcancel",_handleLeave);_target.addEventListener("touchleave",_handleLeave);_target.addEventListener("touchmove",_handleMove)};function _handleStart(e){if(_settings("touchEnabled")){var x0,x1,y0,y1,pos0,pos1;_downTouches=e.touches;switch(_downTouches.length){case 1:_camera.isMoving=true;_touchMode=1;_startCameraX=_camera.x;_startCameraY=_camera.y;_lastCameraX=_camera.x;_lastCameraY=_camera.y;pos0=position(_downTouches[0]);_startTouchX0=pos0.x;_startTouchY0=pos0.y;break;case 2:_camera.isMoving=true;_touchMode=2;pos0=position(_downTouches[0]);pos1=position(_downTouches[1]);x0=pos0.x;y0=pos0.y;x1=pos1.x;y1=pos1.y;_lastCameraX=_camera.x;_lastCameraY=_camera.y;_startCameraAngle=_camera.angle;_startCameraRatio=_camera.ratio;_startCameraX=_camera.x;_startCameraY=_camera.y;_startTouchX0=x0;_startTouchY0=y0;_startTouchX1=x1;_startTouchY1=y1;_startTouchAngle=Math.atan2(_startTouchY1-_startTouchY0,_startTouchX1-_startTouchX0);_startTouchDistance=Math.sqrt((_startTouchY1-_startTouchY0)*(_startTouchY1-_startTouchY0)+(_startTouchX1-_startTouchX0)*(_startTouchX1-_startTouchX0));e.preventDefault();return false}}}function _handleLeave(e){if(_settings("touchEnabled")){_downTouches=e.touches;var inertiaRatio=_settings("touchInertiaRatio");if(_movingTimeoutId){
_isMoving=false;clearTimeout(_movingTimeoutId)}switch(_touchMode){case 2:if(e.touches.length===1){_handleStart(e);e.preventDefault();break}case 1:_camera.isMoving=false;_self.dispatchEvent("stopDrag");if(_isMoving){_doubleTap=false;sigma.misc.animation.camera(_camera,{x:_camera.x+inertiaRatio*(_camera.x-_lastCameraX),y:_camera.y+inertiaRatio*(_camera.y-_lastCameraY)},{easing:"quadraticOut",duration:_settings("touchInertiaDuration")})}_isMoving=false;_touchMode=0;break}}}function _handleMove(e){if(!_doubleTap&&_settings("touchEnabled")){var x0,x1,y0,y1,cos,sin,end,pos0,pos1,diff,start,dAngle,dRatio,newStageX,newStageY,newStageRatio,newStageAngle;_downTouches=e.touches;_isMoving=true;if(_movingTimeoutId)clearTimeout(_movingTimeoutId);_movingTimeoutId=setTimeout(function(){_isMoving=false},_settings("dragTimeout"));switch(_touchMode){case 1:pos0=position(_downTouches[0]);x0=pos0.x;y0=pos0.y;diff=_camera.cameraPosition(x0-_startTouchX0,y0-_startTouchY0,true);newStageX=_startCameraX-diff.x;newStageY=_startCameraY-diff.y;if(newStageX!==_camera.x||newStageY!==_camera.y){_lastCameraX=_camera.x;_lastCameraY=_camera.y;_camera.goTo({x:newStageX,y:newStageY});_self.dispatchEvent("mousemove",sigma.utils.mouseCoords(e,pos0.x,pos0.y));_self.dispatchEvent("drag")}break;case 2:pos0=position(_downTouches[0]);pos1=position(_downTouches[1]);x0=pos0.x;y0=pos0.y;x1=pos1.x;y1=pos1.y;start=_camera.cameraPosition((_startTouchX0+_startTouchX1)/2-sigma.utils.getCenter(e).x,(_startTouchY0+_startTouchY1)/2-sigma.utils.getCenter(e).y,true);end=_camera.cameraPosition((x0+x1)/2-sigma.utils.getCenter(e).x,(y0+y1)/2-sigma.utils.getCenter(e).y,true);dAngle=Math.atan2(y1-y0,x1-x0)-_startTouchAngle;dRatio=Math.sqrt((y1-y0)*(y1-y0)+(x1-x0)*(x1-x0))/_startTouchDistance;x0=start.x;y0=start.y;newStageRatio=_startCameraRatio/dRatio;x0=x0*dRatio;y0=y0*dRatio;newStageAngle=_startCameraAngle-dAngle;cos=Math.cos(-dAngle);sin=Math.sin(-dAngle);x1=x0*cos+y0*sin;y1=y0*cos-x0*sin;x0=x1;y0=y1;newStageX=x0-end.x+_startCameraX;newStageY=y0-end.y+_startCameraY;if(newStageRatio!==_camera.ratio||newStageAngle!==_camera.angle||newStageX!==_camera.x||newStageY!==_camera.y){_lastCameraX=_camera.x;_lastCameraY=_camera.y;_lastCameraAngle=_camera.angle;_lastCameraRatio=_camera.ratio;_camera.goTo({x:newStageX,y:newStageY,angle:newStageAngle,ratio:newStageRatio});_self.dispatchEvent("drag")}break}e.preventDefault();return false}}function _doubleTapHandler(e){var pos,ratio,animation;if(e.touches&&e.touches.length===1&&_settings("touchEnabled")){_doubleTap=true;ratio=1/_settings("doubleClickZoomingRatio");pos=position(e.touches[0]);_self.dispatchEvent("doubleclick",sigma.utils.mouseCoords(e,pos.x,pos.y));if(_settings("doubleClickEnabled")){pos=_camera.cameraPosition(pos.x-sigma.utils.getCenter(e).x,pos.y-sigma.utils.getCenter(e).y,true);animation={duration:_settings("doubleClickZoomDuration"),onComplete:function(){_doubleTap=false}};sigma.utils.zoomTo(_camera,pos.x,pos.y,ratio,animation)}if(e.preventDefault)e.preventDefault();else e.returnValue=false;e.stopPropagation();return false}}}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";if(typeof conrad==="undefined")throw"conrad is not declared";sigma.utils.pkg("sigma.renderers");sigma.renderers.canvas=function(graph,camera,settings,options){if(typeof options!=="object")throw"sigma.renderers.canvas: Wrong arguments.";if(!(options.container instanceof HTMLElement))throw"Container not found.";var i,l,a,fn,self=this;sigma.classes.dispatcher.extend(this);Object.defineProperty(this,"conradId",{value:sigma.utils.id()});this.graph=graph;this.camera=camera;this.contexts={};this.domElements={};this.options=options;this.container=this.options.container;this.settings=typeof options.settings==="object"&&options.settings?settings.embedObjects(options.settings):settings;this.nodesOnScreen=[];this.edgesOnScreen=[];this.jobs={};this.options.prefix="renderer"+this.conradId+":";if(!this.settings("batchEdgesDrawing")){this.initDOM("canvas","scene");this.contexts.edges=this.contexts.scene;this.contexts.nodes=this.contexts.scene;this.contexts.labels=this.contexts.scene}else{this.initDOM("canvas","edges");this.initDOM("canvas","scene");this.contexts.nodes=this.contexts.scene;this.contexts.labels=this.contexts.scene}this.initDOM("canvas","mouse");this.contexts.hover=this.contexts.mouse;this.captors=[];a=this.options.captors||[sigma.captors.mouse,sigma.captors.touch];for(i=0,l=a.length;i<l;i++){fn=typeof a[i]==="function"?a[i]:sigma.captors[a[i]];this.captors.push(new fn(this.domElements.mouse,this.camera,this.settings))}sigma.misc.bindEvents.call(this,this.options.prefix);sigma.misc.drawHovers.call(this,this.options.prefix);this.resize(false)};sigma.renderers.canvas.applyRenderers=function(params){var i,renderer,specializedRenderer,def,render,els=params.elements,ctx_infos={font:params.ctx.font},elementType=params.elements||params.type=="edges"?"defaultEdgeType":"defaultNodeType";params.start=params.start||0;params.end=params.end||params.elements.length;params.end=Math.min(params.elements.length,params.end);params.ctx.save();for(i=params.start;i<params.end;i++){if(!els[i].hidden){specializedRenderer=params.renderers[els[i].type||params.settings(elementType)];def=specializedRenderer||params.renderers.def;if(params.type=="edges"){def(els[i],params.graph.nodes(els[i].source),params.graph.nodes(els[i].target),params.ctx,params.settings,{ctx:ctx_infos})}else{def(els[i],params.ctx,params.settings,{ctx:ctx_infos})}}}params.ctx.restore()};sigma.renderers.canvas.prototype.renderEdges=function(start,end,settings){var renderParams={renderers:sigma.canvas.edges,type:"edges",elements:this.edgesOnScreen,ctx:this.contexts.edges,start:start,end:end,graph:this.graph,settings:settings};sigma.renderers.canvas.applyRenderers(renderParams);if(settings("drawEdgeLabels")){renderParams.renderers=sigma.canvas.edges.labels;renderParams.ctx=this.contexts.labels;sigma.renderers.canvas.applyRenderers(renderParams)}};sigma.renderers.canvas.prototype.render=function(options){options=options||{};this.dispatchEvent("beforeRender");var a,i,k,l,o,id,end,job,start,edges,batchSize,tempGCO,index={},graph=this.graph,nodes=this.graph.nodes,prefix=this.options.prefix||"",drawEdges=this.settings(options,"drawEdges"),drawNodes=this.settings(options,"drawNodes"),drawLabels=this.settings(options,"drawLabels"),embedSettings=this.settings.embedObjects(options,{prefix:this.options.prefix});this.resize(false);if(this.settings(options,"hideEdgesOnMove"))if(this.camera.isAnimated||this.camera.isMoving)drawEdges=false;this.camera.applyView(undefined,this.options.prefix,{width:this.width,height:this.height});this.clear();for(k in this.jobs)if(conrad.hasJob(k))conrad.killJob(k);this.nodesOnScreen=this.camera.quadtree.area(this.camera.getRectangle(this.width,this.height));for(a=this.nodesOnScreen,i=0,l=a.length;i<l;i++)index[a[i].id]=a[i];if(drawEdges){this.edgesOnScreen=[];if(embedSettings("edgesClippingWithNodes")){for(a=graph.edges(),i=0,l=a.length;i<l;i++){o=a[i];if((index[o.source]||index[o.target])&&(!o.hidden&&!nodes(o.source).hidden&&!nodes(o.target).hidden))this.edgesOnScreen.push(o)}}else{this.edgesOnScreen=this.camera.edgequadtree.area(this.camera.getRectangle(this.width,this.height))}if(embedSettings("batchEdgesDrawing")){id="edges_"+this.conradId;batchSize=embedSettings("canvasEdgesBatchSize");edges=this.edgesOnScreen;l=edges.length;start=0;end=Math.min(edges.length,start+batchSize);job=function(){tempGCO=this.contexts.edges.globalCompositeOperation;this.contexts.edges.globalCompositeOperation="destination-over";this.renderEdges(start,end,embedSettings);this.contexts.edges.globalCompositeOperation=tempGCO;if(end===edges.length){delete this.jobs[id];return false}start=end+1;end=Math.min(edges.length,start+batchSize);return true};this.jobs[id]=job;conrad.addJob(id,job.bind(this))}else{this.renderEdges(0,this.edgesOnScreen.length,embedSettings)}}if(drawNodes){sigma.renderers.canvas.applyRenderers({renderers:sigma.canvas.nodes,type:"nodes",ctx:this.contexts.nodes,elements:this.nodesOnScreen,settings:embedSettings})}if(drawLabels){sigma.renderers.canvas.applyRenderers({renderers:sigma.canvas.labels,type:"nodes",ctx:this.contexts.labels,elements:this.nodesOnScreen,settings:embedSettings})}this.dispatchEvent("render");return this};sigma.renderers.canvas.prototype.initDOM=function(tag,id){var dom=document.createElement(tag);dom.style.position="absolute";dom.setAttribute("class","sigma-"+id);this.domElements[id]=dom;this.container.appendChild(dom);if(tag.toLowerCase()==="canvas")this.contexts[id]=dom.getContext("2d")};sigma.renderers.canvas.prototype.resize=function(w,h){var k,oldWidth=this.width,oldHeight=this.height,pixelRatio=sigma.utils.getPixelRatio();if(w!==undefined&&h!==undefined){this.width=w;this.height=h}else{this.width=this.container.offsetWidth;this.height=this.container.offsetHeight;w=this.width;h=this.height}if(oldWidth!==this.width||oldHeight!==this.height){for(k in this.domElements){this.domElements[k].style.width=w+"px";this.domElements[k].style.height=h+"px";if(this.domElements[k].tagName.toLowerCase()==="canvas"){this.domElements[k].setAttribute("width",w*pixelRatio+"px");this.domElements[k].setAttribute("height",h*pixelRatio+"px");if(pixelRatio!==1)this.contexts[k].scale(pixelRatio,pixelRatio)}}}return this};sigma.renderers.canvas.prototype.clear=function(){for(var k in this.contexts){this.contexts[k].clearRect(0,0,this.width,this.height)}return this};sigma.renderers.canvas.prototype.kill=function(){var k,captor;while(captor=this.captors.pop())captor.kill();delete this.captors;for(k in this.domElements){this.domElements[k].parentNode.removeChild(this.domElements[k]);delete this.domElements[k];delete this.contexts[k]}delete this.domElements;delete this.contexts};sigma.utils.pkg("sigma.canvas.nodes");sigma.utils.pkg("sigma.canvas.edges");sigma.utils.pkg("sigma.canvas.labels")}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.renderers");sigma.renderers.webgl=function(graph,camera,settings,options){if(typeof options!=="object")throw"sigma.renderers.webgl: Wrong arguments.";if(!(options.container instanceof HTMLElement))throw"Container not found.";if(!sigma.utils.isWebGLSupported())alert("WebGL is not supported by your browser");var k,i,l,a,fn,_self=this;sigma.classes.dispatcher.extend(this);this.jobs={};Object.defineProperty(this,"conradId",{value:sigma.utils.id()});this.graph=graph;this.camera=camera;this.contexts={};this.domElements={};this.options=options;this.container=this.options.container;this.settings=typeof options.settings==="object"&&options.settings?settings.embedObjects(options.settings):settings;this.options.prefix=this.camera.readPrefix;Object.defineProperty(this,"nodePrograms",{value:{}});Object.defineProperty(this,"edgePrograms",{value:{}});Object.defineProperty(this,"nodeFloatArrays",{value:{}});Object.defineProperty(this,"edgeFloatArrays",{value:{}});if(this.settings(options,"batchEdgesDrawing")){this.initDOM("canvas","edges",true);this.initDOM("canvas","nodes",true)}else{this.initDOM("canvas","scene",true);this.contexts.nodes=this.contexts.scene;this.contexts.edges=this.contexts.scene}this.initDOM("canvas","labels");this.initDOM("canvas","mouse");this.contexts.hover=this.contexts.mouse;this.captors=[];a=this.options.captors||[sigma.captors.mouse,sigma.captors.touch];for(i=0,l=a.length;i<l;i++){fn=typeof a[i]==="function"?a[i]:sigma.captors[a[i]];this.captors.push(new fn(this.domElements.mouse,this.camera,this.settings))}sigma.misc.bindEvents.call(this,this.camera.prefix);sigma.misc.drawHovers.call(this,this.camera.prefix);this.resize()};sigma.renderers.webgl.prototype.process=function(){var a,i,l,k,type,renderer,graph=this.graph,options=sigma.utils.extend(options,this.options);for(k in this.nodeFloatArrays)delete this.nodeFloatArrays[k];for(k in this.edgeFloatArrays)delete this.edgeFloatArrays[k];for(a=graph.edges(),i=0,l=a.length;i<l;i++){type=a[i].type||this.settings(options,"defaultEdgeType");k=type&&sigma.webgl.edges[type]?type:"def";if(!this.edgeFloatArrays[k])this.edgeFloatArrays[k]={edges:[]};this.edgeFloatArrays[k].edges.push(a[i])}for(a=graph.nodes(),i=0,l=a.length;i<l;i++){type=a[i].type||this.settings(options,"defaultNodeType");k=type&&sigma.webgl.nodes[type]?type:"def";if(!this.nodeFloatArrays[k])this.nodeFloatArrays[k]={nodes:[]};this.nodeFloatArrays[k].nodes.push(a[i])}for(k in this.edgeFloatArrays){renderer=sigma.webgl.edges[k];for(a=this.edgeFloatArrays[k].edges,i=0,l=a.length;i<l;i++){if(!this.edgeFloatArrays[k].array)this.edgeFloatArrays[k].array=new Float32Array(a.length*renderer.POINTS*renderer.ATTRIBUTES);if(!a[i].hidden&&!graph.nodes(a[i].source).hidden&&!graph.nodes(a[i].target).hidden)renderer.addEdge(a[i],graph.nodes(a[i].source),graph.nodes(a[i].target),this.edgeFloatArrays[k].array,i*renderer.POINTS*renderer.ATTRIBUTES,options.prefix,this.settings)}}for(k in this.nodeFloatArrays){renderer=sigma.webgl.nodes[k];for(a=this.nodeFloatArrays[k].nodes,i=0,l=a.length;i<l;i++){if(!this.nodeFloatArrays[k].array)this.nodeFloatArrays[k].array=new Float32Array(a.length*renderer.POINTS*renderer.ATTRIBUTES);if(!a[i].hidden)renderer.addNode(a[i],this.nodeFloatArrays[k].array,i*renderer.POINTS*renderer.ATTRIBUTES,options.prefix,this.settings)}}return this};sigma.renderers.webgl.prototype.render=function(params){var a,i,l,k,o,program,renderer,self=this,graph=this.graph,nodesGl=this.contexts.nodes,edgesGl=this.contexts.edges,matrix=this.camera.getMatrix(),options=sigma.utils.extend(params,this.options),drawLabels=this.settings(options,"drawLabels"),drawEdges=this.settings(options,"drawEdges"),drawNodes=this.settings(options,"drawNodes");this.dispatchEvent("beforeRender");this.resize(false);if(this.settings(options,"hideEdgesOnMove"))if(this.camera.isAnimated||this.camera.isMoving)drawEdges=false;this.clear();matrix=sigma.utils.matrices.multiply(matrix,sigma.utils.matrices.translation(this.width/2,this.height/2));for(k in this.jobs)if(conrad.hasJob(k))conrad.killJob(k);if(drawEdges){if(this.settings(options,"batchEdgesDrawing"))(function(){var a,k,i,id,job,arr,end,start,renderer,batchSize,currentProgram;id="edges_"+this.conradId;batchSize=this.settings(options,"webglEdgesBatchSize");a=Object.keys(this.edgeFloatArrays);if(!a.length)return;i=0;renderer=sigma.webgl.edges[a[i]];arr=this.edgeFloatArrays[a[i]].array;start=0;end=Math.min(start+batchSize*renderer.POINTS,arr.length/renderer.ATTRIBUTES);job=function(){if(!this.edgePrograms[a[i]])this.edgePrograms[a[i]]=renderer.initProgram(edgesGl);if(start<end){edgesGl.useProgram(this.edgePrograms[a[i]]);renderer.render(edgesGl,this.edgePrograms[a[i]],arr,{settings:this.settings,matrix:matrix,width:this.width,height:this.height,ratio:this.camera.ratio,scalingRatio:this.settings(options,"webglOversamplingRatio"),start:start,count:end-start})}if(end>=arr.length/renderer.ATTRIBUTES&&i===a.length-1){delete this.jobs[id];return false}if(end>=arr.length/renderer.ATTRIBUTES){i++;arr=this.edgeFloatArrays[a[i]].array;renderer=sigma.webgl.edges[a[i]];start=0;end=Math.min(start+batchSize*renderer.POINTS,arr.length/renderer.ATTRIBUTES)}else{start=end;end=Math.min(start+batchSize*renderer.POINTS,arr.length/renderer.ATTRIBUTES)}return true};this.jobs[id]=job;conrad.addJob(id,job.bind(this))}).call(this);else{for(k in this.edgeFloatArrays){renderer=sigma.webgl.edges[k];if(!this.edgePrograms[k])this.edgePrograms[k]=renderer.initProgram(edgesGl);if(this.edgeFloatArrays[k]){edgesGl.useProgram(this.edgePrograms[k]);renderer.render(edgesGl,this.edgePrograms[k],this.edgeFloatArrays[k].array,{settings:this.settings,matrix:matrix,width:this.width,height:this.height,ratio:this.camera.ratio,scalingRatio:this.settings(options,"webglOversamplingRatio")})}}}}if(drawNodes){nodesGl.blendFunc(nodesGl.SRC_ALPHA,nodesGl.ONE_MINUS_SRC_ALPHA);nodesGl.enable(nodesGl.BLEND);for(k in this.nodeFloatArrays){renderer=sigma.webgl.nodes[k];if(!this.nodePrograms[k])this.nodePrograms[k]=renderer.initProgram(nodesGl);if(this.nodeFloatArrays[k]){nodesGl.useProgram(this.nodePrograms[k]);renderer.render(nodesGl,this.nodePrograms[k],this.nodeFloatArrays[k].array,{settings:this.settings,matrix:matrix,width:this.width,height:this.height,ratio:this.camera.ratio,scalingRatio:this.settings(options,"webglOversamplingRatio")})}}}if(drawLabels){a=this.camera.quadtree.area(this.camera.getRectangle(this.width,this.height));this.camera.applyView(undefined,undefined,{nodes:a,edges:[],width:this.width,height:this.height});o=function(key){return self.settings({prefix:self.camera.prefix},key)};sigma.renderers.canvas.applyRenderers({renderers:sigma.canvas.labels,type:"nodes",ctx:this.contexts.labels,elements:a,settings:o})}this.dispatchEvent("render");return this};sigma.renderers.webgl.prototype.initDOM=function(tag,id,webgl){var gl,dom=document.createElement(tag),self=this;dom.style.position="absolute";dom.setAttribute("class","sigma-"+id);this.domElements[id]=dom;this.container.appendChild(dom);if(tag.toLowerCase()==="canvas"){this.contexts[id]=dom.getContext(webgl?"experimental-webgl":"2d",{preserveDrawingBuffer:true});if(webgl){dom.addEventListener("webglcontextlost",function(e){e.preventDefault()},false);dom.addEventListener("webglcontextrestored",function(e){self.render()},false)}}};sigma.renderers.webgl.prototype.resize=function(w,h){var k,oldWidth=this.width,oldHeight=this.height,pixelRatio=sigma.utils.getPixelRatio();if(w!==undefined&&h!==undefined){this.width=w;this.height=h}else{this.width=this.container.offsetWidth;this.height=this.container.offsetHeight;w=this.width;h=this.height}if(oldWidth!==this.width||oldHeight!==this.height){for(k in this.domElements){this.domElements[k].style.width=w+"px";this.domElements[k].style.height=h+"px";if(this.domElements[k].tagName.toLowerCase()==="canvas"){if(this.contexts[k]&&this.contexts[k].scale){this.domElements[k].setAttribute("width",w*pixelRatio+"px");this.domElements[k].setAttribute("height",h*pixelRatio+"px");if(pixelRatio!==1)this.contexts[k].scale(pixelRatio,pixelRatio)}else{this.domElements[k].setAttribute("width",w*this.settings("webglOversamplingRatio")+"px");this.domElements[k].setAttribute("height",h*this.settings("webglOversamplingRatio")+"px")}}}}for(k in this.contexts)if(this.contexts[k]&&this.contexts[k].viewport)this.contexts[k].viewport(0,0,this.width*this.settings("webglOversamplingRatio"),this.height*this.settings("webglOversamplingRatio"));return this};sigma.renderers.webgl.prototype.clear=function(){this.contexts.labels.clearRect(0,0,this.width,this.height);this.contexts.nodes.clear(this.contexts.nodes.COLOR_BUFFER_BIT);this.contexts.edges.clear(this.contexts.edges.COLOR_BUFFER_BIT);return this};sigma.renderers.webgl.prototype.kill=function(){var k,captor;while(captor=this.captors.pop())captor.kill();delete this.captors;for(k in this.domElements){this.domElements[k].parentNode.removeChild(this.domElements[k]);delete this.domElements[k];delete this.contexts[k]}delete this.domElements;delete this.contexts};sigma.utils.pkg("sigma.webgl.nodes");sigma.utils.pkg("sigma.webgl.edges");sigma.utils.pkg("sigma.canvas.labels")}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";if(typeof conrad==="undefined")throw"conrad is not declared";sigma.utils.pkg("sigma.renderers");sigma.renderers.svg=function(graph,camera,settings,options){if(typeof options!=="object")throw"sigma.renderers.svg: Wrong arguments.";if(!(options.container instanceof HTMLElement))throw"Container not found.";var i,l,a,fn,self=this;sigma.classes.dispatcher.extend(this);this.graph=graph;this.camera=camera;this.domElements={graph:null,groups:{},nodes:{},edges:{},labels:{},hovers:{}};this.measurementCanvas=null;this.options=options;this.container=this.options.container;this.settings=typeof options.settings==="object"&&options.settings?settings.embedObjects(options.settings):settings;this.settings("freeStyle",!!this.options.freeStyle);this.settings("xmlns","http://www.w3.org/2000/svg");this.nodesOnScreen=[];this.edgesOnScreen=[];this.options.prefix="renderer"+sigma.utils.id()+":";this.initDOM("svg");this.captors=[];a=this.options.captors||[sigma.captors.mouse,sigma.captors.touch];for(i=0,l=a.length;i<l;i++){fn=typeof a[i]==="function"?a[i]:sigma.captors[a[i]];this.captors.push(new fn(this.domElements.graph,this.camera,this.settings))}window.addEventListener("resize",function(){self.resize()});sigma.misc.bindDOMEvents.call(this,this.domElements.graph);this.bindHovers(this.options.prefix);this.resize(false)};sigma.renderers.svg.prototype.render=function(options){options=options||{};this.dispatchEvent("beforeRender");var a,i,k,e,l,o,source,target,start,edges,renderers,subrenderers,index={},graph=this.graph,nodes=this.graph.nodes,prefix=this.options.prefix||"",drawEdges=this.settings(options,"drawEdges"),drawNodes=this.settings(options,"drawNodes"),drawLabels=this.settings(options,"drawLabels"),embedSettings=this.settings.embedObjects(options,{prefix:this.options.prefix,forceLabels:this.options.forceLabels});if(this.settings(options,"hideEdgesOnMove"))if(this.camera.isAnimated||this.camera.isMoving)drawEdges=false;this.camera.applyView(undefined,this.options.prefix,{width:this.width,height:this.height});this.hideDOMElements(this.domElements.nodes);this.hideDOMElements(this.domElements.edges);this.hideDOMElements(this.domElements.labels);this.edgesOnScreen=[];this.nodesOnScreen=this.camera.quadtree.area(this.camera.getRectangle(this.width,this.height));for(a=this.nodesOnScreen,i=0,l=a.length;i<l;i++)index[a[i].id]=a[i];for(a=graph.edges(),i=0,l=a.length;i<l;i++){o=a[i];if((index[o.source]||index[o.target])&&(!o.hidden&&!nodes(o.source).hidden&&!nodes(o.target).hidden))this.edgesOnScreen.push(o)}renderers=sigma.svg.nodes;subrenderers=sigma.svg.labels;if(drawNodes)for(a=this.nodesOnScreen,i=0,l=a.length;i<l;i++){if(!a[i].hidden&&!this.domElements.nodes[a[i].id]){e=(renderers[a[i].type]||renderers.def).create(a[i],embedSettings);this.domElements.nodes[a[i].id]=e;this.domElements.groups.nodes.appendChild(e);e=(subrenderers[a[i].type]||subrenderers.def).create(a[i],embedSettings);this.domElements.labels[a[i].id]=e;this.domElements.groups.labels.appendChild(e)}}if(drawNodes)for(a=this.nodesOnScreen,i=0,l=a.length;i<l;i++){if(a[i].hidden)continue;(renderers[a[i].type]||renderers.def).update(a[i],this.domElements.nodes[a[i].id],embedSettings);(subrenderers[a[i].type]||subrenderers.def).update(a[i],this.domElements.labels[a[i].id],embedSettings)}renderers=sigma.svg.edges;if(drawEdges)for(a=this.edgesOnScreen,i=0,l=a.length;i<l;i++){if(!this.domElements.edges[a[i].id]){source=nodes(a[i].source);target=nodes(a[i].target);e=(renderers[a[i].type]||renderers.def).create(a[i],source,target,embedSettings);this.domElements.edges[a[i].id]=e;this.domElements.groups.edges.appendChild(e)}}if(drawEdges)for(a=this.edgesOnScreen,i=0,l=a.length;i<l;i++){source=nodes(a[i].source);target=nodes(a[i].target);(renderers[a[i].type]||renderers.def).update(a[i],this.domElements.edges[a[i].id],source,target,embedSettings)}this.dispatchEvent("render");return this};sigma.renderers.svg.prototype.initDOM=function(tag){var dom=document.createElementNS(this.settings("xmlns"),tag),c=this.settings("classPrefix"),g,l,i;dom.style.position="absolute";dom.setAttribute("class",c+"-svg");dom.setAttribute("xmlns",this.settings("xmlns"));dom.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");dom.setAttribute("version","1.1");var canvas=document.createElement("canvas");canvas.setAttribute("class",c+"-measurement-canvas");this.domElements.graph=this.container.appendChild(dom);var groups=["edges","nodes","labels","hovers"];for(i=0,l=groups.length;i<l;i++){g=document.createElementNS(this.settings("xmlns"),"g");g.setAttributeNS(null,"id",c+"-group-"+groups[i]);g.setAttributeNS(null,"class",c+"-group");this.domElements.groups[groups[i]]=this.domElements.graph.appendChild(g)}this.container.appendChild(canvas);this.measurementCanvas=canvas.getContext("2d")};sigma.renderers.svg.prototype.hideDOMElements=function(elements){var o,i;for(i in elements){o=elements[i];sigma.svg.utils.hide(o)}return this};sigma.renderers.svg.prototype.bindHovers=function(prefix){var renderers=sigma.svg.hovers,self=this,hoveredNode;function updateHovers(e){var node,embedSettings=self.settings.embedObjects({prefix:prefix});if(!embedSettings("enableHovering"))return;if(e.data.enter.nodes.length>0){node=e.data.enter.nodes[0];var hover=(renderers[node.type]||renderers.def).create(node,self.domElements.nodes[node.id],self.measurementCanvas,embedSettings);self.domElements.hovers[node.id]=hover;self.domElements.groups.hovers.appendChild(hover);hoveredNode=node}else if(e.data.leave.nodes.length>0){node=e.data.leave.nodes[0];self.domElements.groups.hovers.removeChild(self.domElements.hovers[node.id]);hoveredNode=null;delete self.domElements.hovers[node.id];self.domElements.groups.nodes.appendChild(self.domElements.nodes[node.id])}}function update(){if(!hoveredNode)return;var embedSettings=self.settings.embedObjects({prefix:prefix});self.domElements.groups.hovers.removeChild(self.domElements.hovers[hoveredNode.id]);delete self.domElements.hovers[hoveredNode.id];var hover=(renderers[hoveredNode.type]||renderers.def).create(hoveredNode,self.domElements.nodes[hoveredNode.id],self.measurementCanvas,embedSettings);self.domElements.hovers[hoveredNode.id]=hover;self.domElements.groups.hovers.appendChild(hover)}this.bind("hovers",updateHovers);this.bind("render",update)};sigma.renderers.svg.prototype.resize=function(){var oldWidth=this.width,oldHeight=this.height;this.width=this.container.offsetWidth;this.height=this.container.offsetHeight;if(oldWidth!==this.width||oldHeight!==this.height){this.domElements.graph.style.width=this.width+"px";this.domElements.graph.style.height=this.height+"px"}return this};sigma.utils.pkg("sigma.svg.nodes");sigma.utils.pkg("sigma.svg.edges");sigma.utils.pkg("sigma.svg.labels")}).call(this);(function(global){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.renderers");sigma.renderers.def=sigma.utils.isWebGLSupported()?sigma.renderers.webgl:sigma.renderers.canvas})(this);(function(){"use strict";sigma.utils.pkg("sigma.webgl.nodes");sigma.webgl.nodes.def={POINTS:3,ATTRIBUTES:5,addNode:function(node,data,i,prefix,settings){var color=sigma.utils.floatColor(node.color||settings("defaultNodeColor"));data[i++]=node[prefix+"x"];data[i++]=node[prefix+"y"];data[i++]=node[prefix+"size"];data[i++]=color;data[i++]=0;data[i++]=node[prefix+"x"];data[i++]=node[prefix+"y"];data[i++]=node[prefix+"size"];data[i++]=color;data[i++]=2*Math.PI/3;data[i++]=node[prefix+"x"];data[i++]=node[prefix+"y"];data[i++]=node[prefix+"size"];data[i++]=color;data[i++]=4*Math.PI/3},render:function(gl,program,data,params){var buffer;var positionLocation=gl.getAttribLocation(program,"a_position"),sizeLocation=gl.getAttribLocation(program,"a_size"),colorLocation=gl.getAttribLocation(program,"a_color"),angleLocation=gl.getAttribLocation(program,"a_angle"),resolutionLocation=gl.getUniformLocation(program,"u_resolution"),matrixLocation=gl.getUniformLocation(program,"u_matrix"),ratioLocation=gl.getUniformLocation(program,"u_ratio"),scaleLocation=gl.getUniformLocation(program,"u_scale");buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,data,gl.DYNAMIC_DRAW);gl.uniform2f(resolutionLocation,params.width,params.height);gl.uniform1f(ratioLocation,1/Math.pow(params.ratio,params.settings("nodesPowRatio")));gl.uniform1f(scaleLocation,params.scalingRatio);gl.uniformMatrix3fv(matrixLocation,false,params.matrix);gl.enableVertexAttribArray(positionLocation);gl.enableVertexAttribArray(sizeLocation);gl.enableVertexAttribArray(colorLocation);gl.enableVertexAttribArray(angleLocation);gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(sizeLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,8);gl.vertexAttribPointer(colorLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,12);gl.vertexAttribPointer(angleLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,16);gl.drawArrays(gl.TRIANGLES,params.start||0,params.count||data.length/this.ATTRIBUTES)},initProgram:function(gl){var vertexShader,fragmentShader,program;vertexShader=sigma.utils.loadShader(gl,["attribute vec2 a_position;","attribute float a_size;","attribute float a_color;","attribute float a_angle;","uniform vec2 u_resolution;","uniform float u_ratio;","uniform float u_scale;","uniform mat3 u_matrix;","varying vec4 color;","varying vec2 center;","varying float radius;","void main() {","radius = a_size * u_ratio;","vec2 position = (u_matrix * vec3(a_position, 1)).xy;","center = position * u_scale;","center = vec2(center.x, u_scale * u_resolution.y - center.y);","position = position +","2.0 * radius * vec2(cos(a_angle), sin(a_angle));","position = (position / u_resolution * 2.0 - 1.0) * vec2(1, -1);","radius = radius * u_scale;","gl_Position = vec4(position, 0, 1);","float c = a_color;","color.b = mod(c, 256.0); c = floor(c / 256.0);","color.g = mod(c, 256.0); c = floor(c / 256.0);","color.r = mod(c, 256.0); c = floor(c / 256.0); color /= 255.0;","color.a = 1.0;","}"].join("\n"),gl.VERTEX_SHADER);fragmentShader=sigma.utils.loadShader(gl,["precision mediump float;","varying vec4 color;","varying vec2 center;","varying float radius;","void main(void) {","vec4 color0 = vec4(0.0, 0.0, 0.0, 0.0);","vec2 m = gl_FragCoord.xy - center;","float diff = radius - sqrt(m.x * m.x + m.y * m.y);","if (diff > 0.0)","gl_FragColor = color;","else","gl_FragColor = color0;","}"].join("\n"),gl.FRAGMENT_SHADER);program=sigma.utils.loadProgram(gl,[vertexShader,fragmentShader]);return program}}})();(function(){"use strict";sigma.utils.pkg("sigma.webgl.nodes");sigma.webgl.nodes.fast={POINTS:1,ATTRIBUTES:4,addNode:function(node,data,i,prefix,settings){data[i++]=node[prefix+"x"];data[i++]=node[prefix+"y"];data[i++]=node[prefix+"size"];data[i++]=sigma.utils.floatColor(node.color||settings("defaultNodeColor"))},render:function(gl,program,data,params){var buffer;var positionLocation=gl.getAttribLocation(program,"a_position"),sizeLocation=gl.getAttribLocation(program,"a_size"),colorLocation=gl.getAttribLocation(program,"a_color"),resolutionLocation=gl.getUniformLocation(program,"u_resolution"),matrixLocation=gl.getUniformLocation(program,"u_matrix"),ratioLocation=gl.getUniformLocation(program,"u_ratio"),scaleLocation=gl.getUniformLocation(program,"u_scale");buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,data,gl.DYNAMIC_DRAW);gl.uniform2f(resolutionLocation,params.width,params.height);gl.uniform1f(ratioLocation,1/Math.pow(params.ratio,params.settings("nodesPowRatio")));gl.uniform1f(scaleLocation,params.scalingRatio);gl.uniformMatrix3fv(matrixLocation,false,params.matrix);gl.enableVertexAttribArray(positionLocation);gl.enableVertexAttribArray(sizeLocation);gl.enableVertexAttribArray(colorLocation);gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(sizeLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,8);gl.vertexAttribPointer(colorLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,12);gl.drawArrays(gl.POINTS,params.start||0,params.count||data.length/this.ATTRIBUTES)},initProgram:function(gl){var vertexShader,fragmentShader,program;vertexShader=sigma.utils.loadShader(gl,["attribute vec2 a_position;","attribute float a_size;","attribute float a_color;","uniform vec2 u_resolution;","uniform float u_ratio;","uniform float u_scale;","uniform mat3 u_matrix;","varying vec4 color;","void main() {","gl_Position = vec4(","((u_matrix * vec3(a_position, 1)).xy /","u_resolution * 2.0 - 1.0) * vec2(1, -1),","0,","1",");","gl_PointSize = a_size * u_ratio * u_scale * 2.0;","float c = a_color;","color.b = mod(c, 256.0); c = floor(c / 256.0);","color.g = mod(c, 256.0); c = floor(c / 256.0);","color.r = mod(c, 256.0); c = floor(c / 256.0); color /= 255.0;","color.a = 1.0;","}"].join("\n"),gl.VERTEX_SHADER);
fragmentShader=sigma.utils.loadShader(gl,["precision mediump float;","varying vec4 color;","void main(void) {","gl_FragColor = color;","}"].join("\n"),gl.FRAGMENT_SHADER);program=sigma.utils.loadProgram(gl,[vertexShader,fragmentShader]);return program}}})();(function(){"use strict";sigma.utils.pkg("sigma.webgl.edges");sigma.webgl.edges.def={POINTS:6,ATTRIBUTES:7,addEdge:function(edge,source,target,data,i,prefix,settings){var w=(edge[prefix+"size"]||1)/2,x1=source[prefix+"x"],y1=source[prefix+"y"],x2=target[prefix+"x"],y2=target[prefix+"y"],color=edge.color;if(!color)switch(settings("edgeColor")){case"source":color=source.color||settings("defaultNodeColor");break;case"target":color=target.color||settings("defaultNodeColor");break;default:color=settings("defaultEdgeColor");break}color=sigma.utils.floatColor(color);data[i++]=x1;data[i++]=y1;data[i++]=x2;data[i++]=y2;data[i++]=w;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=1;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=0;data[i++]=color;data[i++]=x1;data[i++]=y1;data[i++]=x2;data[i++]=y2;data[i++]=w;data[i++]=1;data[i++]=color;data[i++]=x1;data[i++]=y1;data[i++]=x2;data[i++]=y2;data[i++]=w;data[i++]=0;data[i++]=color},render:function(gl,program,data,params){var buffer;var colorLocation=gl.getAttribLocation(program,"a_color"),positionLocation1=gl.getAttribLocation(program,"a_position1"),positionLocation2=gl.getAttribLocation(program,"a_position2"),thicknessLocation=gl.getAttribLocation(program,"a_thickness"),minusLocation=gl.getAttribLocation(program,"a_minus"),resolutionLocation=gl.getUniformLocation(program,"u_resolution"),matrixLocation=gl.getUniformLocation(program,"u_matrix"),matrixHalfPiLocation=gl.getUniformLocation(program,"u_matrixHalfPi"),matrixHalfPiMinusLocation=gl.getUniformLocation(program,"u_matrixHalfPiMinus"),ratioLocation=gl.getUniformLocation(program,"u_ratio"),scaleLocation=gl.getUniformLocation(program,"u_scale");buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,data,gl.STATIC_DRAW);gl.uniform2f(resolutionLocation,params.width,params.height);gl.uniform1f(ratioLocation,params.ratio/Math.pow(params.ratio,params.settings("edgesPowRatio")));gl.uniform1f(scaleLocation,params.scalingRatio);gl.uniformMatrix3fv(matrixLocation,false,params.matrix);gl.uniformMatrix2fv(matrixHalfPiLocation,false,sigma.utils.matrices.rotation(Math.PI/2,true));gl.uniformMatrix2fv(matrixHalfPiMinusLocation,false,sigma.utils.matrices.rotation(-Math.PI/2,true));gl.enableVertexAttribArray(colorLocation);gl.enableVertexAttribArray(positionLocation1);gl.enableVertexAttribArray(positionLocation2);gl.enableVertexAttribArray(thicknessLocation);gl.enableVertexAttribArray(minusLocation);gl.vertexAttribPointer(positionLocation1,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(positionLocation2,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,8);gl.vertexAttribPointer(thicknessLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,16);gl.vertexAttribPointer(minusLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,20);gl.vertexAttribPointer(colorLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,24);gl.drawArrays(gl.TRIANGLES,params.start||0,params.count||data.length/this.ATTRIBUTES)},initProgram:function(gl){var vertexShader,fragmentShader,program;vertexShader=sigma.utils.loadShader(gl,["attribute vec2 a_position1;","attribute vec2 a_position2;","attribute float a_thickness;","attribute float a_minus;","attribute float a_color;","uniform vec2 u_resolution;","uniform float u_ratio;","uniform float u_scale;","uniform mat3 u_matrix;","uniform mat2 u_matrixHalfPi;","uniform mat2 u_matrixHalfPiMinus;","varying vec4 color;","void main() {","vec2 position = a_thickness * u_ratio *","normalize(a_position2 - a_position1);","mat2 matrix = a_minus * u_matrixHalfPiMinus +","(1.0 - a_minus) * u_matrixHalfPi;","position = matrix * position + a_position1;","gl_Position = vec4(","((u_matrix * vec3(position, 1)).xy /","u_resolution * 2.0 - 1.0) * vec2(1, -1),","0,","1",");","float c = a_color;","color.b = mod(c, 256.0); c = floor(c / 256.0);","color.g = mod(c, 256.0); c = floor(c / 256.0);","color.r = mod(c, 256.0); c = floor(c / 256.0); color /= 255.0;","color.a = 1.0;","}"].join("\n"),gl.VERTEX_SHADER);fragmentShader=sigma.utils.loadShader(gl,["precision mediump float;","varying vec4 color;","void main(void) {","gl_FragColor = color;","}"].join("\n"),gl.FRAGMENT_SHADER);program=sigma.utils.loadProgram(gl,[vertexShader,fragmentShader]);return program}}})();(function(){"use strict";sigma.utils.pkg("sigma.webgl.edges");sigma.webgl.edges.fast={POINTS:2,ATTRIBUTES:3,addEdge:function(edge,source,target,data,i,prefix,settings){var w=(edge[prefix+"size"]||1)/2,x1=source[prefix+"x"],y1=source[prefix+"y"],x2=target[prefix+"x"],y2=target[prefix+"y"],color=edge.color;if(!color)switch(settings("edgeColor")){case"source":color=source.color||settings("defaultNodeColor");break;case"target":color=target.color||settings("defaultNodeColor");break;default:color=settings("defaultEdgeColor");break}color=sigma.utils.floatColor(color);data[i++]=x1;data[i++]=y1;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=color},render:function(gl,program,data,params){var buffer;var colorLocation=gl.getAttribLocation(program,"a_color"),positionLocation=gl.getAttribLocation(program,"a_position"),resolutionLocation=gl.getUniformLocation(program,"u_resolution"),matrixLocation=gl.getUniformLocation(program,"u_matrix");buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,data,gl.DYNAMIC_DRAW);gl.uniform2f(resolutionLocation,params.width,params.height);gl.uniformMatrix3fv(matrixLocation,false,params.matrix);gl.enableVertexAttribArray(positionLocation);gl.enableVertexAttribArray(colorLocation);gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(colorLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,8);gl.lineWidth(3);gl.drawArrays(gl.LINES,params.start||0,params.count||data.length/this.ATTRIBUTES)},initProgram:function(gl){var vertexShader,fragmentShader,program;vertexShader=sigma.utils.loadShader(gl,["attribute vec2 a_position;","attribute float a_color;","uniform vec2 u_resolution;","uniform mat3 u_matrix;","varying vec4 color;","void main() {","gl_Position = vec4(","((u_matrix * vec3(a_position, 1)).xy /","u_resolution * 2.0 - 1.0) * vec2(1, -1),","0,","1",");","float c = a_color;","color.b = mod(c, 256.0); c = floor(c / 256.0);","color.g = mod(c, 256.0); c = floor(c / 256.0);","color.r = mod(c, 256.0); c = floor(c / 256.0); color /= 255.0;","color.a = 1.0;","}"].join("\n"),gl.VERTEX_SHADER);fragmentShader=sigma.utils.loadShader(gl,["precision mediump float;","varying vec4 color;","void main(void) {","gl_FragColor = color;","}"].join("\n"),gl.FRAGMENT_SHADER);program=sigma.utils.loadProgram(gl,[vertexShader,fragmentShader]);return program}}})();(function(){"use strict";sigma.utils.pkg("sigma.webgl.edges");sigma.webgl.edges.arrow={POINTS:9,ATTRIBUTES:11,addEdge:function(edge,source,target,data,i,prefix,settings){var w=(edge[prefix+"size"]||1)/2,x1=source[prefix+"x"],y1=source[prefix+"y"],x2=target[prefix+"x"],y2=target[prefix+"y"],targetSize=target[prefix+"size"],color=edge.color;if(!color)switch(settings("edgeColor")){case"source":color=source.color||settings("defaultNodeColor");break;case"target":color=target.color||settings("defaultNodeColor");break;default:color=settings("defaultEdgeColor");break}color=sigma.utils.floatColor(color);data[i++]=x1;data[i++]=y1;data[i++]=x2;data[i++]=y2;data[i++]=w;data[i++]=targetSize;data[i++]=0;data[i++]=0;data[i++]=0;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=targetSize;data[i++]=1;data[i++]=1;data[i++]=0;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=targetSize;data[i++]=1;data[i++]=0;data[i++]=0;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=targetSize;data[i++]=1;data[i++]=0;data[i++]=0;data[i++]=0;data[i++]=color;data[i++]=x1;data[i++]=y1;data[i++]=x2;data[i++]=y2;data[i++]=w;data[i++]=targetSize;data[i++]=0;data[i++]=1;data[i++]=0;data[i++]=0;data[i++]=color;data[i++]=x1;data[i++]=y1;data[i++]=x2;data[i++]=y2;data[i++]=w;data[i++]=targetSize;data[i++]=0;data[i++]=0;data[i++]=0;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=targetSize;data[i++]=1;data[i++]=0;data[i++]=1;data[i++]=-1;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=targetSize;data[i++]=1;data[i++]=0;data[i++]=1;data[i++]=0;data[i++]=color;data[i++]=x2;data[i++]=y2;data[i++]=x1;data[i++]=y1;data[i++]=w;data[i++]=targetSize;data[i++]=1;data[i++]=0;data[i++]=1;data[i++]=1;data[i++]=color},render:function(gl,program,data,params){var buffer;var positionLocation1=gl.getAttribLocation(program,"a_pos1"),positionLocation2=gl.getAttribLocation(program,"a_pos2"),thicknessLocation=gl.getAttribLocation(program,"a_thickness"),targetSizeLocation=gl.getAttribLocation(program,"a_tSize"),delayLocation=gl.getAttribLocation(program,"a_delay"),minusLocation=gl.getAttribLocation(program,"a_minus"),headLocation=gl.getAttribLocation(program,"a_head"),headPositionLocation=gl.getAttribLocation(program,"a_headPosition"),colorLocation=gl.getAttribLocation(program,"a_color"),resolutionLocation=gl.getUniformLocation(program,"u_resolution"),matrixLocation=gl.getUniformLocation(program,"u_matrix"),matrixHalfPiLocation=gl.getUniformLocation(program,"u_matrixHalfPi"),matrixHalfPiMinusLocation=gl.getUniformLocation(program,"u_matrixHalfPiMinus"),ratioLocation=gl.getUniformLocation(program,"u_ratio"),nodeRatioLocation=gl.getUniformLocation(program,"u_nodeRatio"),arrowHeadLocation=gl.getUniformLocation(program,"u_arrowHead"),scaleLocation=gl.getUniformLocation(program,"u_scale");buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.bufferData(gl.ARRAY_BUFFER,data,gl.STATIC_DRAW);gl.uniform2f(resolutionLocation,params.width,params.height);gl.uniform1f(ratioLocation,params.ratio/Math.pow(params.ratio,params.settings("edgesPowRatio")));gl.uniform1f(nodeRatioLocation,Math.pow(params.ratio,params.settings("nodesPowRatio"))/params.ratio);gl.uniform1f(arrowHeadLocation,5);gl.uniform1f(scaleLocation,params.scalingRatio);gl.uniformMatrix3fv(matrixLocation,false,params.matrix);gl.uniformMatrix2fv(matrixHalfPiLocation,false,sigma.utils.matrices.rotation(Math.PI/2,true));gl.uniformMatrix2fv(matrixHalfPiMinusLocation,false,sigma.utils.matrices.rotation(-Math.PI/2,true));gl.enableVertexAttribArray(positionLocation1);gl.enableVertexAttribArray(positionLocation2);gl.enableVertexAttribArray(thicknessLocation);gl.enableVertexAttribArray(targetSizeLocation);gl.enableVertexAttribArray(delayLocation);gl.enableVertexAttribArray(minusLocation);gl.enableVertexAttribArray(headLocation);gl.enableVertexAttribArray(headPositionLocation);gl.enableVertexAttribArray(colorLocation);gl.vertexAttribPointer(positionLocation1,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,0);gl.vertexAttribPointer(positionLocation2,2,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,8);gl.vertexAttribPointer(thicknessLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,16);gl.vertexAttribPointer(targetSizeLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,20);gl.vertexAttribPointer(delayLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,24);gl.vertexAttribPointer(minusLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,28);gl.vertexAttribPointer(headLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,32);gl.vertexAttribPointer(headPositionLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,36);gl.vertexAttribPointer(colorLocation,1,gl.FLOAT,false,this.ATTRIBUTES*Float32Array.BYTES_PER_ELEMENT,40);gl.drawArrays(gl.TRIANGLES,params.start||0,params.count||data.length/this.ATTRIBUTES)},initProgram:function(gl){var vertexShader,fragmentShader,program;vertexShader=sigma.utils.loadShader(gl,["attribute vec2 a_pos1;","attribute vec2 a_pos2;","attribute float a_thickness;","attribute float a_tSize;","attribute float a_delay;","attribute float a_minus;","attribute float a_head;","attribute float a_headPosition;","attribute float a_color;","uniform vec2 u_resolution;","uniform float u_ratio;","uniform float u_nodeRatio;","uniform float u_arrowHead;","uniform float u_scale;","uniform mat3 u_matrix;","uniform mat2 u_matrixHalfPi;","uniform mat2 u_matrixHalfPiMinus;","varying vec4 color;","void main() {","vec2 pos = normalize(a_pos2 - a_pos1);","mat2 matrix = (1.0 - a_head) *","(","a_minus * u_matrixHalfPiMinus +","(1.0 - a_minus) * u_matrixHalfPi",") + a_head * (","a_headPosition * u_matrixHalfPiMinus * 0.6 +","(a_headPosition * a_headPosition - 1.0) * mat2(1.0)",");","pos = a_pos1 + (","(1.0 - a_head) * a_thickness * u_ratio * matrix * pos +","a_head * u_arrowHead * a_thickness * u_ratio * matrix * pos +","a_delay * pos * (","a_tSize / u_nodeRatio +","u_arrowHead * a_thickness * u_ratio",")",");","gl_Position = vec4(","((u_matrix * vec3(pos, 1)).xy /","u_resolution * 2.0 - 1.0) * vec2(1, -1),","0,","1",");","float c = a_color;","color.b = mod(c, 256.0); c = floor(c / 256.0);","color.g = mod(c, 256.0); c = floor(c / 256.0);","color.r = mod(c, 256.0); c = floor(c / 256.0); color /= 255.0;","color.a = 1.0;","}"].join("\n"),gl.VERTEX_SHADER);fragmentShader=sigma.utils.loadShader(gl,["precision mediump float;","varying vec4 color;","void main(void) {","gl_FragColor = color;","}"].join("\n"),gl.FRAGMENT_SHADER);program=sigma.utils.loadProgram(gl,[vertexShader,fragmentShader]);return program}}})();(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.canvas.labels");sigma.canvas.labels.def=function(node,context,settings,infos){var fontSize,prefix=settings("prefix")||"",size=node[prefix+"size"]||1,fontStyle=settings("fontStyle"),borderSize=settings("borderSize"),labelWidth,labelOffsetX,labelOffsetY,alignment=settings("labelAlignment"),maxLineLength=settings("maxNodeLabelLineLength")||0;if(size<=settings("labelThreshold"))return;if(!node.label||typeof node.label!=="string")return;fontSize=settings("labelSize")==="fixed"?settings("defaultLabelSize"):settings("labelSizeRatio")*size;var new_font=(fontStyle?fontStyle+" ":"")+fontSize+"px "+(node.active?settings("activeFont")||settings("font"):settings("font"));if(infos&&infos.ctx.font!=new_font){context.font=new_font;infos.ctx.font=new_font}else{context.font=new_font}context.fillStyle=settings("labelColor")==="node"?node.color||settings("defaultNodeColor"):settings("defaultLabelColor");labelOffsetX=0;labelOffsetY=fontSize/3;context.textAlign="center";switch(alignment){case"bottom":labelOffsetY=+size+4*fontSize/3;break;case"center":break;case"left":context.textAlign="right";labelOffsetX=-size-borderSize-3;break;case"top":labelOffsetY=-size-2*fontSize/3;break;case"inside":labelWidth=sigma.utils.canvas.getTextWidth(context,settings("approximateLabelWidth"),fontSize,node.label);if(labelWidth<=(size+fontSize/3)*2){break}case"right":default:labelOffsetX=size+borderSize+3;context.textAlign="left";break}var lines=getLines(node.label,maxLineLength),baseX=node[prefix+"x"]+labelOffsetX,baseY=Math.round(node[prefix+"y"]+labelOffsetY);for(var i=0;i<lines.length;++i){context.fillText(lines[i],baseX,baseY+i*(fontSize+1))}};function getLines(text,maxLineLength){if(maxLineLength<=1){return[text]}var words=text.split(" "),lines=[],lineLength=0,lineIndex=-1,lineList=[],lineFull=true;for(var i=0;i<words.length;++i){if(lineFull){if(words[i].length>maxLineLength){var parts=splitWord(words[i],maxLineLength);for(var j=0;j<parts.length;++j){lines.push([parts[j]]);++lineIndex}lineLength=parts[parts.length-1].length}else{lines.push([words[i]]);++lineIndex;lineLength=words[i].length+1}lineFull=false}else if(lineLength+words[i].length<=maxLineLength){lines[lineIndex].push(words[i]);lineLength+=words[i].length+1}else{lineFull=true;--i}}for(i=0;i<lines.length;++i){lineList.push(lines[i].join(" "))}return lineList}function splitWord(word,maxLength){var parts=[];for(var i=0;i<word.length;i+=maxLength-1){parts.push(word.substr(i,maxLength-1)+"-")}var lastPartLen=parts[parts.length-1].length;parts[parts.length-1]=parts[parts.length-1].substr(0,lastPartLen-1)+" ";return parts}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.canvas.hovers");sigma.canvas.hovers.def=function(node,context,settings){var x,y,w,h,e,labelX,labelY,lines,baseX,baseY,borderSize=settings("borderSize"),alignment=settings("labelAlignment"),fontStyle=settings("hoverFontStyle")||settings("fontStyle"),prefix=settings("prefix")||"",size=node[prefix+"size"],maxLineLength=settings("maxNodeLabelLineLength")||0,fontSize=settings("labelSize")==="fixed"?settings("defaultLabelSize"):settings("labelSizeRatio")*size;context.font=(fontStyle?fontStyle+" ":"")+fontSize+"px "+(settings("hoverFont")||settings("font"));context.beginPath();context.fillStyle=settings("labelHoverBGColor")==="node"?node.color||settings("defaultNodeColor"):settings("defaultHoverLabelBGColor");if(settings("labelHoverShadow")){context.shadowOffsetX=0;context.shadowOffsetY=0;context.shadowBlur=8;context.shadowColor=settings("labelHoverShadowColor")}lines=getLines(node.label,maxLineLength);drawHoverBorder(alignment,context,fontSize,node,lines,maxLineLength);if(borderSize>0){context.beginPath();context.fillStyle=settings("nodeBorderColor")==="node"?node.color||settings("defaultNodeColor"):settings("defaultNodeBorderColor");context.arc(node[prefix+"x"],node[prefix+"y"],size+borderSize,0,Math.PI*2,true);context.closePath();context.fill()}var nodeRenderer=sigma.canvas.nodes[node.type]||sigma.canvas.nodes.def;nodeRenderer(node,context,settings);if(node.label&&typeof node.label==="string"){context.fillStyle=settings("labelHoverColor")==="node"?node.color||settings("defaultNodeColor"):settings("defaultLabelHoverColor");var labelWidth=sigma.utils.canvas.getTextWidth(context,settings("approximateLabelWidth"),fontSize,node.label),labelOffsetX=-labelWidth/2,labelOffsetY=fontSize/3;switch(alignment){case"bottom":labelOffsetY=+size+4*fontSize/3;break;case"center":break;case"left":labelOffsetX=-size-borderSize-3-labelWidth;break;case"top":labelOffsetY=-size-2*fontSize/3;break;case"inside":if(labelWidth<=(size+fontSize/3)*2){break}case"right":default:labelOffsetX=size+borderSize+3;break}baseX=node[prefix+"x"]+labelOffsetX;baseY=Math.round(node[prefix+"y"]+labelOffsetY);for(var i=0;i<lines.length;++i){context.fillText(lines[i],baseX,baseY+i*(fontSize+1))}}function drawHoverBorder(alignment,context,fontSize,node,lines,maxLineLength){var x=Math.round(node[prefix+"x"]),y=Math.round(node[prefix+"y"]),h=(fontSize+1)*lines.length+4,e=Math.round(size+fontSize/4),labelWidth=.6*(maxLineLength>1?maxLineLength:lines[0].length)*fontSize,w=Math.round(labelWidth+size+1.5+fontSize/3);if(node.label&&typeof node.label==="string"){switch(alignment){case"center":break;case"left":x=Math.round(node[prefix+"x"]+fontSize/2+2);y=Math.round(node[prefix+"y"]-fontSize/2-2);context.moveTo(x,y+e);context.arcTo(x,y,x-e,y,e);context.lineTo(x-w-borderSize-e,y);context.lineTo(x-w-borderSize-e,y+h);context.lineTo(x-e,y+h);context.arcTo(x,y+h,x,y+h-e,e);context.lineTo(x,y+e);break;case"top":context.rect(x-w/2,y-e-h,w,h);break;case"bottom":context.rect(x-w/2,y+e,w,h);break;case"inside":if(labelWidth<=e*2){break}case"right":default:x=Math.round(node[prefix+"x"]-fontSize/2-2);y=Math.round(node[prefix+"y"]-fontSize/2-2);context.moveTo(x,y+e);context.arcTo(x,y,x+e,y,e);context.lineTo(x+w+borderSize+e,y);context.lineTo(x+w+borderSize+e,y+h);context.lineTo(x+e,y+h);context.arcTo(x,y+h,x,y+h-e,e);context.lineTo(x,y+e);break}}context.closePath();context.fill();context.shadowOffsetX=0;context.shadowOffsetY=0;context.shadowBlur=0}function getLines(text,maxLineLength){if(maxLineLength<=1){return[text]}var words=text.split(" "),lines=[],lineLength=0,lineIndex=-1,lineList=[],lineFull=true;for(var i=0;i<words.length;++i){if(lineFull){if(words[i].length>maxLineLength){var parts=splitWord(words[i],maxLineLength);for(var j=0;j<parts.length;++j){lines.push([parts[j]]);++lineIndex}lineLength=parts[parts.length-1].length}else{lines.push([words[i]]);++lineIndex;lineLength=words[i].length+1}lineFull=false}else if(lineLength+words[i].length<=maxLineLength){lines[lineIndex].push(words[i]);lineLength+=words[i].length+1}else{lineFull=true;--i}}for(i=0;i<lines.length;++i){lineList.push(lines[i].join(" "))}return lineList}function splitWord(word,maxLength){var parts=[];for(var i=0;i<word.length;i+=maxLength-1){parts.push(word.substr(i,maxLength-1)+"-")}var lastPartLen=parts[parts.length-1].length;parts[parts.length-1]=parts[parts.length-1].substr(0,lastPartLen-1)+" ";return parts}}}).call(this);(function(){"use strict";sigma.utils.pkg("sigma.canvas.nodes");sigma.canvas.nodes.def=function(node,context,settings){var prefix=settings("prefix")||"";context.fillStyle=node.color||settings("defaultNodeColor");context.beginPath();context.arc(node[prefix+"x"],node[prefix+"y"],node[prefix+"size"],0,Math.PI*2,true);context.closePath();context.fill()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edges");sigma.canvas.edges.def=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",size=edge[prefix+"size"]||1,edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor");if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(source[prefix+"x"],source[prefix+"y"]);context.lineTo(target[prefix+"x"],target[prefix+"y"]);context.stroke()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edges");sigma.canvas.edges.curve=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",size=edge[prefix+"size"]||1,edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor"),cp={},sSize=source[prefix+"size"],sX=source[prefix+"x"],sY=source[prefix+"y"],tX=target[prefix+"x"],tY=target[prefix+"y"];cp=source.id===target.id?sigma.utils.getSelfLoopControlPoints(sX,sY,sSize):sigma.utils.getQuadraticControlPoint(sX,sY,tX,tY,edge.cc);if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(sX,sY);if(source.id===target.id){context.bezierCurveTo(cp.x1,cp.y1,cp.x2,cp.y2,tX,tY)}else{context.quadraticCurveTo(cp.x,cp.y,tX,tY)}context.stroke()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edges");sigma.canvas.edges.arrow=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor"),size=edge[prefix+"size"]||1,tSize=target[prefix+"size"],sX=source[prefix+"x"],sY=source[prefix+"y"],tX=target[prefix+"x"],tY=target[prefix+"y"],aSize=Math.max(size*2.5,settings("minArrowSize")),d=Math.sqrt((tX-sX)*(tX-sX)+(tY-sY)*(tY-sY)),aX=sX+(tX-sX)*(d-aSize-tSize)/d,aY=sY+(tY-sY)*(d-aSize-tSize)/d,vX=(tX-sX)*aSize/d,vY=(tY-sY)*aSize/d;if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(sX,sY);context.lineTo(aX,aY);context.stroke();context.fillStyle=color;context.beginPath();context.moveTo(aX+vX,aY+vY);context.lineTo(aX+vY*.6,aY-vX*.6);context.lineTo(aX-vY*.6,aY+vX*.6);context.lineTo(aX+vX,aY+vY);context.closePath();context.fill()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edges");sigma.canvas.edges.curvedArrow=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor"),cp={},size=edge[prefix+"size"]||1,tSize=target[prefix+"size"],sX=source[prefix+"x"],sY=source[prefix+"y"],tX=target[prefix+"x"],tY=target[prefix+"y"],aSize=Math.max(size*2.5,settings("minArrowSize")),d,aX,aY,vX,vY;cp=source.id===target.id?sigma.utils.getSelfLoopControlPoints(sX,sY,tSize):sigma.utils.getQuadraticControlPoint(sX,sY,tX,tY,edge.cc);if(source.id===target.id){d=Math.sqrt((tX-cp.x1)*(tX-cp.x1)+(tY-cp.y1)*(tY-cp.y1));aX=cp.x1+(tX-cp.x1)*(d-aSize-tSize)/d;aY=cp.y1+(tY-cp.y1)*(d-aSize-tSize)/d;vX=(tX-cp.x1)*aSize/d;vY=(tY-cp.y1)*aSize/d}else{d=Math.sqrt((tX-cp.x)*(tX-cp.x)+(tY-cp.y)*(tY-cp.y));aX=cp.x+(tX-cp.x)*(d-aSize-tSize)/d;aY=cp.y+(tY-cp.y)*(d-aSize-tSize)/d;vX=(tX-cp.x)*aSize/d;vY=(tY-cp.y)*aSize/d}if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(sX,sY);if(source.id===target.id){context.bezierCurveTo(cp.x2,cp.y2,cp.x1,cp.y1,aX,aY)}else{context.quadraticCurveTo(cp.x,cp.y,aX,aY)}context.stroke();context.fillStyle=color;context.beginPath();context.moveTo(aX+vX,aY+vY);context.lineTo(aX+vY*.6,aY-vX*.6);context.lineTo(aX-vY*.6,aY+vX*.6);context.lineTo(aX+vX,aY+vY);context.closePath();context.fill()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edgehovers");sigma.canvas.edgehovers.def=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",size=edge[prefix+"size"]||1,edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor");if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}if(settings("edgeHoverColor")==="edge"){color=edge.hover_color||color}else{color=edge.hover_color||settings("defaultEdgeHoverColor")||color}size*=settings("edgeHoverSizeRatio");context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(source[prefix+"x"],source[prefix+"y"]);context.lineTo(target[prefix+"x"],target[prefix+"y"]);context.stroke()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edgehovers");sigma.canvas.edgehovers.curve=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",size=settings("edgeHoverSizeRatio")*(edge[prefix+"size"]||1),edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor"),cp={},sSize=source[prefix+"size"],sX=source[prefix+"x"],sY=source[prefix+"y"],tX=target[prefix+"x"],tY=target[prefix+"y"];cp=source.id===target.id?sigma.utils.getSelfLoopControlPoints(sX,sY,sSize):sigma.utils.getQuadraticControlPoint(sX,sY,tX,tY,edge.cc);if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}if(settings("edgeHoverColor")==="edge"){color=edge.hover_color||color}else{color=edge.hover_color||settings("defaultEdgeHoverColor")||color}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(sX,sY);if(source.id===target.id){context.bezierCurveTo(cp.x1,cp.y1,cp.x2,cp.y2,tX,tY)}else{context.quadraticCurveTo(cp.x,cp.y,tX,tY)}context.stroke()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edgehovers");sigma.canvas.edgehovers.arrow=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor"),size=edge[prefix+"size"]||1,tSize=target[prefix+"size"],sX=source[prefix+"x"],sY=source[prefix+"y"],tX=target[prefix+"x"],tY=target[prefix+"y"];size=edge.hover?settings("edgeHoverSizeRatio")*size:size;var aSize=size*2.5,d=Math.sqrt((tX-sX)*(tX-sX)+(tY-sY)*(tY-sY)),aX=sX+(tX-sX)*(d-aSize-tSize)/d,aY=sY+(tY-sY)*(d-aSize-tSize)/d,vX=(tX-sX)*aSize/d,vY=(tY-sY)*aSize/d;if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}if(settings("edgeHoverColor")==="edge"){color=edge.hover_color||color}else{color=edge.hover_color||settings("defaultEdgeHoverColor")||color}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(sX,sY);context.lineTo(aX,aY);context.stroke();context.fillStyle=color;context.beginPath();context.moveTo(aX+vX,aY+vY);context.lineTo(aX+vY*.6,aY-vX*.6);context.lineTo(aX-vY*.6,aY+vX*.6);context.lineTo(aX+vX,aY+vY);context.closePath();context.fill()}})();(function(){"use strict";sigma.utils.pkg("sigma.canvas.edgehovers");sigma.canvas.edgehovers.curvedArrow=function(edge,source,target,context,settings){var color=edge.color,prefix=settings("prefix")||"",edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor"),cp={},size=settings("edgeHoverSizeRatio")*(edge[prefix+"size"]||1),tSize=target[prefix+"size"],sX=source[prefix+"x"],sY=source[prefix+"y"],tX=target[prefix+"x"],tY=target[prefix+"y"],d,aSize,aX,aY,vX,vY;cp=source.id===target.id?sigma.utils.getSelfLoopControlPoints(sX,sY,tSize):sigma.utils.getQuadraticControlPoint(sX,sY,tX,tY,edge.cc);if(source.id===target.id){d=Math.sqrt((tX-cp.x1)*(tX-cp.x1)+(tY-cp.y1)*(tY-cp.y1));aSize=size*2.5;aX=cp.x1+(tX-cp.x1)*(d-aSize-tSize)/d;aY=cp.y1+(tY-cp.y1)*(d-aSize-tSize)/d;vX=(tX-cp.x1)*aSize/d;vY=(tY-cp.y1)*aSize/d}else{d=Math.sqrt((tX-cp.x)*(tX-cp.x)+(tY-cp.y)*(tY-cp.y));aSize=size*2.5;aX=cp.x+(tX-cp.x)*(d-aSize-tSize)/d;aY=cp.y+(tY-cp.y)*(d-aSize-tSize)/d;vX=(tX-cp.x)*aSize/d;vY=(tY-cp.y)*aSize/d}if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}if(settings("edgeHoverColor")==="edge"){color=edge.hover_color||color}else{color=edge.hover_color||settings("defaultEdgeHoverColor")||color}context.strokeStyle=color;context.lineWidth=size;context.beginPath();context.moveTo(sX,sY);if(source.id===target.id){context.bezierCurveTo(cp.x2,cp.y2,cp.x1,cp.y1,aX,aY)}else{context.quadraticCurveTo(cp.x,cp.y,aX,aY)}context.stroke();context.fillStyle=color;context.beginPath();context.moveTo(aX+vX,aY+vY);context.lineTo(aX+vY*.6,aY-vX*.6);context.lineTo(aX-vY*.6,aY+vX*.6);context.lineTo(aX+vX,aY+vY);context.closePath();context.fill()}})();(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.canvas.extremities");sigma.canvas.extremities.def=function(edge,source,target,context,settings){(sigma.canvas.hovers[source.type]||sigma.canvas.hovers.def)(source,context,settings);(sigma.canvas.hovers[target.type]||sigma.canvas.hovers.def)(target,context,settings)}}).call(this);(function(){"use strict";sigma.utils.pkg("sigma.svg.utils");sigma.svg.utils={
show:function(element){element.style.display="";return this},hide:function(element){element.style.display="none";return this}}})();(function(){"use strict";sigma.utils.pkg("sigma.svg.nodes");sigma.svg.nodes.def={create:function(node,settings){var prefix=settings("prefix")||"",circle=document.createElementNS(settings("xmlns"),"circle");circle.setAttributeNS(null,"data-node-id",node.id);circle.setAttributeNS(null,"class",settings("classPrefix")+"-node");circle.setAttributeNS(null,"fill",node.color||settings("defaultNodeColor"));return circle},update:function(node,circle,settings){var prefix=settings("prefix")||"";circle.setAttributeNS(null,"cx",node[prefix+"x"]);circle.setAttributeNS(null,"cy",node[prefix+"y"]);circle.setAttributeNS(null,"r",node[prefix+"size"]);if(!settings("freeStyle"))circle.setAttributeNS(null,"fill",node.color||settings("defaultNodeColor"));circle.style.display="";return this}}})();(function(){"use strict";sigma.utils.pkg("sigma.svg.edges");sigma.svg.edges.def={create:function(edge,source,target,settings){var color=edge.color,prefix=settings("prefix")||"",edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor");if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}var line=document.createElementNS(settings("xmlns"),"line");line.setAttributeNS(null,"data-edge-id",edge.id);line.setAttributeNS(null,"class",settings("classPrefix")+"-edge");line.setAttributeNS(null,"stroke",color);return line},update:function(edge,line,source,target,settings){var prefix=settings("prefix")||"";line.setAttributeNS(null,"stroke-width",edge[prefix+"size"]||1);line.setAttributeNS(null,"x1",source[prefix+"x"]);line.setAttributeNS(null,"y1",source[prefix+"y"]);line.setAttributeNS(null,"x2",target[prefix+"x"]);line.setAttributeNS(null,"y2",target[prefix+"y"]);line.style.display="";return this}}})();(function(){"use strict";sigma.utils.pkg("sigma.svg.edges");sigma.svg.edges.curve={create:function(edge,source,target,settings){var color=edge.color,prefix=settings("prefix")||"",edgeColor=settings("edgeColor"),defaultNodeColor=settings("defaultNodeColor"),defaultEdgeColor=settings("defaultEdgeColor");if(!color)switch(edgeColor){case"source":color=source.color||defaultNodeColor;break;case"target":color=target.color||defaultNodeColor;break;default:color=defaultEdgeColor;break}var path=document.createElementNS(settings("xmlns"),"path");path.setAttributeNS(null,"data-edge-id",edge.id);path.setAttributeNS(null,"class",settings("classPrefix")+"-edge");path.setAttributeNS(null,"stroke",color);return path},update:function(edge,path,source,target,settings){var prefix=settings("prefix")||"";path.setAttributeNS(null,"stroke-width",edge[prefix+"size"]||1);var cx=(source[prefix+"x"]+target[prefix+"x"])/2+(target[prefix+"y"]-source[prefix+"y"])/4,cy=(source[prefix+"y"]+target[prefix+"y"])/2+(source[prefix+"x"]-target[prefix+"x"])/4;var p="M"+source[prefix+"x"]+","+source[prefix+"y"]+" "+"Q"+cx+","+cy+" "+target[prefix+"x"]+","+target[prefix+"y"];path.setAttributeNS(null,"d",p);path.setAttributeNS(null,"fill","none");path.style.display="";return this}}})();(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.svg.labels");sigma.svg.labels.def={create:function(node,settings){var prefix=settings("prefix")||"",size=node[prefix+"size"],text=document.createElementNS(settings("xmlns"),"text");var fontSize=settings("labelSize")==="fixed"?settings("defaultLabelSize"):settings("labelSizeRatio")*size;var fontColor=settings("labelColor")==="node"?node.color||settings("defaultNodeColor"):settings("defaultLabelColor");text.setAttributeNS(null,"data-label-target",node.id);text.setAttributeNS(null,"class",settings("classPrefix")+"-label");text.setAttributeNS(null,"font-size",fontSize);text.setAttributeNS(null,"font-family",settings("font"));text.setAttributeNS(null,"fill",fontColor);text.innerHTML=node.label;text.textContent=node.label;return text},update:function(node,text,settings){var prefix=settings("prefix")||"",size=node[prefix+"size"];var fontSize=settings("labelSize")==="fixed"?settings("defaultLabelSize"):settings("labelSizeRatio")*size;if(!settings("forceLabels")&&size<settings("labelThreshold"))return;if(typeof node.label!=="string")return;text.setAttributeNS(null,"x",Math.round(node[prefix+"x"]+size+3));text.setAttributeNS(null,"y",Math.round(node[prefix+"y"]+fontSize/3));text.style.display="";return this}}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.svg.hovers");sigma.svg.hovers.def={create:function(node,nodeCircle,measurementCanvas,settings){var x,y,w,h,e,d,fontStyle=settings("hoverFontStyle")||settings("fontStyle"),prefix=settings("prefix")||"",size=node[prefix+"size"],fontSize=settings("labelSize")==="fixed"?settings("defaultLabelSize"):settings("labelSizeRatio")*size,fontColor=settings("labelHoverColor")==="node"?node.color||settings("defaultNodeColor"):settings("defaultLabelHoverColor");var group=document.createElementNS(settings("xmlns"),"g"),rectangle=document.createElementNS(settings("xmlns"),"rect"),circle=document.createElementNS(settings("xmlns"),"circle"),text=document.createElementNS(settings("xmlns"),"text");group.setAttributeNS(null,"class",settings("classPrefix")+"-hover");group.setAttributeNS(null,"data-node-id",node.id);if(typeof node.label==="string"){text.innerHTML=node.label;text.textContent=node.label;text.setAttributeNS(null,"class",settings("classPrefix")+"-hover-label");text.setAttributeNS(null,"font-size",fontSize);text.setAttributeNS(null,"font-family",settings("font"));text.setAttributeNS(null,"fill",fontColor);text.setAttributeNS(null,"x",Math.round(node[prefix+"x"]+size+3));text.setAttributeNS(null,"y",Math.round(node[prefix+"y"]+fontSize/3));x=Math.round(node[prefix+"x"]-fontSize/2-2);y=Math.round(node[prefix+"y"]-fontSize/2-2);w=Math.round(measurementCanvas.measureText(node.label).width+fontSize/2+size+9);h=Math.round(fontSize+4);e=Math.round(fontSize/2+2);circle.setAttributeNS(null,"class",settings("classPrefix")+"-hover-area");circle.setAttributeNS(null,"fill","#fff");circle.setAttributeNS(null,"cx",node[prefix+"x"]);circle.setAttributeNS(null,"cy",node[prefix+"y"]);circle.setAttributeNS(null,"r",e);rectangle.setAttributeNS(null,"class",settings("classPrefix")+"-hover-area");rectangle.setAttributeNS(null,"fill","#fff");rectangle.setAttributeNS(null,"x",node[prefix+"x"]+e/4);rectangle.setAttributeNS(null,"y",node[prefix+"y"]-e);rectangle.setAttributeNS(null,"width",w);rectangle.setAttributeNS(null,"height",h)}group.appendChild(circle);group.appendChild(rectangle);group.appendChild(text);group.appendChild(nodeCircle);return group}}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.middlewares");sigma.utils.pkg("sigma.utils");sigma.middlewares.rescale=function(readPrefix,writePrefix,options){var i,l,a,b,c,d,scale,margin,n=this.graph.nodes(),e=this.graph.edges(),settings=this.settings.embedObjects(options||{}),bounds=settings("bounds")||sigma.utils.getBoundaries(this.graph,readPrefix,true),minX=bounds.minX,minY=bounds.minY,maxX=bounds.maxX,maxY=bounds.maxY,sizeMax=bounds.sizeMax,weightMax=bounds.weightMax,w=settings("width")||1,h=settings("height")||1,rescaleSettings=settings("autoRescale"),validSettings={nodePosition:1,nodeSize:1,edgeSize:1};if(!(rescaleSettings instanceof Array))rescaleSettings=["nodePosition","nodeSize","edgeSize"];for(i=0,l=rescaleSettings.length;i<l;i++)if(!validSettings[rescaleSettings[i]])throw new Error('The rescale setting "'+rescaleSettings[i]+'" is not recognized.');var np=~rescaleSettings.indexOf("nodePosition"),ns=~rescaleSettings.indexOf("nodeSize"),es=~rescaleSettings.indexOf("edgeSize");scale=settings("scalingMode")==="outside"?Math.max(w/Math.max(maxX-minX,1),h/Math.max(maxY-minY,1)):Math.min(w/Math.max(maxX-minX,1),h/Math.max(maxY-minY,1));margin=(settings("rescaleIgnoreSize")?0:(settings("maxNodeSize")||sizeMax)/scale)+(settings("sideMargin")||0);maxX+=margin;minX-=margin;maxY+=margin;minY-=margin;scale=settings("scalingMode")==="outside"?Math.max(w/Math.max(maxX-minX,1),h/Math.max(maxY-minY,1)):Math.min(w/Math.max(maxX-minX,1),h/Math.max(maxY-minY,1));if(!settings("maxNodeSize")&&!settings("minNodeSize")){a=1;b=0}else if(settings("maxNodeSize")===settings("minNodeSize")){a=0;b=+settings("maxNodeSize")}else{a=(settings("maxNodeSize")-settings("minNodeSize"))/sizeMax;b=+settings("minNodeSize")}if(!settings("maxEdgeSize")&&!settings("minEdgeSize")){c=1;d=0}else if(settings("maxEdgeSize")===settings("minEdgeSize")){c=0;d=+settings("minEdgeSize")}else{c=(settings("maxEdgeSize")-settings("minEdgeSize"))/weightMax;d=+settings("minEdgeSize")}for(i=0,l=e.length;i<l;i++)e[i][writePrefix+"size"]=e[i][readPrefix+"size"]*(es?c:1)+(es?d:0);for(i=0,l=n.length;i<l;i++){n[i][writePrefix+"size"]=n[i][readPrefix+"size"]*(ns?a:1)+(ns?b:0);n[i][writePrefix+"x"]=(n[i][readPrefix+"x"]-(maxX+minX)/2)*(np?scale:1);n[i][writePrefix+"y"]=(n[i][readPrefix+"y"]-(maxY+minY)/2)*(np?scale:1)}};sigma.utils.getBoundaries=function(graph,prefix,doEdges){var i,l,e=graph.edges(),n=graph.nodes(),weightMax=-Infinity,sizeMax=-Infinity,minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;if(doEdges)for(i=0,l=e.length;i<l;i++)weightMax=Math.max(e[i][prefix+"size"],weightMax);for(i=0,l=n.length;i<l;i++){sizeMax=Math.max(n[i][prefix+"size"],sizeMax);maxX=Math.max(n[i][prefix+"x"],maxX);minX=Math.min(n[i][prefix+"x"],minX);maxY=Math.max(n[i][prefix+"y"],maxY);minY=Math.min(n[i][prefix+"y"],minY)}weightMax=weightMax||1;sizeMax=sizeMax||1;return{weightMax:weightMax,sizeMax:sizeMax,minX:minX,minY:minY,maxX:maxX,maxY:maxY}}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.middlewares");sigma.middlewares.copy=function(readPrefix,writePrefix){var i,l,a;if(writePrefix+""===readPrefix+"")return;a=this.graph.nodes();for(i=0,l=a.length;i<l;i++){a[i][writePrefix+"x"]=a[i][readPrefix+"x"];a[i][writePrefix+"y"]=a[i][readPrefix+"y"];a[i][writePrefix+"size"]=a[i][readPrefix+"size"]}a=this.graph.edges();for(i=0,l=a.length;i<l;i++)a[i][writePrefix+"size"]=a[i][readPrefix+"size"]}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.misc.animation.running");var _getID=function(){var id=0;return function(){return""+ ++id}}();sigma.misc.animation.camera=function(camera,val,options){if(!(camera instanceof sigma.classes.camera)||typeof val!=="object"||!val)throw"animation.camera: Wrong arguments.";if(typeof val.x!=="number"&&typeof val.y!=="number"&&typeof val.ratio!=="number"&&typeof val.angle!=="number")throw"There must be at least one valid coordinate in the given val.";var fn,id,anim,easing,duration,initialVal,o=options||{},start=sigma.utils.dateNow();initialVal={x:camera.x,y:camera.y,ratio:camera.ratio,angle:camera.angle};duration=o.duration;easing=typeof o.easing!=="function"?sigma.utils.easings[o.easing||"quadraticInOut"]:o.easing;fn=function(){var coef,t=o.duration?(sigma.utils.dateNow()-start)/o.duration:1;if(t>=1){camera.isAnimated=false;camera.goTo({x:val.x!==undefined?val.x:initialVal.x,y:val.y!==undefined?val.y:initialVal.y,ratio:val.ratio!==undefined?val.ratio:initialVal.ratio,angle:val.angle!==undefined?val.angle:initialVal.angle});cancelAnimationFrame(id);delete sigma.misc.animation.running[id];if(typeof o.onComplete==="function")o.onComplete()}else{coef=easing(t);camera.isAnimated=true;camera.goTo({x:val.x!==undefined?initialVal.x+(val.x-initialVal.x)*coef:initialVal.x,y:val.y!==undefined?initialVal.y+(val.y-initialVal.y)*coef:initialVal.y,ratio:val.ratio!==undefined?initialVal.ratio+(val.ratio-initialVal.ratio)*coef:initialVal.ratio,angle:val.angle!==undefined?initialVal.angle+(val.angle-initialVal.angle)*coef:initialVal.angle});if(typeof o.onNewFrame==="function")o.onNewFrame();anim.frameId=requestAnimationFrame(fn)}};id=_getID();anim={frameId:requestAnimationFrame(fn),target:camera,type:"camera",options:o,fn:fn};sigma.misc.animation.running[id]=anim;return id};sigma.misc.animation.kill=function(id){if(arguments.length!==1||typeof id!=="number")throw"animation.kill: Wrong arguments.";var o=sigma.misc.animation.running[id];if(o){cancelAnimationFrame(id);delete sigma.misc.animation.running[o.frameId];if(o.type==="camera")o.target.isAnimated=false;if(typeof(o.options||{}).onComplete==="function")o.options.onComplete()}return this};sigma.misc.animation.killAll=function(filter){var o,id,count=0,type=typeof filter==="string"?filter:null,target=typeof filter==="object"?filter:null,running=sigma.misc.animation.running;for(id in running)if((!type||running[id].type===type)&&(!target||running[id].target===target)){o=sigma.misc.animation.running[id];cancelAnimationFrame(o.frameId);delete sigma.misc.animation.running[id];if(o.type==="camera")o.target.isAnimated=false;count++;if(typeof(o.options||{}).onComplete==="function")o.options.onComplete()}return count};sigma.misc.animation.has=function(filter){var id,type=typeof filter==="string"?filter:null,target=typeof filter==="object"?filter:null,running=sigma.misc.animation.running;for(id in running)if((!type||running[id].type===type)&&(!target||running[id].target===target))return true;return false}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.misc");sigma.misc.bindEvents=function(prefix){var i,l,mX,mY,captor,self=this;function getNodes(e){if(e){mX="x"in e.data?e.data.x:mX;mY="y"in e.data?e.data.y:mY}var i,j,l,n,x,y,s,inserted,selected=[],modifiedX=mX+self.width/2,modifiedY=mY+self.height/2,point=self.camera.cameraPosition(mX,mY),nodes=self.camera.quadtree.point(point.x,point.y);if(nodes.length)for(i=0,l=nodes.length;i<l;i++){n=nodes[i];x=n[prefix+"x"];y=n[prefix+"y"];s=n[prefix+"size"];if(!n.hidden&&modifiedX>x-s&&modifiedX<x+s&&modifiedY>y-s&&modifiedY<y+s&&Math.sqrt((modifiedX-x)*(modifiedX-x)+(modifiedY-y)*(modifiedY-y))<s){inserted=false;for(j=0;j<selected.length;j++)if(n.size>selected[j].size){selected.splice(j,0,n);inserted=true;break}if(!inserted)selected.push(n)}}return selected}function getEdges(e){if(!self.settings("enableEdgeHovering")){return[]}var isCanvas=sigma.renderers.canvas&&self instanceof sigma.renderers.canvas;if(!isCanvas){throw new Error("The edge events feature is not compatible with the WebGL renderer")}if(e){mX="x"in e.data?e.data.x:mX;mY="y"in e.data?e.data.y:mY}var i,j,l,a,edge,s,maxEpsilon=self.settings("edgeHoverPrecision"),source,target,cp,nodeIndex={},inserted,selected=[],modifiedX=mX+self.width/2,modifiedY=mY+self.height/2,point=self.camera.cameraPosition(mX,mY),edges=[];if(isCanvas){var nodesOnScreen=self.camera.quadtree.area(self.camera.getRectangle(self.width,self.height));for(a=nodesOnScreen,i=0,l=a.length;i<l;i++)nodeIndex[a[i].id]=a[i]}if(self.camera.edgequadtree!==undefined){edges=self.camera.edgequadtree.point(point.x,point.y)}function insertEdge(selected,edge){inserted=false;for(j=0;j<selected.length;j++)if(edge.size>selected[j].size){selected.splice(j,0,edge);inserted=true;break}if(!inserted)selected.push(edge)}if(edges.length)for(i=0,l=edges.length;i<l;i++){edge=edges[i];source=self.graph.nodes(edge.source);target=self.graph.nodes(edge.target);s=edge[prefix+"size"]||edge["read_"+prefix+"size"];if(!edge.hidden&&!source.hidden&&!target.hidden&&(!isCanvas||(nodeIndex[edge.source]||nodeIndex[edge.target]))&&sigma.utils.getDistance(source[prefix+"x"],source[prefix+"y"],modifiedX,modifiedY)>source[prefix+"size"]&&sigma.utils.getDistance(target[prefix+"x"],target[prefix+"y"],modifiedX,modifiedY)>target[prefix+"size"]){if(edge.type=="curve"||edge.type=="curvedArrow"){if(source.id===target.id){cp=sigma.utils.getSelfLoopControlPoints(source[prefix+"x"],source[prefix+"y"],source[prefix+"size"]);if(sigma.utils.isPointOnBezierCurve(modifiedX,modifiedY,source[prefix+"x"],source[prefix+"y"],target[prefix+"x"],target[prefix+"y"],cp.x1,cp.y1,cp.x2,cp.y2,Math.max(s,maxEpsilon))){insertEdge(selected,edge)}}else{cp=sigma.utils.getQuadraticControlPoint(source[prefix+"x"],source[prefix+"y"],target[prefix+"x"],target[prefix+"y"],edge.cc);if(sigma.utils.isPointOnQuadraticCurve(modifiedX,modifiedY,source[prefix+"x"],source[prefix+"y"],target[prefix+"x"],target[prefix+"y"],cp.x,cp.y,Math.max(s,maxEpsilon))){insertEdge(selected,edge)}}}else if(sigma.utils.isPointOnSegment(modifiedX,modifiedY,source[prefix+"x"],source[prefix+"y"],target[prefix+"x"],target[prefix+"y"],Math.max(s,maxEpsilon))){insertEdge(selected,edge)}}}return selected}function bindCaptor(captor){var nodes,edges,overNodes={},overEdges={};function onClick(e){if(!self.settings("eventsEnabled"))return;self.dispatchEvent("click",e.data);nodes=getNodes(e);edges=getEdges(e);if(nodes.length){self.dispatchEvent("clickNode",{node:nodes[0],captor:e.data});self.dispatchEvent("clickNodes",{node:nodes,captor:e.data})}else if(edges.length){self.dispatchEvent("clickEdge",{edge:edges[0],captor:e.data});self.dispatchEvent("clickEdges",{edge:edges,captor:e.data})}else self.dispatchEvent("clickStage",{captor:e.data})}function onDoubleClick(e){if(!self.settings("eventsEnabled"))return;self.dispatchEvent("doubleClick",e.data);nodes=getNodes(e);edges=getEdges(e);if(nodes.length){self.dispatchEvent("doubleClickNode",{node:nodes[0],captor:e.data});self.dispatchEvent("doubleClickNodes",{node:nodes,captor:e.data})}else if(edges.length){self.dispatchEvent("doubleClickEdge",{edge:edges[0],captor:e.data});self.dispatchEvent("doubleClickEdges",{edge:edges,captor:e.data})}else self.dispatchEvent("doubleClickStage",{captor:e.data})}function onRightClick(e){if(!self.settings("eventsEnabled"))return;self.dispatchEvent("rightClick",e.data);nodes=getNodes(e);edges=getEdges(e);if(nodes.length){self.dispatchEvent("rightClickNode",{node:nodes[0],captor:e.data});self.dispatchEvent("rightClickNodes",{node:nodes,captor:e.data})}else if(edges.length){self.dispatchEvent("rightClickEdge",{edge:edges[0],captor:e.data});self.dispatchEvent("rightClickEdges",{edge:edges,captor:e.data})}else self.dispatchEvent("rightClickStage",{captor:e.data})}function onOut(e){if(!self.settings("eventsEnabled"))return;var k,event={current:{nodes:[],edges:[]},enter:{nodes:[],edges:[]},leave:{nodes:[],edges:[]},captor:e.data},leave=event.leave;for(k in overNodes)leave.nodes.push(overNodes[k]);for(k in overEdges)leave.edges.push(overEdges[k]);overNodes={};overEdges={};if(leave.nodes.length||leave.edges.length){self.dispatchEvent("hovers",event)}}function onMove(e){if(!self.settings("eventsEnabled"))return;nodes=getNodes(e);edges=getEdges(e);var i,k,node,edge,newOutNodes=[],newOverNodes=[],currentOverNodes={},newOutEdges=[],newOverEdges=[],currentOverEdges={};for(i=0;i<nodes.length;i++){node=nodes[i];currentOverNodes[node.id]=node;if(!overNodes[node.id]){newOverNodes.push(node);overNodes[node.id]=node}}for(k in overNodes)if(!currentOverNodes[k]){newOutNodes.push(overNodes[k]);delete overNodes[k]}for(i=0;i<edges.length;i++){edge=edges[i];currentOverEdges[edge.id]=edge;if(!overEdges[edge.id]){newOverEdges.push(edge);overEdges[edge.id]=edge}}for(k in overEdges)if(!currentOverEdges[k]){newOutEdges.push(overEdges[k]);delete overEdges[k]}if(newOutEdges.length||newOverEdges.length||newOutNodes.length||newOverNodes.length){self.dispatchEvent("hovers",{current:{nodes:nodes,edges:edges},enter:{nodes:newOverNodes,edges:newOverEdges},leave:{nodes:newOutNodes,edges:newOutEdges},captor:e.data})}}captor.bind("click",onClick);captor.bind("mousedown",onMove);captor.bind("mouseup",onMove);captor.bind("mousemove",onMove);captor.bind("mouseout",onOut);captor.bind("doubleclick",onDoubleClick);captor.bind("rightclick",onRightClick)}for(i=0,l=this.captors.length;i<l;i++)bindCaptor(this.captors[i])}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.misc");sigma.misc.bindDOMEvents=function(container){var self=this,graph=this.graph,hovered={nodes:[],edges:[]};function Element(domElement){this.attr=function(attrName){return domElement.getAttributeNS(null,attrName)};this.tag=domElement.tagName;this.class=this.attr("class");this.id=this.attr("id");this.isNode=function(){return!!~this.class.indexOf(self.settings("classPrefix")+"-node")};this.isEdge=function(){return!!~this.class.indexOf(self.settings("classPrefix")+"-edge")};this.isHover=function(){return!!~this.class.indexOf(self.settings("classPrefix")+"-hover")}}function click(e){if(!self.settings("eventsEnabled"))return;self.dispatchEvent("click",sigma.utils.mouseCoords(e));var element=new Element(e.target);if(element.isNode())self.dispatchEvent("clickNode",{node:graph.nodes(element.attr("data-node-id"))});else self.dispatchEvent("clickStage");e.preventDefault();e.stopPropagation()}function doubleClick(e){if(!self.settings("eventsEnabled"))return;self.dispatchEvent("doubleClick",sigma.utils.mouseCoords(e));var element=new Element(e.target);if(element.isNode())self.dispatchEvent("doubleClickNode",{node:graph.nodes(element.attr("data-node-id"))});else self.dispatchEvent("doubleClickStage");e.preventDefault();e.stopPropagation()}function onOver(e){var target=e.toElement||e.target;if(!self.settings("eventsEnabled")||!target)return;var el_svg=new Element(target),event={leave:{nodes:[],edges:[]},enter:{nodes:[],edges:[]},captor:sigma.utils.mouseCoords(e)},el;if(el_svg.isNode()){el=graph.nodes(el_svg.attr("data-node-id"));event.enter.nodes=[el];hovered.nodes.push(el)}else if(el_svg.isEdge()){el=graph.edges(el_svg.attr("data-edge-id"));event.enter.edges=[el];hovered.edges.push(el)}event.current=hovered;self.dispatchEvent("hovers",event)}function onOut(e){var target=e.fromElement||e.originalTarget;if(!self.settings("eventsEnabled"))return;var el_svg=new Element(target),event={leave:{nodes:[],edges:[]},enter:{nodes:[],edges:[]},captor:sigma.utils.mouseCoords(e)},el;if(el_svg.isNode()){el=graph.nodes(el_svg.attr("data-node-id"));event.leave.nodes=[el];hovered.nodes.push(el)}else if(el_svg.isEdge()){el=graph.edges(el_svg.attr("data-edge-id"));event.leave.edges=[el];hovered.edges.push(el)}else{return}event.current=hovered;self.dispatchEvent("hovers",event)}container.addEventListener("click",click,false);sigma.utils.doubleClick(container,"click",doubleClick);container.addEventListener("touchstart",click,false);sigma.utils.doubleClick(container,"touchstart",doubleClick);container.addEventListener("mouseover",onOver,true);container.addEventListener("mouseout",onOut,true)}}).call(this);(function(undefined){"use strict";if(typeof sigma==="undefined")throw"sigma is not declared";sigma.utils.pkg("sigma.misc");sigma.misc.drawHovers=function(prefix){var self=this,current={nodes:[],edges:[]};this.bind("hovers",function(event){current=event.data.current;draw()});this.bind("render",function(event){draw()});function draw(){var c=self.contexts.hover.canvas,embedSettings=self.settings.embedObjects({prefix:prefix}),end=embedSettings("singleHover")?1:undefined,renderParams={elements:current.nodes,renderers:sigma.canvas.hovers,type:"nodes",ctx:self.contexts.hover,end:end,graph:self.graph,settings:embedSettings};self.contexts.hover.clearRect(0,0,c.width,c.height);if(current.nodes.length>0&&embedSettings("enableHovering")){sigma.renderers.canvas.applyRenderers(renderParams)}if(current.edges.length>0&&embedSettings("enableEdgeHovering")){renderParams.renderers=sigma.canvas.edgehovers;renderParams.elements=current.edges;renderParams.type="edges";sigma.renderers.canvas.applyRenderers(renderParams);if(embedSettings("edgeHoverExtremities")){renderParams.renderers=sigma.canvas.extremities;sigma.renderers.canvas.applyRenderers(renderParams)}else{renderParams.ctx=self.contexts.nodes;renderParams.type="nodes";renderParams.renderers=sigma.canvas.nodes;renderParams.elements=current.nodes;sigma.renderers.canvas.applyRenderers(renderParams)}}}}}).call(this);