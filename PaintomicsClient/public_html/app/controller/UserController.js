function UserController(){this.getUserViewsDialog=function(width,height){var userViewsDialog=Ext.getCmp("userViewsDialog");if(userViewsDialog==null){userViewsDialog=Ext.create("Ext.window.Window",{id:"userViewsDialog",modal:true,closable:false,items:[]})}userViewsDialog.setHeight(height);userViewsDialog.setWidth(width);userViewsDialog.center();return userViewsDialog};this.signInLinkClickHandler=function(){var userViewsDialog=this.getUserViewsDialog(700,400);var signInPanel=new SignInPanel;signInPanel.setController(this);userViewsDialog.removeAll();userViewsDialog.add(signInPanel.getComponent());userViewsDialog.setLoading(false);userViewsDialog.show()};this.signInButtonClickHandler=function(userView){var signInForm=userView.getComponent().queryById("signInForm");if(signInForm.isValid()){$.ajax({type:"POST",url:SERVER_URL_UM_SIGNIN,data:signInForm.getForm().getValues(),success:function(response){if(response.success===false){$("#invalidUserPassMessage").html(response.message.split("ERROR MESSAGE:")[1]);$("#invalidUserPassMessage").fadeIn();return}$("#invalidUserPassMessage").fadeOut();Ext.util.Cookies.set("lastEmail",signInForm.getForm().getValues().email,null,location.pathname);Ext.util.Cookies.set("sessionToken",response.sessionToken,null,location.pathname);Ext.util.Cookies.set("userID",response.userID,null,location.pathname);Ext.util.Cookies.set("userName",response.userName,null,location.pathname);var userViewsDialog=Ext.getCmp("userViewsDialog");if(userViewsDialog!=null){userViewsDialog.close()}showSuccessMessage("Welcome back "+response.userName,{message:response.loginMessage!==null?response.loginMessage.message_content:"",logMessage:"Signed in as "+response.userName,callback:function(){application.getController("JobController").resetButtonClickHandler(null,true);location.reload()}})},error:ajaxErrorHandler})}};this.signUpLinkClickHandler=function(userView){var userViewsDialog=this.getUserViewsDialog(440,520);userViewsDialog.setLoading(true);var signUpPanel=new SignUpPanel;signUpPanel.setController(this);userViewsDialog.removeAll();userViewsDialog.add(signUpPanel.getComponent());userViewsDialog.setLoading(false);userViewsDialog.show()};this.signUpButtonClickHandler=function(userView){var signUpForm=userView.getComponent().queryById("signUpForm");if(signUpForm.isValid()){$.ajax({type:"POST",url:SERVER_URL_UM_SIGNUP,data:signUpForm.getForm().getValues(),success:function(response){if(response.success===false){$("#invalidSignUpMessage").html(response.message.split("ERROR MESSAGE:")[1]);$("#invalidSignUpMessage").fadeIn();return}$("#invalidSignUpMessage").fadeOut();userView.showCongratzPanel();Ext.util.Cookies.set("lastEmail",signUpForm.getForm().getValues().email,null,location.pathname)},error:ajaxErrorHandler})}};this.signUpCloseButtonClickHandler=function(userView){var userViewsDialog=Ext.getCmp("userViewsDialog");if(userViewsDialog!=null){userViewsDialog.close()}};this.forgotPassLinkClickHandler=function(userView){alert("Not implemented yet")};this.changePassLinkClickHandler=function(){var userViewsDialog=this.getUserViewsDialog(440,300);userViewsDialog.setLoading(true);var changePasswordPanel=new ChangePasswordPanel;changePasswordPanel.setController(this);userViewsDialog.removeAll();userViewsDialog.add(changePasswordPanel.getComponent());userViewsDialog.setLoading(false);userViewsDialog.show()};this.changePasswordAcceptButtonClickHandler=function(userView){var changePassForm=userView.getComponent().queryById("changePassForm");if(changePassForm.isValid()){$.ajax({type:"POST",url:SERVER_URL_UM_CHANGEPASS,data:changePassForm.getForm().getValues(),success:function(response){userView.showSuccessPanel()},error:ajaxErrorHandler})}};this.changePasswordCancelButtonClickHandler=function(userView){var userViewsDialog=Ext.getCmp("userViewsDialog");if(userViewsDialog!=null){userViewsDialog.close()}};this.signOutButtonClickHandler=function(userView){$.ajax({type:"POST",url:SERVER_URL_UM_SIGNOUT,data:this.getCredentialsParams(),success:function(response){Ext.util.Cookies.clear("sessionToken",location.pathname);Ext.util.Cookies.clear("userID",location.pathname);Ext.util.Cookies.clear("userName",location.pathname);if(userView){userView.getComponent().updateLoginState()}application.getController("JobController").resetButtonClickHandler(null,true);location.reload()},error:ajaxErrorHandler})};this.startGuestSessionButtonClickHandler=function(userView){var me=this;$.ajax({type:"POST",url:SERVER_URL_UM_NEWGUESTSESSION,success:function(response){Ext.util.Cookies.set("lastEmail",response.userName+"@paintomics.org",null,location.pathname);Ext.util.Cookies.set("sessionToken",response.sessionToken,null,location.pathname);Ext.util.Cookies.set("userID",response.userID,null,location.pathname);Ext.util.Cookies.set("userName",response.userName,null,location.pathname);me.showGuestSessionDialog(response.userName+"@paintomics.org",response.p)},error:ajaxErrorHandler})};this.showGuestSessionDialog=function(email,p){var userViewsDialog=this.getUserViewsDialog(700,400);var guestSessionPanel=new GuestSessionPanel(email,p);guestSessionPanel.setController(this);guestSessionPanel.setParent(userViewsDialog);userViewsDialog.removeAll();userViewsDialog.add(guestSessionPanel.getComponent());userViewsDialog.setLoading(false);userViewsDialog.show()};this.myDataButtonClickHandler=function(userView){application.getController("DataManagementController").showMyDataPanelClickHandler(null)};this.getCredentialsParams=function(request_params){var credentials={};if(request_params!=null){credentials=request_params}credentials["sessionToken"]=Ext.util.Cookies.get("sessionToken");credentials["userID"]=Ext.util.Cookies.get("userID");return credentials}}