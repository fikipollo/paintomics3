Ext.define("Ext.grid.column.CheckColumnCustom",{extend:"Ext.grid.column.CheckColumn",alias:"widget.customcheckcolumn",innerCls:Ext.baseCSSPrefix+"grid-cell-inner-checkcolumn customcheckcolumn",renderer:function(value,meta){var classes="";if(this.disabled){meta.tdCls+=" "+this.disabledCls}if(value){classes="fa-check-square fa-checkedcheckcolumn"}else{classes="fa-square-o"}return'<i class="fa '+classes+'"></i>'}});Ext.define("Ext.grid.column.ActionCustom",{extend:"Ext.grid.column.Action",alias:["widget.customactioncolumn"],innerCls:Ext.baseCSSPrefix+"grid-cell-inner-action-col customactioncolumn",defaultRenderer:function(v,meta,record,rowIdx,colIdx,store,view){var me=this,prefix=Ext.baseCSSPrefix,scope=me.origScope||me,items=me.items,len=items.length,i=0,item,ret,disabled,tooltip;ret=Ext.isFunction(me.origRenderer)?me.origRenderer.apply(scope,arguments)||"":"";meta.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell";for(;i<len;i++){item=items[i];disabled=item.disabled||(item.isDisabled?item.isDisabled.call(item.scope||scope,view,rowIdx,colIdx,item,record):false);tooltip=disabled?null:item.tooltip||(item.getTip?item.getTip.apply(item.scope||scope,arguments):null);if(!item.hasActionConfiguration){item.stopSelection=me.stopSelection;item.disable=Ext.Function.bind(me.disableAction,me,[i],0);item.enable=Ext.Function.bind(me.enableAction,me,[i],0);item.hasActionConfiguration=true}ret+='<a href="'+(item.href!==undefined?item.href:"javascript:void(0)")+'" '+(item.style!==undefined?'style="'+item.style+'"':"")+' class="helpTip '+prefix+"action-col-icon "+prefix+"action-col-"+String(i)+" "+(disabled?prefix+"item-disabled":" ")+" "+(Ext.isFunction(item.getClass)?item.getClass.apply(item.scope||scope,arguments):item.iconCls||me.iconCls||"")+'"'+(tooltip?' title="'+tooltip+'"':"")+">"+'<i class="fa '+item.icon+'"></i> '+item.text+"</a>"}return ret},processEvent:function(type,view,cell,recordIndex,cellIndex,e,record,row){var me=this,target=e.getTarget(),match,item,fn,key=type=="keydown"&&e.getKey();if(key&&!Ext.fly(target).findParent(view.cellSelector)||target.nodeName==="I"){target=Ext.fly(cell).down("."+Ext.baseCSSPrefix+"action-col-icon",true)}if(target&&(match=target.className.match(me.actionIdRe))){item=me.items[parseInt(match[1],10)];if(item){if(type=="click"||(key==e.ENTER||key==e.SPACE)){fn=item.handler||me.handler;if(fn&&!item.disabled){fn.call(item.scope||me.origScope||me,view,recordIndex,cellIndex,item,e,record,row)}}else if(type=="mousedown"&&item.stopSelection!==false){return false}}}}});Ext.define("Ext.grid.LiveSearchGridPanel",{extend:"Ext.grid.Panel",alias:["widget.livesearchgrid"],requires:["Ext.toolbar.TextItem","Ext.form.field.Checkbox","Ext.form.field.Text"],searchValue:null,searchRegExp:null,caseSensitive:false,regExpMode:false,matchCls:"x-livesearch-match",tagsRe:/<[^>]*>/gm,tagsProtect:"",download:false,multidelete:false,stripeRows:true,viewConfig:{markDirty:false,listeners:{refresh:function(view){initializeTooltips(".helpTip")}}},regExpProtect:/\\|\/|\+|\\|\.|\[|\]|\{|\}|\?|\$|\*|\^|\|/gm,searchFor:"title",multiDeleteHandler:function(){console.error("multiDeleteHandler: Not implemented!");return this},initComponent:function(){var me=this;me.viewConfig.stripeRows=this.stripeRows;me.tbar=["Search",{xtype:"textfield",name:"searchField",hideLabel:true,width:200,listeners:{change:{fn:me.onTextFieldChange,scope:this,buffer:100}}},"-",{xtype:"checkbox",hideLabel:true,margin:"0 0 0 4px",handler:me.regExpToggle,scope:me},"Regular expression",{xtype:"checkbox",hideLabel:true,margin:"0 0 0 4px",handler:me.caseSensitiveToggle,scope:me},"Case sensitive","->",me.download!==false?'<a class="downloadXLS" href="javascript:void(0)"><i class="fa fa-file-excel-o"></i> Download as XLS</a>':"",me.multidelete!==false?'<a class="multiDelete" style="color:rgb(242, 105, 105);" href="javascript:void(0)"><i class="fa fa-trash"></i> Delete selected</a>':""];me.callParent(arguments)},afterRender:function(){var me=this;me.callParent(arguments);me.textField=me.down("textfield[name=searchField]");$("#"+this.el.id+" a.downloadXLS").click(function(){me.downloadExcelXml()});$("#"+this.el.id+" a.multiDelete").click(function(){me.multiDeleteHandler()})},getSearchValue:function(){var me=this;var value=me.textField.getValue();if(value===""){return null}if(!me.regExpMode){value=value.replace(me.regExpProtect,function(m){return"\\"+m})}else{try{new RegExp(value)}catch(error){return null}if(value==="^"||value==="$"){return null}}return value},onTextFieldChange:function(){var me=this,count=0;me.view.refresh();me.searchValue=me.getSearchValue();me.indexes=[];me.currentIndex=null;if(me.searchValue!==null){me.searchRegExp=new RegExp(me.searchValue,me.caseSensitive?"":"i");me.store.addFilter({id:"livesearch",property:me.searchFor,value:me.searchRegExp,root:"data"})}else{me.store.removeFilter("livesearch")}me.getSelectionModel().deselectAll();me.textField.focus()},caseSensitiveToggle:function(checkbox,checked){this.caseSensitive=checked;this.onTextFieldChange()},regExpToggle:function(checkbox,checked){this.regExpMode=checked;this.onTextFieldChange()}});Ext.form.field.Base.override({listeners:{boxready:function(){if(this.helpTip!==undefined&&this.labelEl!==undefined){var label=this.inputRow.dom,pos=label.innerHTML.indexOf("helpTip");if(pos===-1){$(label).append('<td style="width:15px"><span class="helpTip" style="float:right;" title="'+this.helpTip+'""></span></td>')}}}}});var Base64=function(){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}return{encode:typeof btoa=="function"?function(input){return btoa(utf8Encode(input))}:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=utf8Encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4)}return output}}}();Ext.define("Ext.view.override.Grid",{override:"Ext.grid.GridPanel",requires:"Ext.form.action.StandardSubmit",downloadExcelXml:function(){if(this.download===false){return}if(!this.download.title){this.download.title=this.title?this.title:"Noname"}if(!this.download.includeHidden){this.download.includeHidden=false}if(!this.download.ignoreColums){this.download.ignoreColums=[]}var vExportContent=this.getExcelXml(this.download.includeHidden,this.download.title,this.download.ignoreColums);var location="data:application/vnd.ms-excel;base64,"+Base64.encode(vExportContent);if(Ext.isChrome){var gridEl=this.getEl();var el=Ext.DomHelper.append(gridEl,{tag:"a",download:this.download.title.replace(/ /g,"_")+"-"+Ext.Date.format(new Date,"Y-m-d Hi")+".xls",href:location});el.click();Ext.fly(el).destroy()}else{var form=this.down("form#uploadForm");if(form){form.destroy()}form=this.add({xtype:"form",itemId:"uploadForm",hidden:true,standardSubmit:true,url:"http://webapps.figleaf.com/dataservices/Excel.cfc?method=echo&mimetype=application/vnd.ms-excel&filename="+escape(this.download.title.replace(/ /g,"_")+".xls"),items:[{xtype:"hiddenfield",name:"data",value:vExportContent}]});form.getForm().submit()}},getExcelXml:function(includeHidden,title,ignoreColumns){var theTitle=title||this.title;var worksheet=this.createWorksheet(includeHidden,theTitle,ignoreColumns);var totalWidth=this.columnManager.columns.length;return"".concat('<?xml version="1.0"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40">','<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office"><Title>'+theTitle+"</Title></DocumentProperties>",'<OfficeDocumentSettings xmlns="urn:schemas-microsoft-com:office:office"><AllowPNG/></OfficeDocumentSettings>','<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">',"<WindowHeight>"+worksheet.height+"</WindowHeight>","<WindowWidth>"+worksheet.width+"</WindowWidth>","<ProtectStructure>False</ProtectStructure>","<ProtectWindows>False</ProtectWindows>","</ExcelWorkbook>","<Styles>",'<Style ss:ID="Default" ss:Name="Normal">','<Alignment ss:Vertical="Bottom"/>',"<Borders/>",'<Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="12" ss:Color="#000000"/>',"<Interior/>","<NumberFormat/>","<Protection/>","</Style>",'<Style ss:ID="title">',"<Borders />",'<Font ss:Bold="1" ss:Size="18" />','<Alignment ss:Horizontal="Center" ss:Vertical="Center" ss:WrapText="1" />','<NumberFormat ss:Format="@" />',"</Style>",'<Style ss:ID="headercell">','<Font ss:Bold="1" ss:Size="14" />','<Alignment ss:Horizontal="Center" ss:WrapText="1" />','<Interior ss:Color="#A3C9F1" ss:Pattern="Solid" />',"</Style>",'<Style ss:ID="even">','<Interior ss:Color="#FAFAFA" ss:Pattern="Solid" />',"</Style>",'<Style ss:ID="evendate" ss:Parent="even">','<NumberFormat ss:Format="yyyy-mm-dd" />',"</Style>",'<Style ss:ID="evenint" ss:Parent="even">','<Alignment ss:Horizontal="Center" ss:WrapText="1" />','<Numberformat ss:Format="0" />',"</Style>",'<Style ss:ID="evenfloat" ss:Parent="even">','<Alignment ss:Horizontal="Center" ss:WrapText="1" />','<Numberformat ss:Format="0.00" />',"</Style>",'<Style ss:ID="odd">','<Interior ss:Color="#FFFFFF" ss:Pattern="Solid" />',"</Style>",'<Style ss:ID="groupSeparator">','<Interior ss:Color="#D3D3D3" ss:Pattern="Solid" />',"</Style>",'<Style ss:ID="odddate" ss:Parent="odd">','<NumberFormat ss:Format="yyyy-mm-dd" />',"</Style>",'<Style ss:ID="oddint" ss:Parent="odd">','<Alignment ss:Horizontal="Center" ss:WrapText="1" />','<NumberFormat Format="0" />',"</Style>",'<Style ss:ID="oddfloat" ss:Parent="odd">','<Alignment ss:Horizontal="Center" ss:WrapText="1" />','<NumberFormat Format="0.00" />',"</Style>","</Styles>",worksheet.xml,"</Workbook>")},getModelField:function(fieldName){var fields=this.store.model.getFields();for(var i=0;i<fields.length;i++){if(fields[i].name===fieldName){return fields[i]}}},generateEmptyGroupRow:function(dataIndex,value,cellTypes,includeHidden){var cm=this.columnManager.columns;var colCount=cm.length;var rowTpl='<Row ss:AutoFitHeight="0"><Cell ss:StyleID="groupSeparator" ss:MergeAcross="{0}"><Data ss:Type="String"><html:b>{1}</html:b></Data></Cell></Row>';var visibleCols=0;for(var j=0;j<colCount;j++){if(cm[j].xtype!="actioncolumn"&&cm[j].dataIndex!=""&&(includeHidden||!cm[j].hidden)){visibleCols++}}return Ext.String.format(rowTpl,visibleCols-1,value)},createWorksheet:function(includeHidden,theTitle,ignoreColumns){var cellType=[];var cellTypeClass=[];var cm=this.columnManager.columns;var colTitle="";var totalWidthInPixels=0,colXml="",headerXml="",visibleColumnCountReduction=0,colCount=cm.length;debugger;for(var i=0;i<colCount;i++){colTitle=cm[i].text.replace("</br>","");if(cm[i].xtype!="actioncolumn"&&cm[i].xtype!="customactioncolumn"&&cm[i].dataIndex!=""&&(includeHidden||!cm[i].hidden)&&ignoreColumns.indexOf(i+1)===-1){var w=cm[i].getEl().getWidth();totalWidthInPixels+=w;if(cm[i].text===""){cellType.push("None");cellTypeClass.push("");++visibleColumnCountReduction}else{colXml+='<Column ss:AutoFitWidth="1" ss:Width="'+w+'" />';headerXml+='<Cell ss:StyleID="headercell"><Data ss:Type="String">'+colTitle+'</Data><NamedCell ss:Name="Print_Titles"></NamedCell></Cell>';var fld=this.getModelField(cm[i].dataIndex);switch(fld.type.type){case"int":cellType.push("Number");cellTypeClass.push("int");break;case"float":cellType.push("Number");cellTypeClass.push("float");break;case"bool":case"boolean":cellType.push("String");cellTypeClass.push("");break;case"date":cellType.push("DateTime");cellTypeClass.push("date");break;default:cellType.push("String");cellTypeClass.push("");break}}}}var visibleColumnCount=cellType.length-visibleColumnCountReduction;var result={height:9e3,width:Math.floor(totalWidthInPixels*30)+50};var numGridRows=this.store.getCount()+2;if(!Ext.isEmpty(this.store.groupField)||this.store.groupers.items.length>0){numGridRows=numGridRows+this.store.getGroups().length}var t="".concat('<Worksheet ss:Name="'+theTitle+'">',"<Names>",'<NamedRange ss:Name="Print_Titles" ss:RefersTo="=\''+theTitle+"'!R1:R2\">","</NamedRange></Names>",'<Table ss:ExpandedColumnCount="'+(visibleColumnCount+2),'" ss:ExpandedRowCount="'+numGridRows+'" x:FullColumns="1" x:FullRows="1" ss:DefaultColumnWidth="65" ss:DefaultRowHeight="15">',colXml,'<Row ss:Height="38">','<Cell ss:MergeAcross="'+(visibleColumnCount-1)+'" ss:StyleID="title">','<Data ss:Type="String" xmlns:html="http://www.w3.org/TR/REC-html40">',"<html:b>"+theTitle+'</html:b></Data><NamedCell ss:Name="Print_Titles">',"</NamedCell></Cell>","</Row>",'<Row ss:AutoFitHeight="1">',headerXml+"</Row>");var groupVal="";var groupField="";if(this.store.groupers.keys.length>0){groupField=this.store.groupers.keys[0]}for(var i=0,it=this.store.data.items,l=it.length;i<l;i++){if(!Ext.isEmpty(groupField)){if(groupVal!=this.store.getAt(i).get(groupField)){groupVal=this.store.getAt(i).get(groupField);t+=this.generateEmptyGroupRow(groupField,groupVal,cellType,includeHidden)}}t+="<Row>";var cellClass=i&1?"odd":"even";r=it[i].data;var k=0;for(var j=0;j<colCount;j++){if(ignoreColumns.indexOf(j+1)===-1&&cm[j].xtype!="actioncolumn"&&cm[j].dataIndex!=""&&(includeHidden||!cm[j].hidden)){var v=r[cm[j].dataIndex];var celltype=cellType[k];if(v&&!isNaN(v)){celltype="Number";if(v%1!==0){cellTypeClass[k]="float"}else{cellTypeClass[k]="int"}}else if(v==="-"&&celltype==="Number"){celltype="String"}else if(v){v=v.replace("</br>","")}else{v=""}if(celltype!=="None"){t+='<Cell ss:StyleID="'+cellClass+(cellTypeClass[k]?cellTypeClass[k]:"")+'"><Data ss:Type="'+(celltype?celltype:"String")+'">';if(celltype=="DateTime"){t+=Ext.Date.format(v,"Y-m-d")}else{t+=v}t+="</Data></Cell>"}k++}}t+="</Row>"}result.xml=t.concat("</Table>",'<WorksheetOptions xmlns="urn:schemas-microsoft-com:office:excel">',"<PageLayoutZoom>0</PageLayoutZoom>","<Selected/>","<Panes>","<Pane>","<Number>3</Number>","<ActiveRow>2</ActiveRow>","</Pane>","</Panes>","<ProtectObjects>False</ProtectObjects>","<ProtectScenarios>False</ProtectScenarios>","</WorksheetOptions>","</Worksheet>");return result}});Ext.override(Ext.form.field.FileButton,{renderTpl:['<span id="{id}-btnWrap" class="{baseCls}-wrap','<tpl if="splitCls"> {splitCls}</tpl>','{childElCls}" unselectable="on">','<span id="{id}-btnEl" class="{baseCls}-button">','<span id="{id}-btnInnerEl" class="{baseCls}-inner {innerCls}','{childElCls}" unselectable="on">',"{text}","</span>",'<span role="img" id="{id}-btnIconEl" class="{baseCls}-icon-el {iconCls}','{childElCls} {glyphCls}" unselectable="on" style="','<tpl if="iconUrl">background-image:url({iconUrl});</tpl>','<tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>">','<tpl if="glyph">&#{glyph};</tpl><tpl if="iconCls || iconUrl"> </tpl>',"</span>","</span>","</span>",'<input id="{id}-fileInputEl" class="{childElCls} {inputCls}" type="file" size="1" ','name="{inputName}" <tpl if="disabled"> disabled="disabled"</tpl>>'],getTemplateArgs:function(){var args=this.callParent();args.inputCls=this.inputCls;args.inputName=this.inputName;args.disabled=this.disabled;return args},createFileInput:function(isTemporary){var me=this;me.fileInputEl=me.el.createChild(Ext.apply({name:me.inputName,id:!isTemporary?me.id+"-fileInputEl":undefined,cls:me.inputCls,tag:"input",type:"file",size:1},me.disabled?{disabled:true}:{}));me.fileInputEl.on("change",me.fireChange,me)}});Ext.applyIf(Ext.draw.Component.prototype,{pan:function(direction,distance){var me=this;if(Ext.isDefined(direction)){me.surface.el.move(direction,distance||75,true)}else{var el=me.surface.el,position=el.getStyle("position");if(position==="relative"){el.setStyle({position:"static",top:0,left:0})}}return me},drag:function(distX,distY){var me=this;if(distX<0){distX=Math.max(me.surface.el.getX()+distX,(me.surface.el.getWidth()-me.prevZoom*me.surface.el.getWidth())*1.5)}else{distX=Math.min(50,me.surface.el.getX()+distX)}if(distY<0){distY=Math.max(me.surface.el.getY()+distY,(me.surface.el.getHeight()-me.prevZoom*me.surface.el.getHeight())*1.5)}else{distY=Math.min(170,me.surface.el.getY()+distY)}me.surface.el.moveTo(distX,distY);return me},reset:function(){return this.pan().zoom()},prevZoom:1,zoom:function(zoom){var me=this;if(zoom<=100){me.pan()}function zoomFF(zoom){var size=me.getSize();me.surface.setViewBox(0,0,size.width*100/zoom,size.height*100/zoom)}function zoomWebKit(zoom){me.surface.el.setStyle({WebkitTransform:"scale("+zoom/100+")",WebkitTransformOrigin:"0 0",zoom:zoom+"%"})}if(Ext.isDefined(zoom)){me.prevZoom=zoom/100;var fn=Ext.isGecko?zoomFF:zoomWebKit;fn(zoom)}else{if(me.prevZoom!==1){me.zoom(100/me.prevZoom);me.prevZoom=1}}return me},setViewBox:function(){var me=this,bbox=me.surface.items.getBBox(),width=bbox.width,height=bbox.height,x=bbox.x,y=bbox.y;me.surface.setViewBox(x,y,width+5,height+5)}});(function(H){H.wrap(H.Series.prototype,"render",function(proceed){proceed.apply(this,Array.prototype.slice.call(arguments,1));if(this.xAxis&&this.xAxis.categories&&this.chart.options.heatmapSelector){this.showHeatmapSelector=function(x,y){var chart=this.chart;var renderer=chart.renderer;var axis=this.xAxis;var height=this.yAxis.height/this.yAxis.categories.length;var width=axis.len;x=x===undefined?axis.pos:x;y=axis.top+(this.yAxis.categories.length-(y===undefined?this.points[0].y:y)-1)*height;var heatmapSelector=chart.heatmapSelector;var options=chart.options.heatmapSelector;var path=["M",x,y,"L",x,y+height,"L",x+width,y+height,"L",x+width,y,"Z"];if(heatmapSelector){heatmapSelector.attr("display","block");heatmapSelector.animate({d:path})}else{heatmapSelector=chart.heatmapSelector=renderer.path(path).attr({stroke:options.color||"#C0C0C0","stroke-width":options.lineWidth||1,dashstyle:options.dashStyle||"solid",zIndex:10}).add()}};this.hideHeatmapSelector=function(){if(this.chart.heatmapSelector){this.chart.heatmapSelector.attr("display","none")}};this.onMouseOver=function(){this.showHeatmapSelector()}}});H.wrap(H.Chart.prototype,"init",function(proceed){var options=arguments[1];if(!options.clusterize||options.series.length<3){proceed.apply(this,Array.prototype.slice.call(arguments,1));return}var validAlgorithm={kmeans:"kmeans",hierarchical:"hierarchical"};var validDistance={euclidean:clusterfck.EUCLIDIAN_DISTANCE,manhattan:clusterfck.MANHATTAN_DISTANCE,max:clusterfck.MAX_DISTANCE};var validLinkage={single:clusterfck.SINGLE_LINKAGE,average:clusterfck.AVERAGE_LINKAGE,complete:clusterfck.COMPLETE_LINKAGE};var algorithm=validAlgorithm[options.clusterize.algorithm]||"hierarchical";var distance=validDistance[options.clusterize.distance]||clusterfck.EUCLIDIAN_DISTANCE;var linkage=validLinkage[options.clusterize.linkage]||clusterfck.AVERAGE_LINKAGE;var k=options.clusterize.k;if(!k||k>options.series.length){k=Math.ceil(Math.sqrt(options.series.length/2))}var dendogram=false;if(options.clusterize.dendogram===true){dendogram={}}else if(Object.prototype.toString.call(options.clusterize.dendogram)==="[object Object]"){dendogram=options.clusterize.dendogram}var originalData=options.series;var oldAxis=options.yAxis.categories;var clusters=[],clusterElem,positions=[],labels=[];for(var i in originalData){clusterElem=[];for(var j in originalData[i].data){clusterElem.push(originalData[i].data[j].value)}clusters.push(clusterElem);positions.push(i);labels.push(originalData[i].name)}if(algorithm==="kmeans"){clusters=clusterfck.kmeans(positions,clusters,k,{distance:distance});var newYaxis=[],yPos=0,originalElem;for(var i in clusters.labels){clusterElem=clusters.labels[i];for(var nElem in clusterElem){originalElem=originalData[clusterElem[nElem]];for(var j in originalElem.data){originalElem.data[j].y=yPos}newYaxis.push(oldAxis[clusterElem[nElem]]);yPos++}}options.yAxis.categories=newYaxis;options.clusterize.clusters=clusters.labels}else if(algorithm==="hierarchical"){var root,newYaxis=[],dendogramData={};var reorder=true;if(dendogram.reorder!==undefined){reorder=dendogram.reorder}root=clusterfck.hcluster(positions,clusters,{reorder:reorder,distance:distance,linkage:linkage});var collapseTree=function(node,newYaxis,dendogram,depth){if(!node){return depth}else if(node.left===undefined&&node.right===undefined){var originalElem=originalData[node.label];for(var j in originalElem.data){originalElem.data[j].y=newYaxis.length}newYaxis.push(oldAxis[node.label]);dendogram.right=null;dendogram.left=null;return depth+1}dendogram.right={};dendogram.left={};var depthLeft=collapseTree(node.left,newYaxis,dendogram.left,depth+1);var depthRight=collapseTree(node.right,newYaxis,dendogram.right,depth+1);return Math.max(depthRight,depthLeft)};var maxDepth=collapseTree(root,newYaxis,dendogramData,0);if(dendogram){dendogram.depth=maxDepth;dendogram.data=dendogramData}options.yAxis.categories=newYaxis;options.clusterize.dendogram=dendogram}proceed.apply(this,Array.prototype.slice.call(arguments,1))});H.wrap(H.Chart.prototype,"render",function(proceed){if(!this.xAxis||!this.options.clusterize||!this.options.clusterize.dendogram&&!this.options.clusterize.clusters||this.series.length<3){proceed.apply(this,Array.prototype.slice.call(arguments,1));return}if(this.options.clusterize.clusters){this.chartWidth=this.chartWidth-20;proceed.apply(this,Array.prototype.slice.call(arguments,1));var renderer=this.renderer;var serie=this.series[0];var axis=serie.xAxis;var levelHeight=serie.yAxis.height/serie.yAxis.categories.length;var initialX=axis.pos+axis.len+8;var initialY=axis.top;var nClusters=this.options.clusterize.clusters.length;var colors=randomColor({hue:"random",luminosity:"random",count:nClusters});var drawClusterGroups=function(clusterNumber,x,y,length,color){var newY=y+length;var path=["M",x,y,"L",x,newY,"Z"];renderer.path(path).attr({stroke:color||"#C0C0C0","stroke-width":3,dashstyle:"solid"}).add();renderer.label(clusterNumber,x+5,y+length/2-10).css({color:color,fontSize:"10px"}).add();return newY};for(var i=nClusters;i--;){initialY=drawClusterGroups(i+1,initialX,initialY,this.options.clusterize.clusters[i].length*levelHeight,colors[i])}delete this.options.clusterize.clusters}else{var options=this.options.clusterize.dendogram;this.chartWidth=this.chartWidth-(options.width||150);proceed.apply(this,Array.prototype.slice.call(arguments,1));var renderer=this.renderer;var serie=this.series[0];var axis=serie.xAxis;options["levelWidth"]=(options.width||150)/options.depth;options["levelHeight"]=serie.yAxis.height/serie.yAxis.categories.length;options["initialX"]=axis.pos+axis.len;options["initialY"]=axis.top+serie.points[0].shapeArgs.height/2;options["featureNumber"]=0;var drawDendogram=function(node,level,options){if(node.right===null&&node.left===null){var y=options.initialY+options.levelHeight*options.featureNumber;var width=level*options.levelWidth;var path=["M",options.initialX,y,"L",options.initialX+width,y,"Z"];renderer.path(path).attr({stroke:options.color||"#C0C0C0","stroke-width":options.lineWidth||1,dashstyle:options.dashStyle||"solid"}).add();options.featureNumber++;return y}var yLeft=drawDendogram(node.right,level-1,options);var yRight=drawDendogram(node.left,level-1,options);var x=options.initialX+(level-1)*options.levelWidth;var middleY=yRight-(yRight-yLeft)/2;var path=["M",x,yRight,"L",x,yLeft,"M",x,middleY,"L",x+options.levelWidth,middleY,"Z"];renderer.path(path).attr({stroke:options.color||"#C0C0C0","stroke-width":options.lineWidth||1,dashstyle:options.dashStyle||"solid"}).add();return middleY};drawDendogram(options.data,options.depth+1,options);delete options["initialX"];delete options["initialY"];delete options["levelHeight"];delete options["levelWidth"];delete options["dendogram"]}})})(Highcharts);Ext.dom.Element.override(function(){return{getHeight:function(contentHeight){var dom=this.dom,height=contentHeight?dom.clientHeight-this.getPadding("tb"):dom.offsetHeight;return height&&height>0?height:0},getWidth:function(contentWidth){var dom=this.dom,width=contentWidth?dom.clientWidth-this.getPadding("lr"):dom.offsetWidth;return width&&width>0?width:0}}}());